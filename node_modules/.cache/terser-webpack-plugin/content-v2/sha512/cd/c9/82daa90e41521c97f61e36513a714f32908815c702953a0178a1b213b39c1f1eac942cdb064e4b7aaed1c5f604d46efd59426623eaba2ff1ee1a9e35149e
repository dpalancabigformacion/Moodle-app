{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{IODR:function(e,n,t){\"use strict\";t.r(n),t.d(n,\"AddonModChatLazyModule\",(function(){return ee}));var o=t(\"tyNb\"),s=t(\"L3Fv\"),a=t(\"ef6k\"),i=t(\"ghUQ\"),d=t(\"e1dt\"),c=t(\"fXoL\"),r=t(\"TEn/\"),g=t(\"4JiN\"),l=t(\"hMzs\"),m=t(\"nt/U\"),_=t(\"sYmb\");let h=(()=>{class AddonModChatIndexPage extends i.a{}return AddonModChatIndexPage.ɵfac=function AddonModChatIndexPage_Factory(e){return u(e||AddonModChatIndexPage)},AddonModChatIndexPage.ɵcmp=c.sc({type:AddonModChatIndexPage,selectors:[[\"page-addon-mod-chat-index\"]],viewQuery:function AddonModChatIndexPage_Query(e,n){var t;(1&e&&c.ud(d.a,!0),2&e)&&(c.dd(t=c.Nc())&&(n.activityComponent=t.first))},features:[c.ic],decls:14,vars:12,consts:[[\"collapsible\",\"\"],[\"slot\",\"start\"],[3,\"text\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\"],[\"slot\",\"end\"],[1,\"limited-width\"],[\"slot\",\"fixed\",3,\"disabled\",\"ionRefresh\"],[3,\"pullingText\"],[3,\"module\",\"courseId\",\"dataRetrieved\"]],template:function AddonModChatIndexPage_Template(e,n){1&e&&(c.Ec(0,\"ion-header\",0),c.Ec(1,\"ion-toolbar\"),c.Ec(2,\"ion-buttons\",1),c.zc(3,\"ion-back-button\",2),c.Pc(4,\"translate\"),c.Dc(),c.Ec(5,\"ion-title\"),c.Ec(6,\"h1\"),c.zc(7,\"core-format-text\",3),c.Dc(),c.Dc(),c.zc(8,\"ion-buttons\",4),c.Dc(),c.Dc(),c.Ec(9,\"ion-content\",5),c.Ec(10,\"ion-refresher\",6),c.Mc(\"ionRefresh\",(function AddonModChatIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==n.activityComponent?null:n.activityComponent.doRefresh(e.target)})),c.zc(11,\"ion-refresher-content\",7),c.Pc(12,\"translate\"),c.Dc(),c.Ec(13,\"addon-mod-chat-index\",8),c.Mc(\"dataRetrieved\",(function AddonModChatIndexPage_Template_addon_mod_chat_index_dataRetrieved_13_listener(e){return n.updateData(e)})),c.Dc(),c.Dc()),2&e&&(c.lc(3),c.Vc(\"text\",c.Qc(4,8,\"core.back\")),c.lc(4),c.Vc(\"text\",n.title)(\"contextInstanceId\",null==n.module?null:n.module.id)(\"courseId\",n.courseId),c.lc(3),c.Vc(\"disabled\",null==n.activityComponent?null:n.activityComponent.showLoading),c.lc(1),c.Wc(\"pullingText\",c.Qc(12,10,\"core.pulltorefresh\")),c.lc(2),c.Vc(\"module\",n.module)(\"courseId\",n.courseId))},directives:[r.C,g.b,r.Ab,r.m,r.h,r.i,r.yb,l.a,m.a,r.v,r.bb,r.cb,d.a],pipes:[_.d],encapsulation:2}),AddonModChatIndexPage})();const u=c.Gc(h);var p=t(\"mrSG\"),f=t(\"MUy3\"),M=t(\"O4u7\"),C=t(\"nvXB\"),P=t(\"pHTc\"),b=t(\"9+EE\"),O=t(\"3LXp\"),v=t(\"bFG1\"),I=t(\"j3ag\"),x=t(\"fjkH\"),A=t(\"5E3q\"),D=t(\"g4DX\"),w=t(\"btSF\"),y=t(\"ofXK\"),T=t(\"PgjG\"),E=t(\"ACYt\"),S=t(\"3CSS\"),k=t(\"FeAf\"),R=t(\"r8G5\"),V=t(\"uYHD\");function AddonModChatChatPage_ion_button_9_Template(e,n){if(1&e){const e=c.Fc();c.Ec(0,\"ion-button\",14),c.Mc(\"click\",(function AddonModChatChatPage_ion_button_9_Template_ion_button_click_0_listener(){c.fd(e);return c.Oc().showChatUsers()})),c.Pc(1,\"translate\"),c.zc(2,\"ion-icon\",15),c.Dc()}2&e&&c.mc(\"aria-label\",c.Qc(1,1,\"core.users\"))}function AddonModChatChatPage_ng_container_13_p_1_Template(e,n){if(1&e&&(c.Ec(0,\"p\",19),c.pd(1),c.Pc(2,\"coreFormatDate\"),c.Dc()),2&e){const e=c.Oc().$implicit;c.lc(1),c.rd(\" \",c.Rc(2,1,1e3*e.timestamp,\"strftimedayshort\"),\" \")}}const _c0=function(e){return{$a:e}};function AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",26),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",27),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messageenter\",c.ad(8,_c0,e.userfullname)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",28),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",29),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messageexit\",c.ad(8,_c0,e.userfullname)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",30),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",31),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messagebeepseveryone\",c.ad(8,_c0,e.userfullname)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",30),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",31),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messagebeepsyou\",c.ad(8,_c0,e.userfullname)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",32),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",31),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messageyoubeep\",c.ad(8,_c0,e.beepWho)),\" \")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template(e,n){if(1&e){const e=c.Fc();c.Ec(0,\"ion-badge\",33),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",34),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Ec(5,\"strong\"),c.pd(6),c.Ec(7,\"core-format-text\",35),c.Mc(\"afterRender\",(function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template_core_format_text_afterRender_7_listener(){c.fd(e);const n=c.Oc(2).last,t=c.Oc();return n&&t.scrollToBottom()})),c.Dc(),c.Dc(),c.Dc(),c.Dc()}if(2&e){const e=c.Oc(2).$implicit,n=c.Oc();c.lc(3),c.rd(\" \",c.Rc(4,5,1e3*e.timestamp,\"strftimetime\"),\" \"),c.lc(3),c.rd(\" \",e.userfullname,\" \"),c.lc(1),c.Vc(\"text\",e.message)(\"contextInstanceId\",n.cmId)(\"courseId\",n.courseId)}}function AddonModChatChatPage_ng_container_13_div_2_Template(e,n){if(1&e&&(c.Ec(0,\"div\",20),c.nd(1,AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template,6,10,\"ion-badge\",21),c.nd(2,AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template,6,10,\"ion-badge\",22),c.nd(3,AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template,6,10,\"ion-badge\",23),c.nd(4,AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template,6,10,\"ion-badge\",23),c.nd(5,AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template,6,10,\"ion-badge\",24),c.nd(6,AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template,8,8,\"ion-badge\",25),c.Dc()),2&e){const e=c.Oc().$implicit,n=c.Oc();c.lc(1),c.Vc(\"ngIf\",e.system&&\"enter\"==e.message),c.lc(1),c.Vc(\"ngIf\",e.system&&\"exit\"==e.message),c.lc(1),c.Vc(\"ngIf\",\"all\"==e.beep),c.lc(1),c.Vc(\"ngIf\",e.userid!=n.currentUserId&&e.beep==n.currentUserId),c.lc(1),c.Vc(\"ngIf\",e.userid==n.currentUserId&&e.beep&&\"all\"!=e.beep),c.lc(1),c.Vc(\"ngIf\",!e.system&&!e.beep)}}function AddonModChatChatPage_ng_container_13_ion_item_3_h2_2_Template(e,n){if(1&e&&(c.Ec(0,\"h2\",40),c.zc(1,\"core-user-avatar\",41),c.Ec(2,\"div\"),c.pd(3),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(1),c.Vc(\"user\",e)(\"linkProfile\",!1),c.lc(2),c.qd(e.userfullname)}}function AddonModChatChatPage_ng_container_13_ion_item_3_div_8_Template(e,n){1&e&&c.zc(0,\"div\",42)}function AddonModChatChatPage_ng_container_13_ion_item_3_Template(e,n){if(1&e){const e=c.Fc();c.Ec(0,\"ion-item\",36),c.Ec(1,\"ion-label\"),c.nd(2,AddonModChatChatPage_ng_container_13_ion_item_3_h2_2_Template,4,3,\"h2\",37),c.Ec(3,\"div\",38),c.Ec(4,\"core-format-text\",35),c.Mc(\"afterRender\",(function AddonModChatChatPage_ng_container_13_ion_item_3_Template_core_format_text_afterRender_4_listener(){c.fd(e);const n=c.Oc().last,t=c.Oc();return n&&t.scrollToBottom()})),c.Dc(),c.Dc(),c.Dc(),c.Ec(5,\"ion-note\",3),c.pd(6),c.Pc(7,\"coreFormatDate\"),c.Dc(),c.nd(8,AddonModChatChatPage_ng_container_13_ion_item_3_div_8_Template,1,0,\"div\",39),c.Dc()}if(2&e){const e=c.Oc().$implicit,n=c.Oc();c.qc(\"addon-message-mine\",e.userid==n.currentUserId)(\"addon-message-not-mine\",e.userid!=n.currentUserId)(\"addon-message-no-user\",!e.showUserData),c.Vc(\"@coreSlideInOut\",e.userid==n.currentUserId?\"\":\"fromLeft\"),c.lc(2),c.Vc(\"ngIf\",e.showUserData),c.lc(2),c.Vc(\"text\",e.message)(\"contextInstanceId\",n.cmId)(\"courseId\",n.courseId),c.lc(2),c.qd(c.Rc(7,13,1e3*e.timestamp,\"strftimetime\")),c.lc(2),c.Vc(\"ngIf\",e.showTail)}}function AddonModChatChatPage_ng_container_13_Template(e,n){if(1&e&&(c.Cc(0),c.nd(1,AddonModChatChatPage_ng_container_13_p_1_Template,3,4,\"p\",16),c.nd(2,AddonModChatChatPage_ng_container_13_div_2_Template,7,6,\"div\",17),c.nd(3,AddonModChatChatPage_ng_container_13_ion_item_3_Template,9,16,\"ion-item\",18),c.Bc()),2&e){const e=n.$implicit;c.lc(1),c.Vc(\"ngIf\",e.showDate),c.lc(1),c.Vc(\"ngIf\",e.special),c.lc(1),c.Vc(\"ngIf\",!e.special)}}function AddonModChatChatPage_core_empty_box_14_Template(e,n){1&e&&(c.zc(0,\"core-empty-box\",43),c.Pc(1,\"translate\")),2&e&&c.Vc(\"message\",c.Qc(1,1,\"addon.mod_chat.nomessages\"))}function AddonModChatChatPage_p_17_Template(e,n){1&e&&(c.Ec(0,\"p\",44),c.pd(1),c.Pc(2,\"translate\"),c.Dc()),2&e&&(c.lc(1),c.rd(\" \",c.Qc(2,1,\"addon.mod_chat.mustbeonlinetosendmessages\"),\" \"))}function AddonModChatChatPage_core_send_message_form_18_Template(e,n){if(1&e){const e=c.Fc();c.Ec(0,\"core-send-message-form\",45),c.Mc(\"onSubmit\",(function AddonModChatChatPage_core_send_message_form_18_Template_core_send_message_form_onSubmit_0_listener(n){c.fd(e);return c.Oc().sendMessage(n)})),c.Pc(1,\"translate\"),c.Dc()}if(2&e){const e=c.Oc();c.Vc(\"sendDisabled\",e.sending)(\"message\",e.newMessage)(\"placeholder\",c.Qc(1,3,\"addon.messages.newmessage\"))}}function AddonModChatChatPage_ion_button_19_Template(e,n){if(1&e){const e=c.Fc();c.Ec(0,\"ion-button\",46),c.Mc(\"click\",(function AddonModChatChatPage_ion_button_19_Template_ion_button_click_0_listener(){c.fd(e);return c.Oc().reconnect()})),c.pd(1),c.Pc(2,\"translate\"),c.Dc()}2&e&&(c.lc(1),c.rd(\" \",c.Qc(2,1,\"core.login.reconnect\"),\" \"))}let z=(()=>{class AddonModChatChatPage{constructor(){this.loaded=!1,this.title=\"\",this.messages=[],this.sending=!1,this.lastTime=0,this.oldContentHeight=0,this.viewDestroyed=!1,this.pollingRunning=!1,this.users=[],this.currentUserId=b.b.getCurrentSiteUserId(),this.isOnline=C.a.isOnline(),this.onlineSubscription=I.B.onChange().subscribe((()=>{I.C.run((()=>{this.isOnline=C.a.isOnline()}))}))}ngOnInit(){return Object(p.a)(this,void 0,void 0,(function*(){try{this.courseId=P.a.getRequiredRouteNumberParam(\"courseId\"),this.cmId=P.a.getRequiredRouteNumberParam(\"cmId\"),this.chatId=P.a.getRequiredRouteNumberParam(\"chatId\"),this.title=P.a.getRouteParam(\"title\")||\"\",yield this.loginUser(),yield this.fetchMessages(),this.startPolling()}catch(e){O.a.showErrorModalDefault(e,\"addon.mod_chat.errorwhileconnecting\",!0),P.a.back()}finally{this.loaded=!0}}))}ionViewDidEnter(){this.startPolling()}ionViewWillLeave(){x.b.trigger(x.b.ACTIVITY_DATA_SENT,{module:\"chat\"}),this.stopPolling()}loginUser(){return Object(p.a)(this,void 0,void 0,(function*(){this.sessionId=yield D.a.loginUser(this.chatId)}))}fetchMessages(){return Object(p.a)(this,void 0,void 0,(function*(){const e=yield D.a.getLatestMessages(this.sessionId,this.lastTime);this.lastTime=e.chatnewlasttime||0;const n=yield D.a.getMessagesUserData(e.messages,this.courseId);if(!n.length)return;const t=this.messages.length;this.messages=this.messages.concat(n);for(let e=t;e<this.messages.length;e++){this.messages[e]=w.a.formatMessage(this.currentUserId,this.messages[e],e>0?this.messages[e-1]:void 0);const n=this.messages[e];n.beep&&n.beep!=String(this.currentUserId)&&this.loadMessageBeepWho(n)}this.messages[this.messages.length-1].showTail=!0,this.scrollToBottom()}))}loadMessageBeepWho(e){return Object(p.a)(this,void 0,void 0,(function*(){e.beepWho=yield this.getUserFullname(e.beep)}))}showChatUsers(){var e;return Object(p.a)(this,void 0,void 0,(function*(){const n=yield O.a.openSideModal({component:A.a,componentProps:{sessionId:this.sessionId,cmId:this.cmId}});n&&(n.talkTo&&(this.newMessage=`To ${n.talkTo}: `+((null===(e=this.sendMessageForm)||void 0===e?void 0:e.message)||\"\")),n.beepTo&&this.sendMessage(\"\",n.beepTo),this.users=n.users)}))}getUserFullname(e){return Object(p.a)(this,void 0,void 0,(function*(){const n=parseInt(e,10);if(isNaN(n))return e;const t=this.users.find((e=>e.id==n));if(t)return t.fullname;try{const t=yield D.a.getChatUsers(this.sessionId,{cmId:this.cmId});this.users=t.users;const o=this.users.find((e=>e.id==n));return o?o.fullname:e}catch(n){return e}}))}startPolling(){this.polling||(this.polling=window.setInterval((()=>{v.a.ignoreErrors(this.fetchMessagesInterval())}),D.b.POLL_INTERVAL))}stopPolling(){clearInterval(this.polling),this.polling=void 0}fetchMessagesInterval(){return Object(p.a)(this,void 0,void 0,(function*(){if(this.isOnline&&!this.pollingRunning){this.pollingRunning=!0;try{yield this.fetchMessages()}catch(e){try{yield this.loginUser(),yield this.fetchMessages()}catch(e){throw this.stopPolling(),O.a.showErrorModalDefault(e,\"addon.mod_chat.errorwhileretrievingmessages\",!0),e}}finally{this.pollingRunning=!1}}}))}sendMessage(e,n=0){return Object(p.a)(this,void 0,void 0,(function*(){if(this.isOnline&&(0!==n||e.trim())){this.sending=!0;try{yield D.a.sendMessage(this.sessionId,e,n),v.a.ignoreErrors(this.fetchMessagesInterval())}catch(n){C.a.closeKeyboard(),this.newMessage=e,O.a.showErrorModalDefault(n,\"addon.mod_chat.errorwhilesendingmessage\",!0)}finally{this.sending=!1}}}))}reconnect(){return Object(p.a)(this,void 0,void 0,(function*(){const e=yield O.a.showModalLoading();try{yield this.fetchMessagesInterval(),this.startPolling()}catch(e){}finally{e.dismiss()}}))}scrollToBottom(){var e;return Object(p.a)(this,void 0,void 0,(function*(){yield v.a.nextTick(),this.viewDestroyed||null===(e=this.content)||void 0===e||e.scrollToBottom()}))}canLeave(){return Object(p.a)(this,void 0,void 0,(function*(){return!this.messages.some((e=>!e.special))||(yield O.a.showConfirm(I.M.instant(\"addon.mod_chat.confirmloss\")),!0)}))}ngOnDestroy(){this.onlineSubscription&&this.onlineSubscription.unsubscribe(),this.stopPolling(),this.viewDestroyed=!0}}return AddonModChatChatPage.ɵfac=function AddonModChatChatPage_Factory(e){return new(e||AddonModChatChatPage)},AddonModChatChatPage.ɵcmp=c.sc({type:AddonModChatChatPage,selectors:[[\"page-addon-mod-chat-chat\"]],viewQuery:function AddonModChatChatPage_Query(e,n){var t;(1&e&&(c.ud(r.v,!0),c.ud(M.a,!0)),2&e)&&(c.dd(t=c.Nc())&&(n.content=t.first),c.dd(t=c.Nc())&&(n.sendMessageForm=t.first))},decls:20,vars:14,consts:[[\"slot\",\"start\"],[3,\"text\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\"],[\"slot\",\"end\"],[\"fill\",\"clear\",3,\"click\",4,\"ngIf\"],[3,\"hideUntil\"],[\"aria-live\",\"polite\",1,\"addon-messages-discussion-container\"],[4,\"ngFor\",\"ngForOf\"],[\"icon\",\"far-comments\",3,\"message\",4,\"ngIf\"],[1,\"footer-adjustable\"],[3,\"color\"],[\"class\",\"ion-text-center\",4,\"ngIf\"],[3,\"sendDisabled\",\"message\",\"placeholder\",\"onSubmit\",4,\"ngIf\"],[\"expand\",\"block\",\"fill\",\"outline\",3,\"click\",4,\"ngIf\"],[\"fill\",\"clear\",3,\"click\"],[\"name\",\"fas-users\",\"slot\",\"icon-only\",\"aria-hidden\",\"true\"],[\"class\",\"ion-text-center addon-messages-date\",4,\"ngIf\"],[\"class\",\"ion-text-center addon-mod_chat-notice\",4,\"ngIf\"],[\"class\",\"ion-text-wrap addon-message\",3,\"addon-message-mine\",\"addon-message-not-mine\",\"addon-message-no-user\",4,\"ngIf\"],[1,\"ion-text-center\",\"addon-messages-date\"],[1,\"ion-text-center\",\"addon-mod_chat-notice\"],[\"class\",\"ion-text-wrap\",\"color\",\"success\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"danger\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"primary\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"light\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"info\",4,\"ngIf\"],[\"color\",\"success\",1,\"ion-text-wrap\"],[\"name\",\"fas-sign-in-alt\",\"aria-hidden\",\"true\"],[\"color\",\"danger\",1,\"ion-text-wrap\"],[\"name\",\"fas-sign-out-alt\",\"aria-hidden\",\"true\"],[\"color\",\"primary\",1,\"ion-text-wrap\"],[\"name\",\"fas-bell\",\"aria-hidden\",\"true\"],[\"color\",\"light\",1,\"ion-text-wrap\"],[\"color\",\"info\",1,\"ion-text-wrap\"],[\"name\",\"fas-asterisk\",\"aria-hidden\",\"true\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\",\"afterRender\"],[1,\"ion-text-wrap\",\"addon-message\"],[\"class\",\"addon-message-user\",4,\"ngIf\"],[1,\"addon-message-text\"],[\"class\",\"tail\",4,\"ngIf\"],[1,\"addon-message-user\"],[\"slot\",\"start\",3,\"user\",\"linkProfile\"],[1,\"tail\"],[\"icon\",\"far-comments\",3,\"message\"],[1,\"ion-text-center\"],[3,\"sendDisabled\",\"message\",\"placeholder\",\"onSubmit\"],[\"expand\",\"block\",\"fill\",\"outline\",3,\"click\"]],template:function AddonModChatChatPage_Template(e,n){1&e&&(c.Ec(0,\"ion-header\"),c.Ec(1,\"ion-toolbar\"),c.Ec(2,\"ion-buttons\",0),c.zc(3,\"ion-back-button\",1),c.Pc(4,\"translate\"),c.Dc(),c.Ec(5,\"ion-title\"),c.Ec(6,\"h1\"),c.zc(7,\"core-format-text\",2),c.Dc(),c.Dc(),c.Ec(8,\"ion-buttons\",3),c.nd(9,AddonModChatChatPage_ion_button_9_Template,3,3,\"ion-button\",4),c.Dc(),c.Dc(),c.Dc(),c.Ec(10,\"ion-content\"),c.Ec(11,\"core-loading\",5),c.Ec(12,\"ion-list\",6),c.nd(13,AddonModChatChatPage_ng_container_13_Template,4,3,\"ng-container\",7),c.Dc(),c.nd(14,AddonModChatChatPage_core_empty_box_14_Template,2,3,\"core-empty-box\",8),c.Dc(),c.Dc(),c.Ec(15,\"ion-footer\",9),c.Ec(16,\"ion-toolbar\",10),c.nd(17,AddonModChatChatPage_p_17_Template,3,3,\"p\",11),c.nd(18,AddonModChatChatPage_core_send_message_form_18_Template,2,5,\"core-send-message-form\",12),c.nd(19,AddonModChatChatPage_ion_button_19_Template,3,3,\"ion-button\",13),c.Dc(),c.Dc()),2&e&&(c.lc(3),c.Vc(\"text\",c.Qc(4,12,\"core.back\")),c.lc(4),c.Vc(\"text\",n.title)(\"contextInstanceId\",n.cmId)(\"courseId\",n.courseId),c.lc(2),c.Vc(\"ngIf\",n.loaded),c.lc(2),c.Vc(\"hideUntil\",n.loaded),c.lc(2),c.Vc(\"ngForOf\",n.messages),c.lc(1),c.Vc(\"ngIf\",!n.messages||n.messages.length<=0),c.lc(2),c.Vc(\"color\",n.isOnline&&n.polling&&n.loaded?\"contrast\":\"light\"),c.lc(1),c.Vc(\"ngIf\",!n.isOnline),c.lc(1),c.Vc(\"ngIf\",n.isOnline&&n.polling&&n.loaded),c.lc(1),c.Vc(\"ngIf\",n.isOnline&&!n.polling&&n.loaded))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,l.a,y.t,m.a,r.v,T.a,r.P,y.s,r.A,E.a,r.l,r.D,S.a,r.k,r.I,r.O,r.W,k.a,R.a,M.a],pipes:[_.d,V.a],styles:['.ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}ion-item.addon-message[_ngcontent-%COMP%]{--message-background:var(--addon-messages-message-bg);--message-activated-background:var(--addon-messages-message-activated-bg);--message-alignment:flex-start;border:0;border-radius:var(--medium-radius);padding:0 8px;margin:8px;--background:var(--message-background);background:var(--message-background);align-self:var(--message-alignment);width:90%;max-width:var(--list-item-max-width);--min-height:var(--a11y-min-target-size);position:relative;transition:width .5s ease-in-out;overflow:visible}ion-item.addon-message[_ngcontent-%COMP%]::part(native){--inner-border-width:0px;--inner-padding-end:0px;padding:0;margin:0}ion-item.addon-message[_ngcontent-%COMP%]:hover{filter:drop-shadow(2px 2px 2px rgba(0,0,0,.3))}ion-item.addon-message[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]:only-child{display:inline}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem;margin-top:0;color:var(--ion-text-color)}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{display:block;--core-avatar-size:var(--addon-messages-avatar-size);margin:0}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:500;flex-grow:1;padding-left:.5rem;padding-right:.5rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}ion-item.addon-message[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{color:var(--addon-messages-message-note-text);font-size:var(--addon-messages-message-note-font-size);margin:0;padding:8px 0;align-self:flex-start}ion-item.addon-message[tappable][_ngcontent-%COMP%]:active{--message-background:var(--message-activated-background)}ion-item.addon-message[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0;padding:8px 0}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-text[_ngcontent-%COMP%]{display:inline-flex}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-text[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:var(--ion-text-color)}ion-item.addon-message[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{content:\"\";width:0;height:0;position:absolute;touch-action:none;bottom:0;border:.5rem solid transparent;border-bottom:.5rem solid var(--message-background)}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]{--message-background:var(--addon-messages-message-mine-bg);--message-activated-background:var(--addon-messages-message-mine-activated-bg);--message-alignment:flex-end}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{float:right;margin:2px -3px -2px 5px}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{float:left}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:5px;margin-inline-start:5px;-webkit-margin-end:-3px;margin-inline-end:-3px}}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{right:-8px;margin-right:-.5rem}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:unset;right:unset;left:-8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:-.5rem;margin-inline-end:-.5rem}}ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:-8px;margin-left:-.5rem}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:unset;right:unset;right:-8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:-.5rem;margin-inline-start:-.5rem}}ion-item.addon-message[_ngcontent-%COMP%]   .addon-messages-delete-button[_ngcontent-%COMP%]{min-height:0;line-height:normal;margin-top:0;margin-bottom:0;height:var(--a11y-min-target-size)!important;align-self:flex-end}ion-item.addon-message[_ngcontent-%COMP%]   .addon-messages-delete-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.4em;line-height:normal;color:var(--danger)}ion-item.addon-message.addon-message-no-user[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}'],data:{animation:[f.a.SLIDE_IN_OUT]}}),AddonModChatChatPage})();var F=t(\"4pns\");function AddonModChatSessionMessagesPage_ng_container_15_div_1_Template(e,n){if(1&e&&(c.Ec(0,\"div\",10),c.pd(1),c.Pc(2,\"coreFormatDate\"),c.Dc()),2&e){const e=c.Oc().$implicit;c.lc(1),c.rd(\" \",c.Rc(2,1,1e3*e.timestamp,\"strftimedayshort\"),\" \")}}const session_messages_c0=function(e){return{$a:e}};function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",17),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",18),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messageenter\",c.ad(8,session_messages_c0,e.userfullname)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",19),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",20),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messageexit\",c.ad(8,session_messages_c0,e.userfullname)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",21),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",22),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messagebeepseveryone\",c.ad(8,session_messages_c0,e.userfullname)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",21),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",22),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messagebeepsyou\",c.ad(8,session_messages_c0,e.userfullname)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",23),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",22),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Pc(5,\"translate\"),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(3),c.sd(\" \",c.Rc(4,2,1e3*e.timestamp,\"strftimetime\"),\" \",c.Rc(5,5,\"addon.mod_chat.messageyoubeep\",c.ad(8,session_messages_c0,e.beepWho)),\" \")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template(e,n){if(1&e&&(c.Ec(0,\"ion-badge\",24),c.Ec(1,\"span\"),c.zc(2,\"ion-icon\",25),c.pd(3),c.Pc(4,\"coreFormatDate\"),c.Ec(5,\"strong\"),c.pd(6),c.zc(7,\"core-format-text\",26),c.Dc(),c.Dc(),c.Dc()),2&e){const e=c.Oc(2).$implicit,n=c.Oc();c.lc(3),c.rd(\" \",c.Rc(4,5,1e3*e.timestamp,\"strftimetime\"),\" \"),c.lc(3),c.rd(\" \",e.userfullname,\" \"),c.lc(1),c.Vc(\"text\",e.message)(\"contextInstanceId\",n.cmId)(\"courseId\",n.courseId)}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_Template(e,n){if(1&e&&(c.Ec(0,\"div\",11),c.nd(1,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template,6,10,\"ion-badge\",12),c.nd(2,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template,6,10,\"ion-badge\",13),c.nd(3,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template,6,10,\"ion-badge\",14),c.nd(4,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template,6,10,\"ion-badge\",14),c.nd(5,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template,6,10,\"ion-badge\",15),c.nd(6,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template,8,8,\"ion-badge\",16),c.Dc()),2&e){const e=c.Oc().$implicit,n=c.Oc();c.lc(1),c.Vc(\"ngIf\",e.issystem&&\"enter\"==e.message),c.lc(1),c.Vc(\"ngIf\",e.issystem&&\"exit\"==e.message),c.lc(1),c.Vc(\"ngIf\",\"all\"==e.beep),c.lc(1),c.Vc(\"ngIf\",e.userid!=n.currentUserId&&e.beep==n.currentUserId),c.lc(1),c.Vc(\"ngIf\",e.userid==n.currentUserId&&e.beep&&\"all\"!=e.beep),c.lc(1),c.Vc(\"ngIf\",!e.issystem&&!e.beep)}}function AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_core_user_avatar_3_Template(e,n){if(1&e&&c.zc(0,\"core-user-avatar\",34),2&e){const e=c.Oc(2).$implicit;c.Vc(\"user\",e)(\"linkProfile\",!1)}}function AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_div_4_Template(e,n){if(1&e&&(c.Ec(0,\"div\"),c.pd(1),c.Dc()),2&e){const e=c.Oc(2).$implicit;c.lc(1),c.qd(e.userfullname)}}function AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_div_10_Template(e,n){1&e&&c.zc(0,\"div\",35)}function AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_Template(e,n){if(1&e&&(c.Ec(0,\"ion-item\",27),c.Ec(1,\"ion-label\"),c.Ec(2,\"h2\",28),c.nd(3,AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_core_user_avatar_3_Template,1,2,\"core-user-avatar\",29),c.nd(4,AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_div_4_Template,2,1,\"div\",30),c.Dc(),c.Ec(5,\"div\",31),c.zc(6,\"core-format-text\",26),c.Dc(),c.Dc(),c.Ec(7,\"ion-note\",32),c.pd(8),c.Pc(9,\"coreFormatDate\"),c.Dc(),c.nd(10,AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_div_10_Template,1,0,\"div\",33),c.Dc()),2&e){const e=c.Oc().$implicit,n=c.Oc();c.qc(\"addon-message-mine\",e.userid==n.currentUserId)(\"addon-message-not-mine\",e.userid!=n.currentUserId)(\"addon-message-no-user\",!e.showUserData),c.lc(3),c.Vc(\"ngIf\",e.showUserData),c.lc(1),c.Vc(\"ngIf\",e.showUserData),c.lc(2),c.Vc(\"text\",e.message)(\"contextInstanceId\",n.cmId)(\"courseId\",n.courseId),c.lc(2),c.qd(c.Rc(9,13,1e3*e.timestamp,\"strftimetime\")),c.lc(2),c.Vc(\"ngIf\",e.showTail)}}function AddonModChatSessionMessagesPage_ng_container_15_Template(e,n){if(1&e&&(c.Cc(0),c.nd(1,AddonModChatSessionMessagesPage_ng_container_15_div_1_Template,3,4,\"div\",7),c.nd(2,AddonModChatSessionMessagesPage_ng_container_15_div_2_Template,7,6,\"div\",8),c.nd(3,AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_Template,11,16,\"ion-item\",9),c.Bc()),2&e){const e=n.$implicit;c.lc(1),c.Vc(\"ngIf\",e.showDate),c.lc(1),c.Vc(\"ngIf\",e.special),c.lc(1),c.Vc(\"ngIf\",!e.special)}}let U=(()=>{class AddonModChatSessionMessagesPage{constructor(){this.messages=[],this.loaded=!1}ngOnInit(){try{this.courseId=P.a.getRequiredRouteNumberParam(\"courseId\"),this.cmId=P.a.getRequiredRouteNumberParam(\"cmId\"),this.sessionStart=P.a.getRequiredRouteNumberParam(\"sessionStart\"),this.sessionEnd=P.a.getRequiredRouteNumberParam(\"sessionEnd\"),this.chatId=P.a.getRequiredRouteNumberParam(\"chatId\"),this.groupId=P.a.getRouteNumberParam(\"groupId\")||0}catch(e){return O.a.showErrorModal(e),P.a.back(),void 0}this.currentUserId=b.b.getCurrentSiteUserId(),this.fetchMessages()}fetchMessages(){return Object(p.a)(this,void 0,void 0,(function*(){try{const e=yield D.a.getSessionMessages(this.chatId,this.sessionStart,this.sessionEnd,this.groupId,{cmId:this.cmId});this.messages=yield D.a.getMessagesUserData(e,this.courseId);for(let e=0;e<this.messages.length;e++){this.messages[e]=w.a.formatMessage(this.currentUserId,this.messages[e],e>0?this.messages[e-1]:void 0);const n=this.messages[e];n.beep&&n.beep!=String(this.currentUserId)&&this.loadMessageBeepWho(n)}this.messages[this.messages.length-1].showTail=!0}catch(e){O.a.showErrorModalDefault(e,\"core.errorloadingcontent\",!0)}finally{this.loaded=!0}}))}loadMessageBeepWho(e){return Object(p.a)(this,void 0,void 0,(function*(){e.beepWho=yield this.getUserFullname(e.beep)}))}getUserFullname(e){return Object(p.a)(this,void 0,void 0,(function*(){const n=parseInt(e,10);if(isNaN(n))return e;try{return(yield F.a.getProfile(n,this.courseId,!0)).fullname}catch(n){return e}}))}refreshMessages(e){return Object(p.a)(this,void 0,void 0,(function*(){try{yield v.a.ignoreErrors(D.a.invalidateSessionMessages(this.chatId,this.sessionStart,this.groupId)),yield this.fetchMessages()}finally{e.complete()}}))}}return AddonModChatSessionMessagesPage.ɵfac=function AddonModChatSessionMessagesPage_Factory(e){return new(e||AddonModChatSessionMessagesPage)},AddonModChatSessionMessagesPage.ɵcmp=c.sc({type:AddonModChatSessionMessagesPage,selectors:[[\"page-addon-mod-chat-session-messages\"]],decls:16,vars:12,consts:[[\"slot\",\"start\"],[3,\"text\"],[\"slot\",\"fixed\",3,\"disabled\",\"ionRefresh\"],[3,\"pullingText\"],[3,\"hideUntil\"],[1,\"addon-messages-discussion-container\"],[4,\"ngFor\",\"ngForOf\"],[\"class\",\"ion-text-center addon-messages-date\",4,\"ngIf\"],[\"class\",\"ion-text-center addon-mod_chat-notice\",4,\"ngIf\"],[\"class\",\"ion-text-wrap addon-message\",3,\"addon-message-mine\",\"addon-message-not-mine\",\"addon-message-no-user\",4,\"ngIf\"],[1,\"ion-text-center\",\"addon-messages-date\"],[1,\"ion-text-center\",\"addon-mod_chat-notice\"],[\"class\",\"ion-text-wrap\",\"color\",\"success\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"danger\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"primary\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"light\",4,\"ngIf\"],[\"class\",\"ion-text-wrap\",\"color\",\"info\",4,\"ngIf\"],[\"color\",\"success\",1,\"ion-text-wrap\"],[\"name\",\"fas-sign-in-alt\",\"aria-hidden\",\"true\"],[\"color\",\"danger\",1,\"ion-text-wrap\"],[\"name\",\"fas-sign-out-alt\",\"aria-hidden\",\"true\"],[\"color\",\"primary\",1,\"ion-text-wrap\"],[\"name\",\"fas-bell\",\"aria-hidden\",\"true\"],[\"color\",\"light\",1,\"ion-text-wrap\"],[\"color\",\"info\",1,\"ion-text-wrap\"],[\"name\",\"fas-asterisk\",\"aria-hidden\",\"true\"],[\"contextLevel\",\"module\",3,\"text\",\"contextInstanceId\",\"courseId\"],[1,\"ion-text-wrap\",\"addon-message\"],[1,\"addon-message-user\"],[\"slot\",\"start\",3,\"user\",\"linkProfile\",4,\"ngIf\"],[4,\"ngIf\"],[1,\"addon-message-text\"],[\"slot\",\"end\"],[\"class\",\"tail\",4,\"ngIf\"],[\"slot\",\"start\",3,\"user\",\"linkProfile\"],[1,\"tail\"]],template:function AddonModChatSessionMessagesPage_Template(e,n){1&e&&(c.Ec(0,\"ion-header\"),c.Ec(1,\"ion-toolbar\"),c.Ec(2,\"ion-buttons\",0),c.zc(3,\"ion-back-button\",1),c.Pc(4,\"translate\"),c.Dc(),c.Ec(5,\"ion-title\"),c.Ec(6,\"h1\"),c.pd(7),c.Pc(8,\"translate\"),c.Dc(),c.Dc(),c.Dc(),c.Dc(),c.Ec(9,\"ion-content\"),c.Ec(10,\"ion-refresher\",2),c.Mc(\"ionRefresh\",(function AddonModChatSessionMessagesPage_Template_ion_refresher_ionRefresh_10_listener(e){return n.refreshMessages(e.target)})),c.zc(11,\"ion-refresher-content\",3),c.Pc(12,\"translate\"),c.Dc(),c.Ec(13,\"core-loading\",4),c.Ec(14,\"ion-list\",5),c.nd(15,AddonModChatSessionMessagesPage_ng_container_15_Template,4,3,\"ng-container\",6),c.Dc(),c.Dc(),c.Dc()),2&e&&(c.lc(3),c.Vc(\"text\",c.Qc(4,6,\"core.back\")),c.lc(4),c.qd(c.Qc(8,8,\"addon.mod_chat.messages\")),c.lc(3),c.Vc(\"disabled\",!n.loaded),c.lc(1),c.Wc(\"pullingText\",c.Qc(12,10,\"core.pulltorefresh\")),c.lc(2),c.Vc(\"hideUntil\",n.loaded),c.lc(2),c.Vc(\"ngForOf\",n.messages))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,m.a,r.v,r.bb,r.cb,T.a,r.P,y.s,y.t,r.k,r.D,S.a,l.a,r.I,r.O,r.W,k.a],pipes:[_.d,V.a],styles:['.ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}ion-item.addon-message[_ngcontent-%COMP%]{--message-background:var(--addon-messages-message-bg);--message-activated-background:var(--addon-messages-message-activated-bg);--message-alignment:flex-start;border:0;border-radius:var(--medium-radius);padding:0 8px;margin:8px;--background:var(--message-background);background:var(--message-background);align-self:var(--message-alignment);width:90%;max-width:var(--list-item-max-width);--min-height:var(--a11y-min-target-size);position:relative;transition:width .5s ease-in-out;overflow:visible}ion-item.addon-message[_ngcontent-%COMP%]::part(native){--inner-border-width:0px;--inner-padding-end:0px;padding:0;margin:0}ion-item.addon-message[_ngcontent-%COMP%]:hover{filter:drop-shadow(2px 2px 2px rgba(0,0,0,.3))}ion-item.addon-message[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]:only-child{display:inline}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem;margin-top:0;color:var(--ion-text-color)}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{display:block;--core-avatar-size:var(--addon-messages-avatar-size);margin:0}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:500;flex-grow:1;padding-left:.5rem;padding-right:.5rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}ion-item.addon-message[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{color:var(--addon-messages-message-note-text);font-size:var(--addon-messages-message-note-font-size);margin:0;padding:8px 0;align-self:flex-start}ion-item.addon-message[tappable][_ngcontent-%COMP%]:active{--message-background:var(--message-activated-background)}ion-item.addon-message[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0;padding:8px 0}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-text[_ngcontent-%COMP%]{display:inline-flex}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-text[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:var(--ion-text-color)}ion-item.addon-message[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{content:\"\";width:0;height:0;position:absolute;touch-action:none;bottom:0;border:.5rem solid transparent;border-bottom:.5rem solid var(--message-background)}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]{--message-background:var(--addon-messages-message-mine-bg);--message-activated-background:var(--addon-messages-message-mine-activated-bg);--message-alignment:flex-end}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{float:right;margin:2px -3px -2px 5px}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{float:left}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:5px;margin-inline-start:5px;-webkit-margin-end:-3px;margin-inline-end:-3px}}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{right:-8px;margin-right:-.5rem}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:unset;right:unset;left:-8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:-.5rem;margin-inline-end:-.5rem}}ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:-8px;margin-left:-.5rem}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:unset;right:unset;right:-8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:-.5rem;margin-inline-start:-.5rem}}ion-item.addon-message[_ngcontent-%COMP%]   .addon-messages-delete-button[_ngcontent-%COMP%]{min-height:0;line-height:normal;margin-top:0;margin-bottom:0;height:var(--a11y-min-target-size)!important;align-self:flex-end}ion-item.addon-message[_ngcontent-%COMP%]   .addon-messages-delete-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.4em;line-height:normal;color:var(--danger)}ion-item.addon-message.addon-message-no-user[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}']}),AddonModChatSessionMessagesPage})();var $=t(\"Y+03\"),j=t(\"vY5A\"),Q=t(\"EoRH\"),L=t(\"baaQ\"),q=t(\"46ml\"),N=t(\"CvRw\"),B=t(\"mWdr\");class chat_sessions_source_AddonModChatSessionsSource extends N.a{constructor(e,n,t){super(),this.showAll=!1,this.groupId=0,this.COURSE_ID=e,this.CHAT_ID=n,this.CM_ID=t}invalidateCache(){return Object(p.a)(this,void 0,void 0,(function*(){yield v.a.ignoreErrors(v.a.allPromises([B.a.invalidateActivityGroupInfo(this.CM_ID),D.a.invalidateSessions(this.CHAT_ID,this.groupId,this.showAll)]))}))}loadPageItems(){return Object(p.a)(this,void 0,void 0,(function*(){this.groupInfo=yield B.a.getActivityGroupInfo(this.CM_ID,!1),this.groupId=B.a.validateGroupId(this.groupId,this.groupInfo);const e=yield D.a.getSessions(this.CHAT_ID,this.groupId,this.showAll,{cmId:this.CM_ID}),n=[],t=e.map((e=>(e.duration=e.sessionend-e.sessionstart,e.sessionusers.forEach((e=>{n.push(this.loadUserFullname(e))})),e.allsessionusers=e.sessionusers,e.sessionusers.length>4&&(e.sessionusers=e.allsessionusers.slice(0,3)),e)));return yield Promise.all(n),{items:t}}))}getItemPath(e){return`${e.sessionstart}/${e.sessionend}`}getItemQueryParams(){return{chatId:this.CHAT_ID,groupId:this.groupId}}loadUserFullname(e){return Object(p.a)(this,void 0,void 0,(function*(){if(!e.userfullname)try{const n=yield F.a.getProfile(e.userid,this.COURSE_ID,!0);e.userfullname=n.fullname}catch(n){e.userfullname=I.M.instant(\"core.deleteduser\")+\" \"+e.userid}}))}}var W=t(\"3Pt+\"),G=t(\"llyR\");function AddonModChatSessionsPage_ion_item_15_ng_container_2_Template(e,n){1&e&&(c.Cc(0),c.pd(1),c.Pc(2,\"translate\"),c.Bc()),2&e&&(c.lc(1),c.qd(c.Qc(2,1,\"core.groupsseparate\")))}function AddonModChatSessionsPage_ion_item_15_ng_container_3_Template(e,n){1&e&&(c.Cc(0),c.pd(1),c.Pc(2,\"translate\"),c.Bc()),2&e&&(c.lc(1),c.qd(c.Qc(2,1,\"core.groupsvisible\")))}function AddonModChatSessionsPage_ion_item_15_ion_select_option_6_Template(e,n){if(1&e&&(c.Ec(0,\"ion-select-option\",14),c.pd(1),c.Dc()),2&e){const e=n.$implicit;c.Vc(\"value\",e.id),c.lc(1),c.rd(\" \",e.name,\" \")}}const sessions_c0=function(e){return{header:e}};function AddonModChatSessionsPage_ion_item_15_Template(e,n){if(1&e){const e=c.Fc();c.Ec(0,\"ion-item\",9),c.Ec(1,\"ion-label\",10),c.nd(2,AddonModChatSessionsPage_ion_item_15_ng_container_2_Template,3,3,\"ng-container\",11),c.nd(3,AddonModChatSessionsPage_ion_item_15_ng_container_3_Template,3,3,\"ng-container\",11),c.Dc(),c.Ec(4,\"ion-select\",12),c.Mc(\"ngModelChange\",(function AddonModChatSessionsPage_ion_item_15_Template_ion_select_ngModelChange_4_listener(n){c.fd(e);return c.Oc().groupId=n}))(\"ionChange\",(function AddonModChatSessionsPage_ion_item_15_Template_ion_select_ionChange_4_listener(){c.fd(e);return c.Oc().reloadSessions()})),c.Pc(5,\"translate\"),c.nd(6,AddonModChatSessionsPage_ion_item_15_ion_select_option_6_Template,2,2,\"ion-select-option\",13),c.Dc(),c.Dc()}if(2&e){const e=c.Oc();c.lc(2),c.Vc(\"ngIf\",e.groupInfo.separateGroups),c.lc(1),c.Vc(\"ngIf\",e.groupInfo.visibleGroups),c.lc(1),c.Vc(\"ngModel\",e.groupId)(\"interfaceOptions\",c.ad(7,sessions_c0,c.Qc(5,5,\"core.group\"))),c.lc(2),c.Vc(\"ngForOf\",e.groupInfo.groups)}}function AddonModChatSessionsPage_ion_card_21_p_6_Template(e,n){if(1&e&&(c.Ec(0,\"p\"),c.pd(1),c.Pc(2,\"coreDuration\"),c.Dc()),2&e){const e=c.Oc().$implicit;c.lc(1),c.qd(c.Qc(2,1,e.duration))}}function AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template(e,n){if(1&e&&(c.Ec(0,\"span\"),c.pd(1),c.Dc()),2&e){const e=c.Oc().$implicit;c.lc(1),c.rd(\"(\",e.messagecount,\")\")}}function AddonModChatSessionsPage_ion_card_21_ion_item_8_Template(e,n){if(1&e&&(c.Ec(0,\"ion-item\"),c.Ec(1,\"ion-label\"),c.pd(2),c.nd(3,AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template,2,1,\"span\",11),c.Dc(),c.Dc()),2&e){const e=n.$implicit;c.lc(2),c.rd(\" \",e.userfullname,\" \"),c.lc(1),c.Vc(\"ngIf\",e.messagecount)}}function AddonModChatSessionsPage_ion_card_21_ion_button_9_Template(e,n){if(1&e){const e=c.Fc();c.Ec(0,\"ion-button\",20),c.Mc(\"click\",(function AddonModChatSessionsPage_ion_card_21_ion_button_9_Template_ion_button_click_0_listener(n){c.fd(e);const t=c.Oc().$implicit;return c.Oc().showMoreUsers(t,n)})),c.pd(1),c.Pc(2,\"translate\"),c.Dc()}2&e&&(c.lc(1),c.rd(\" \",c.Qc(2,1,\"core.showmore\"),\" \"))}function AddonModChatSessionsPage_ion_card_21_Template(e,n){if(1&e){const e=c.Fc();c.Ec(0,\"ion-card\",15),c.Mc(\"click\",(function AddonModChatSessionsPage_ion_card_21_Template_ion_card_click_0_listener(){c.fd(e);const t=n.$implicit;return c.Oc().sessions.select(t)})),c.Ec(1,\"ion-item\",16),c.Ec(2,\"ion-label\"),c.Ec(3,\"p\",17),c.pd(4),c.Pc(5,\"coreFormatDate\"),c.Dc(),c.nd(6,AddonModChatSessionsPage_ion_card_21_p_6_Template,3,3,\"p\",11),c.Dc(),c.Dc(),c.Ec(7,\"ion-card-content\"),c.nd(8,AddonModChatSessionsPage_ion_card_21_ion_item_8_Template,4,2,\"ion-item\",18),c.Dc(),c.nd(9,AddonModChatSessionsPage_ion_card_21_ion_button_9_Template,3,3,\"ion-button\",19),c.Dc()}if(2&e){const e=n.$implicit,t=c.Oc();c.qc(\"addon-mod-chat-session-show-more\",e.sessionusers.length<e.allsessionusers.length),c.mc(\"aria-current\",t.sessions.getItemAriaCurrent(e)),c.lc(4),c.qd(c.Qc(5,7,1e3*e.sessionstart)),c.lc(2),c.Vc(\"ngIf\",e.duration),c.lc(2),c.Vc(\"ngForOf\",e.sessionusers),c.lc(1),c.Vc(\"ngIf\",e.sessionusers.length<e.allsessionusers.length)}}function AddonModChatSessionsPage_core_empty_box_22_Template(e,n){1&e&&(c.zc(0,\"core-empty-box\",21),c.Pc(1,\"translate\")),2&e&&c.Vc(\"message\",c.Qc(1,1,\"addon.mod_chat.nosessionsfound\"))}let H=(()=>{class AddonModChatSessionsPage{constructor(){try{const e=P.a.getRequiredRouteNumberParam(\"courseId\"),n=P.a.getRequiredRouteNumberParam(\"chatId\"),t=P.a.getRequiredRouteNumberParam(\"cmId\"),o=L.a.getOrCreateSource(chat_sessions_source_AddonModChatSessionsSource,[e,n,t]);this.sessions=new Q.a(o,AddonModChatSessionsPage)}catch(e){return O.a.showErrorModal(e),P.a.back(),void 0}}get groupId(){return this.sessions.getSource().groupId}set groupId(e){this.sessions.getSource().groupId=e}get showAll(){return this.sessions.getSource().showAll}set showAll(e){this.sessions.getSource().showAll=e}get groupInfo(){return this.sessions.getSource().groupInfo}ngAfterViewInit(){return Object(p.a)(this,void 0,void 0,(function*(){yield this.fetchSessions(),this.sessions.start(this.splitView)}))}fetchSessions(){return Object(p.a)(this,void 0,void 0,(function*(){try{yield this.sessions.load()}catch(e){O.a.showErrorModalDefault(e,\"core.errorloadingcontent\",!0)}}))}reloadSessions(){return Object(p.a)(this,void 0,void 0,(function*(){const e=yield O.a.showModalLoading();try{yield this.sessions.reload()}catch(e){O.a.showErrorModalDefault(e,\"core.errorloadingcontent\",!0)}finally{e.dismiss()}}))}refreshSessions(e){return Object(p.a)(this,void 0,void 0,(function*(){try{this.sessions.getSource().setDirty(!0),yield this.sessions.getSource().invalidateCache(),yield this.fetchSessions()}finally{e.complete()}}))}showMoreUsers(e,n){e.allsessionusers&&(e.sessionusers=e.allsessionusers),n.stopPropagation()}ngOnDestroy(){this.sessions.destroy()}}return AddonModChatSessionsPage.ɵfac=function AddonModChatSessionsPage_Factory(e){return new(e||AddonModChatSessionsPage)},AddonModChatSessionsPage.ɵcmp=c.sc({type:AddonModChatSessionsPage,selectors:[[\"page-addon-mod-chat-sessions\"]],viewQuery:function AddonModChatSessionsPage_Query(e,n){var t;(1&e&&c.ud(q.a,!0),2&e)&&(c.dd(t=c.Nc())&&(n.splitView=t.first))},decls:23,vars:18,consts:[[\"slot\",\"start\"],[3,\"text\"],[\"slot\",\"fixed\",3,\"disabled\",\"ionRefresh\"],[3,\"pullingText\"],[3,\"hideUntil\"],[\"class\",\"ion-text-wrap core-group-selector\",4,\"ngIf\"],[3,\"ngModel\",\"ngModelChange\",\"ionChange\"],[\"button\",\"\",3,\"addon-mod-chat-session-show-more\",\"click\",4,\"ngFor\",\"ngForOf\"],[\"icon\",\"far-comments\",3,\"message\",4,\"ngIf\"],[1,\"ion-text-wrap\",\"core-group-selector\"],[\"id\",\"addon-chat-groupslabel\"],[4,\"ngIf\"],[\"aria-labelledby\",\"addon-chat-groupslabel\",\"interface\",\"action-sheet\",3,\"ngModel\",\"interfaceOptions\",\"ngModelChange\",\"ionChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"],[\"button\",\"\",3,\"click\"],[1,\"ion-text-wrap\"],[1,\"item-heading\"],[4,\"ngFor\",\"ngForOf\"],[\"fill\",\"clear\",\"expand\",\"block\",3,\"click\",4,\"ngIf\"],[\"fill\",\"clear\",\"expand\",\"block\",3,\"click\"],[\"icon\",\"far-comments\",3,\"message\"]],template:function AddonModChatSessionsPage_Template(e,n){1&e&&(c.Ec(0,\"ion-header\"),c.Ec(1,\"ion-toolbar\"),c.Ec(2,\"ion-buttons\",0),c.zc(3,\"ion-back-button\",1),c.Pc(4,\"translate\"),c.Dc(),c.Ec(5,\"ion-title\"),c.Ec(6,\"h1\"),c.pd(7),c.Pc(8,\"translate\"),c.Dc(),c.Dc(),c.Dc(),c.Dc(),c.Ec(9,\"ion-content\"),c.Ec(10,\"core-split-view\"),c.Ec(11,\"ion-refresher\",2),c.Mc(\"ionRefresh\",(function AddonModChatSessionsPage_Template_ion_refresher_ionRefresh_11_listener(e){return n.refreshSessions(e.target)})),c.zc(12,\"ion-refresher-content\",3),c.Pc(13,\"translate\"),c.Dc(),c.Ec(14,\"core-loading\",4),c.nd(15,AddonModChatSessionsPage_ion_item_15_Template,7,9,\"ion-item\",5),c.Ec(16,\"ion-item\"),c.Ec(17,\"ion-label\"),c.pd(18),c.Pc(19,\"translate\"),c.Dc(),c.Ec(20,\"ion-toggle\",6),c.Mc(\"ngModelChange\",(function AddonModChatSessionsPage_Template_ion_toggle_ngModelChange_20_listener(e){return n.showAll=e}))(\"ionChange\",(function AddonModChatSessionsPage_Template_ion_toggle_ionChange_20_listener(){return n.reloadSessions()})),c.Dc(),c.Dc(),c.nd(21,AddonModChatSessionsPage_ion_card_21_Template,10,9,\"ion-card\",7),c.nd(22,AddonModChatSessionsPage_core_empty_box_22_Template,2,3,\"core-empty-box\",8),c.Dc(),c.Dc(),c.Dc()),2&e&&(c.lc(3),c.Vc(\"text\",c.Qc(4,10,\"core.back\")),c.lc(4),c.qd(c.Qc(8,12,\"addon.mod_chat.chatreport\")),c.lc(4),c.Vc(\"disabled\",!n.sessions.loaded),c.lc(1),c.Wc(\"pullingText\",c.Qc(13,14,\"core.pulltorefresh\")),c.lc(2),c.Vc(\"hideUntil\",n.sessions.loaded),c.lc(1),c.Vc(\"ngIf\",n.groupInfo&&(n.groupInfo.separateGroups||n.groupInfo.visibleGroups)),c.lc(3),c.qd(c.Qc(19,16,\"addon.mod_chat.showincompletesessions\")),c.lc(2),c.Vc(\"ngModel\",n.showAll),c.lc(1),c.Vc(\"ngForOf\",n.sessions.items),c.lc(1),c.Vc(\"ngIf\",n.sessions.empty))},directives:[r.C,r.Ab,r.m,r.h,r.i,r.yb,m.a,r.v,q.a,r.bb,r.cb,T.a,y.t,r.I,r.O,r.zb,r.d,W.r,W.u,y.s,r.lb,r.Ob,r.mb,r.n,r.o,E.a,r.l,R.a],pipes:[_.d,V.a,G.a],encapsulation:2}),AddonModChatSessionsPage})();var Y=t(\"MLi9\");const J=[{path:\":courseId/:cmId\",component:h},{path:\":courseId/:cmId/chat\",component:z,canDeactivate:[Y.a]}],X=[...J,{path:\":courseId/:cmId/sessions\",component:H},{path:\":courseId/:cmId/sessions/:sessionStart/:sessionEnd\",component:U}],K=[...J,{path:\":courseId/:cmId/sessions\",component:H,children:[{path:\":sessionStart/:sessionEnd\",component:U}]}],Z=[...Object(j.c)(X,(()=>$.a.isMobile)),...Object(j.c)(K,(()=>$.a.isTablet))];let ee=(()=>{class AddonModChatLazyModule{}return AddonModChatLazyModule.ɵmod=c.wc({type:AddonModChatLazyModule}),AddonModChatLazyModule.ɵinj=c.vc({factory:function AddonModChatLazyModule_Factory(e){return new(e||AddonModChatLazyModule)},imports:[[o.m.forChild(Z),s.a,a.a]]}),AddonModChatLazyModule})();void((\"undefined\"==typeof ngJitMode||ngJitMode)&&c.kd(ee,{declarations:[h,z,H,U],imports:[o.m,s.a,a.a]}))}}]);","name":"53.e47db34db0253d0a63a2.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[53],{\n\n/***/ \"IODR\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"AddonModChatLazyModule\", function() { return /* binding */ chat_lazy_module_AddonModChatLazyModule; });\n\n// EXTERNAL MODULE: ./node_modules/@angular/router/__ivy_ngcc__/fesm2015/router.js + 14 modules\nvar router = __webpack_require__(\"tyNb\");\n\n// EXTERNAL MODULE: ./src/core/shared.module.ts + 3 modules\nvar shared_module = __webpack_require__(\"L3Fv\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/components/components.module.ts\nvar components_module = __webpack_require__(\"ef6k\");\n\n// EXTERNAL MODULE: ./src/core/features/course/classes/main-activity-page.ts\nvar main_activity_page = __webpack_require__(\"ghUQ\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/components/index/index.ts\nvar components_index = __webpack_require__(\"e1dt\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/core/__ivy_ngcc__/fesm2015/core.js + 4 modules\nvar core = __webpack_require__(\"fXoL\");\n\n// EXTERNAL MODULE: ./node_modules/@ionic/angular/__ivy_ngcc__/fesm2015/ionic-angular.js + 5 modules\nvar ionic_angular = __webpack_require__(\"TEn/\");\n\n// EXTERNAL MODULE: ./src/core/directives/collapsible-header.ts\nvar collapsible_header = __webpack_require__(\"4JiN\");\n\n// EXTERNAL MODULE: ./src/core/directives/format-text.ts\nvar format_text = __webpack_require__(\"hMzs\");\n\n// EXTERNAL MODULE: ./src/core/directives/content.ts\nvar content = __webpack_require__(\"nt/U\");\n\n// EXTERNAL MODULE: ./node_modules/@ngx-translate/core/__ivy_ngcc__/fesm2015/ngx-translate-core.js + 8 modules\nvar ngx_translate_core = __webpack_require__(\"sYmb\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/pages/index/index.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n/**\n * Page that displays a chat.\n */\nlet index_AddonModChatIndexPage = /*@__PURE__*/ (() => {\n    class AddonModChatIndexPage extends main_activity_page[\"a\" /* CoreCourseModuleMainActivityPage */] {\n    }\n    AddonModChatIndexPage.ɵfac = function AddonModChatIndexPage_Factory(t) { return ɵAddonModChatIndexPage_BaseFactory(t || AddonModChatIndexPage); };\n    AddonModChatIndexPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModChatIndexPage, selectors: [[\"page-addon-mod-chat-index\"]], viewQuery: function AddonModChatIndexPage_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"ud\" /* ɵɵviewQuery */](components_index[\"a\" /* AddonModChatIndexComponent */], true);\n            }\n            if (rf & 2) {\n                var _t;\n                core[\"dd\" /* ɵɵqueryRefresh */](_t = core[\"Nc\" /* ɵɵloadQuery */]()) && (ctx.activityComponent = _t.first);\n            }\n        }, features: [core[\"ic\" /* ɵɵInheritDefinitionFeature */]], decls: 14, vars: 12, consts: [[\"collapsible\", \"\"], [\"slot\", \"start\"], [3, \"text\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [\"slot\", \"end\"], [1, \"limited-width\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"module\", \"courseId\", \"dataRetrieved\"]], template: function AddonModChatIndexPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\", 0);\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 1);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 2);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"zc\" /* ɵɵelement */](7, \"core-format-text\", 3);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"zc\" /* ɵɵelement */](8, \"ion-buttons\", 4);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-content\", 5);\n                core[\"Ec\" /* ɵɵelementStart */](10, \"ion-refresher\", 6);\n                core[\"Mc\" /* ɵɵlistener */](\"ionRefresh\", function AddonModChatIndexPage_Template_ion_refresher_ionRefresh_10_listener($event) { return ctx.activityComponent == null ? null : ctx.activityComponent.doRefresh($event.target); });\n                core[\"zc\" /* ɵɵelement */](11, \"ion-refresher-content\", 7);\n                core[\"Pc\" /* ɵɵpipe */](12, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](13, \"addon-mod-chat-index\", 8);\n                core[\"Mc\" /* ɵɵlistener */](\"dataRetrieved\", function AddonModChatIndexPage_Template_addon_mod_chat_index_dataRetrieved_13_listener($event) { return ctx.updateData($event); });\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 8, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", ctx.title)(\"contextInstanceId\", ctx.module == null ? null : ctx.module.id)(\"courseId\", ctx.courseId);\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", ctx.activityComponent == null ? null : ctx.activityComponent.showLoading);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Wc\" /* ɵɵpropertyInterpolate */](\"pullingText\", core[\"Qc\" /* ɵɵpipeBind1 */](12, 10, \"core.pulltorefresh\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"module\", ctx.module)(\"courseId\", ctx.courseId);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], collapsible_header[\"b\" /* CoreCollapsibleHeaderDirective */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], format_text[\"a\" /* CoreFormatTextDirective */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], ionic_angular[\"bb\" /* IonRefresher */], ionic_angular[\"cb\" /* IonRefresherContent */], components_index[\"a\" /* AddonModChatIndexComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */]], encapsulation: 2 });\n    return AddonModChatIndexPage;\n})();\nconst ɵAddonModChatIndexPage_BaseFactory = /*@__PURE__*/ core[\"Gc\" /* ɵɵgetInheritedFactory */](index_AddonModChatIndexPage);\n\n// EXTERNAL MODULE: ./node_modules/tslib/tslib.es6.js\nvar tslib_es6 = __webpack_require__(\"mrSG\");\n\n// EXTERNAL MODULE: ./src/core/components/animations.ts\nvar animations = __webpack_require__(\"MUy3\");\n\n// EXTERNAL MODULE: ./src/core/components/send-message-form/send-message-form.ts\nvar send_message_form = __webpack_require__(\"O4u7\");\n\n// EXTERNAL MODULE: ./src/core/services/app.ts + 1 modules\nvar app = __webpack_require__(\"nvXB\");\n\n// EXTERNAL MODULE: ./src/core/services/navigator.ts\nvar services_navigator = __webpack_require__(\"pHTc\");\n\n// EXTERNAL MODULE: ./src/core/services/sites.ts\nvar sites = __webpack_require__(\"9+EE\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/dom.ts + 2 modules\nvar dom = __webpack_require__(\"3LXp\");\n\n// EXTERNAL MODULE: ./src/core/services/utils/utils.ts\nvar utils = __webpack_require__(\"bFG1\");\n\n// EXTERNAL MODULE: ./src/core/singletons/index.ts\nvar singletons = __webpack_require__(\"j3ag\");\n\n// EXTERNAL MODULE: ./src/core/singletons/events.ts\nvar events = __webpack_require__(\"fjkH\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/components/users-modal/users-modal.ts\nvar users_modal = __webpack_require__(\"5E3q\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/services/chat.ts\nvar chat = __webpack_require__(\"g4DX\");\n\n// EXTERNAL MODULE: ./src/addons/mod/chat/services/chat-helper.ts\nvar chat_helper = __webpack_require__(\"btSF\");\n\n// EXTERNAL MODULE: ./node_modules/@angular/common/__ivy_ngcc__/fesm2015/common.js\nvar common = __webpack_require__(\"ofXK\");\n\n// EXTERNAL MODULE: ./src/core/components/loading/loading.ts\nvar loading = __webpack_require__(\"PgjG\");\n\n// EXTERNAL MODULE: ./src/core/directives/update-non-reactive-attributes.ts\nvar update_non_reactive_attributes = __webpack_require__(\"ACYt\");\n\n// EXTERNAL MODULE: ./src/core/directives/fa-icon.ts\nvar fa_icon = __webpack_require__(\"3CSS\");\n\n// EXTERNAL MODULE: ./src/core/components/user-avatar/user-avatar.ts\nvar user_avatar = __webpack_require__(\"FeAf\");\n\n// EXTERNAL MODULE: ./src/core/components/empty-box/empty-box.ts\nvar empty_box = __webpack_require__(\"r8G5\");\n\n// EXTERNAL MODULE: ./src/core/pipes/format-date.ts\nvar format_date = __webpack_require__(\"uYHD\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/pages/chat/chat.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonModChatChatPage_ion_button_9_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r7 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 14);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModChatChatPage_ion_button_9_Template_ion_button_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r7); const ctx_r6 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r6.showChatUsers(); });\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 15);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"mc\" /* ɵɵattribute */](\"aria-label\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"core.users\"));\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_p_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"p\", 19);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"coreFormatDate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](2, 1, message_r8.timestamp * 1000, \"strftimedayshort\"), \" \");\n    }\n}\nconst _c0 = function (a0) { return { $a: a0 }; };\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 26);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 27);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageenter\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.userfullname)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 28);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 29);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageexit\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.userfullname)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 30);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 31);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messagebeepseveryone\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.userfullname)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 30);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 31);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messagebeepsyou\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.userfullname)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 32);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 31);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r8.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageyoubeep\", core[\"ad\" /* ɵɵpureFunction1 */](8, _c0, message_r8.beepWho)), \" \");\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r28 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 33);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 34);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Ec\" /* ɵɵelementStart */](5, \"strong\");\n        core[\"pd\" /* ɵɵtext */](6);\n        core[\"Ec\" /* ɵɵelementStart */](7, \"core-format-text\", 35);\n        core[\"Mc\" /* ɵɵlistener */](\"afterRender\", function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template_core_format_text_afterRender_7_listener() { core[\"fd\" /* ɵɵrestoreView */](_r28); const last_r10 = core[\"Oc\" /* ɵɵnextContext */](2).last; const ctx_r26 = core[\"Oc\" /* ɵɵnextContext */](); return last_r10 && ctx_r26.scrollToBottom(); });\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        const ctx_r20 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 5, message_r8.timestamp * 1000, \"strftimetime\"), \" \");\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", message_r8.userfullname, \" \");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"text\", message_r8.message)(\"contextInstanceId\", ctx_r20.cmId)(\"courseId\", ctx_r20.courseId);\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_div_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\", 20);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template, 6, 10, \"ion-badge\", 21);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template, 6, 10, \"ion-badge\", 22);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template, 6, 10, \"ion-badge\", 23);\n        core[\"nd\" /* ɵɵtemplate */](4, AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template, 6, 10, \"ion-badge\", 23);\n        core[\"nd\" /* ɵɵtemplate */](5, AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template, 6, 10, \"ion-badge\", 24);\n        core[\"nd\" /* ɵɵtemplate */](6, AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template, 8, 8, \"ion-badge\", 25);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r12 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.system && message_r8.message == \"enter\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.system && message_r8.message == \"exit\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.beep == \"all\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.userid != ctx_r12.currentUserId && message_r8.beep == ctx_r12.currentUserId);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.userid == ctx_r12.currentUserId && message_r8.beep && message_r8.beep != \"all\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !message_r8.system && !message_r8.beep);\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_ion_item_3_h2_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"h2\", 40);\n        core[\"zc\" /* ɵɵelement */](1, \"core-user-avatar\", 41);\n        core[\"Ec\" /* ɵɵelementStart */](2, \"div\");\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"user\", message_r8)(\"linkProfile\", false);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"qd\" /* ɵɵtextInterpolate */](message_r8.userfullname);\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_ion_item_3_div_8_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"div\", 42);\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_ion_item_3_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r36 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-item\", 36);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-label\");\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatChatPage_ng_container_13_ion_item_3_h2_2_Template, 4, 3, \"h2\", 37);\n        core[\"Ec\" /* ɵɵelementStart */](3, \"div\", 38);\n        core[\"Ec\" /* ɵɵelementStart */](4, \"core-format-text\", 35);\n        core[\"Mc\" /* ɵɵlistener */](\"afterRender\", function AddonModChatChatPage_ng_container_13_ion_item_3_Template_core_format_text_afterRender_4_listener() { core[\"fd\" /* ɵɵrestoreView */](_r36); const last_r10 = core[\"Oc\" /* ɵɵnextContext */]().last; const ctx_r34 = core[\"Oc\" /* ɵɵnextContext */](); return last_r10 && ctx_r34.scrollToBottom(); });\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](5, \"ion-note\", 3);\n        core[\"pd\" /* ɵɵtext */](6);\n        core[\"Pc\" /* ɵɵpipe */](7, \"coreFormatDate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](8, AddonModChatChatPage_ng_container_13_ion_item_3_div_8_Template, 1, 0, \"div\", 39);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r13 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"qc\" /* ɵɵclassProp */](\"addon-message-mine\", message_r8.userid == ctx_r13.currentUserId)(\"addon-message-not-mine\", message_r8.userid != ctx_r13.currentUserId)(\"addon-message-no-user\", !message_r8.showUserData);\n        core[\"Vc\" /* ɵɵproperty */](\"@coreSlideInOut\", message_r8.userid == ctx_r13.currentUserId ? \"\" : \"fromLeft\");\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.showUserData);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"text\", message_r8.message)(\"contextInstanceId\", ctx_r13.cmId)(\"courseId\", ctx_r13.courseId);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Rc\" /* ɵɵpipeBind2 */](7, 13, message_r8.timestamp * 1000, \"strftimetime\"));\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.showTail);\n    }\n}\nfunction AddonModChatChatPage_ng_container_13_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonModChatChatPage_ng_container_13_p_1_Template, 3, 4, \"p\", 16);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatChatPage_ng_container_13_div_2_Template, 7, 6, \"div\", 17);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatChatPage_ng_container_13_ion_item_3_Template, 9, 16, \"ion-item\", 18);\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const message_r8 = ctx.$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.showDate);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r8.special);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !message_r8.special);\n    }\n}\nfunction AddonModChatChatPage_core_empty_box_14_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-empty-box\", 43);\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n    }\n    if (rf & 2) {\n        core[\"Vc\" /* ɵɵproperty */](\"message\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"addon.mod_chat.nomessages\"));\n    }\n}\nfunction AddonModChatChatPage_p_17_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"p\", 44);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"addon.mod_chat.mustbeonlinetosendmessages\"), \" \");\n    }\n}\nfunction AddonModChatChatPage_core_send_message_form_18_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r39 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"core-send-message-form\", 45);\n        core[\"Mc\" /* ɵɵlistener */](\"onSubmit\", function AddonModChatChatPage_core_send_message_form_18_Template_core_send_message_form_onSubmit_0_listener($event) { core[\"fd\" /* ɵɵrestoreView */](_r39); const ctx_r38 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r38.sendMessage($event); });\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r4 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"Vc\" /* ɵɵproperty */](\"sendDisabled\", ctx_r4.sending)(\"message\", ctx_r4.newMessage)(\"placeholder\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 3, \"addon.messages.newmessage\"));\n    }\n}\nfunction AddonModChatChatPage_ion_button_19_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r41 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 46);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModChatChatPage_ion_button_19_Template_ion_button_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r41); const ctx_r40 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r40.reconnect(); });\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.login.reconnect\"), \" \");\n    }\n}\n/**\n * Page that displays a chat session.\n */\nlet chat_AddonModChatChatPage = /*@__PURE__*/ (() => {\n    class AddonModChatChatPage {\n        constructor() {\n            this.loaded = false;\n            this.title = '';\n            this.messages = [];\n            this.sending = false;\n            this.lastTime = 0;\n            this.oldContentHeight = 0;\n            this.viewDestroyed = false;\n            this.pollingRunning = false;\n            this.users = [];\n            this.currentUserId = sites[\"b\" /* CoreSites */].getCurrentSiteUserId();\n            this.isOnline = app[\"a\" /* CoreApp */].isOnline();\n            this.onlineSubscription = singletons[\"B\" /* Network */].onChange().subscribe(() => {\n                // Execute the callback in the Angular zone, so change detection doesn't stop working.\n                singletons[\"C\" /* NgZone */].run(() => {\n                    this.isOnline = app[\"a\" /* CoreApp */].isOnline();\n                });\n            });\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnInit() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    this.courseId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('courseId');\n                    this.cmId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('cmId');\n                    this.chatId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('chatId');\n                    this.title = services_navigator[\"a\" /* CoreNavigator */].getRouteParam('title') || '';\n                    yield this.loginUser();\n                    yield this.fetchMessages();\n                    this.startPolling();\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'addon.mod_chat.errorwhileconnecting', true);\n                    services_navigator[\"a\" /* CoreNavigator */].back();\n                }\n                finally {\n                    this.loaded = true;\n                }\n            });\n        }\n        /**\n         * Runs when the page has fully entered and is now the active page.\n         * This event will fire, whether it was the first load or a cached page.\n         */\n        ionViewDidEnter() {\n            this.startPolling();\n        }\n        /**\n         * Runs when the page is about to leave and no longer be the active page.\n         */\n        ionViewWillLeave() {\n            events[\"b\" /* CoreEvents */].trigger(events[\"b\" /* CoreEvents */].ACTIVITY_DATA_SENT, { module: 'chat' });\n            this.stopPolling();\n        }\n        /**\n         * Convenience function to login the user.\n         *\n         * @return Promise resolved when done.\n         */\n        loginUser() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                this.sessionId = yield chat[\"a\" /* AddonModChat */].loginUser(this.chatId);\n            });\n        }\n        /**\n         * Convenience function to fetch chat messages.\n         *\n         * @return Promise resolved when done.\n         */\n        fetchMessages() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const messagesInfo = yield chat[\"a\" /* AddonModChat */].getLatestMessages(this.sessionId, this.lastTime);\n                this.lastTime = messagesInfo.chatnewlasttime || 0;\n                const messages = yield chat[\"a\" /* AddonModChat */].getMessagesUserData(messagesInfo.messages, this.courseId);\n                if (!messages.length) {\n                    // No messages yet, nothing else to do.\n                    return;\n                }\n                const previousLength = this.messages.length;\n                this.messages = this.messages.concat(messages);\n                // Calculate which messages need to display the date or user data.\n                for (let index = previousLength; index < this.messages.length; index++) {\n                    const prevMessage = index > 0 ? this.messages[index - 1] : undefined;\n                    this.messages[index] = chat_helper[\"a\" /* AddonModChatHelper */].formatMessage(this.currentUserId, this.messages[index], prevMessage);\n                    const message = this.messages[index];\n                    if (message.beep && message.beep != String(this.currentUserId)) {\n                        this.loadMessageBeepWho(message);\n                    }\n                }\n                this.messages[this.messages.length - 1].showTail = true;\n                // New messages or beeps, scroll to bottom.\n                this.scrollToBottom();\n            });\n        }\n        loadMessageBeepWho(message) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                message.beepWho = yield this.getUserFullname(message.beep);\n            });\n        }\n        /**\n         * Display the chat users modal.\n         */\n        showChatUsers() {\n            var _a;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                // Create the toc modal.\n                const modalData = yield dom[\"a\" /* CoreDomUtils */].openSideModal({\n                    component: users_modal[\"a\" /* AddonModChatUsersModalComponent */],\n                    componentProps: {\n                        sessionId: this.sessionId,\n                        cmId: this.cmId,\n                    },\n                });\n                if (modalData) {\n                    if (modalData.talkTo) {\n                        this.newMessage = `To ${modalData.talkTo}: ` + (((_a = this.sendMessageForm) === null || _a === void 0 ? void 0 : _a.message) || '');\n                    }\n                    if (modalData.beepTo) {\n                        this.sendMessage('', modalData.beepTo);\n                    }\n                    this.users = modalData.users;\n                }\n            });\n        }\n        /**\n         * Get the user fullname for a beep.\n         *\n         * @param id User Id before parsing.\n         * @return User fullname.\n         */\n        getUserFullname(id) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const idNumber = parseInt(id, 10);\n                if (isNaN(idNumber)) {\n                    return id;\n                }\n                const user = this.users.find((user) => user.id == idNumber);\n                if (user) {\n                    return user.fullname;\n                }\n                try {\n                    const data = yield chat[\"a\" /* AddonModChat */].getChatUsers(this.sessionId, { cmId: this.cmId });\n                    this.users = data.users;\n                    const user = this.users.find((user) => user.id == idNumber);\n                    if (user) {\n                        return user.fullname;\n                    }\n                    return id;\n                }\n                catch (error) {\n                    // Ignore errors.\n                    return id;\n                }\n            });\n        }\n        /**\n         * Start the polling to get chat messages periodically.\n         */\n        startPolling() {\n            // We already have the polling in place.\n            if (this.polling) {\n                return;\n            }\n            // Start polling.\n            this.polling = window.setInterval(() => {\n                utils[\"a\" /* CoreUtils */].ignoreErrors(this.fetchMessagesInterval());\n            }, chat[\"b\" /* AddonModChatProvider */].POLL_INTERVAL);\n        }\n        /**\n         * Stop polling for messages.\n         */\n        stopPolling() {\n            clearInterval(this.polling);\n            this.polling = undefined;\n        }\n        /**\n         * Convenience function to be called every certain time to fetch chat messages.\n         *\n         * @return Promise resolved when done.\n         */\n        fetchMessagesInterval() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.isOnline || this.pollingRunning) {\n                    // Obviously we cannot check for new messages when the app is offline.\n                    return;\n                }\n                this.pollingRunning = true;\n                try {\n                    yield this.fetchMessages();\n                }\n                catch (_a) {\n                    try {\n                        // Try to login, it might have failed because the session expired.\n                        yield this.loginUser();\n                        yield this.fetchMessages();\n                    }\n                    catch (error) {\n                        // Fail again. Stop polling if needed.\n                        this.stopPolling();\n                        dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'addon.mod_chat.errorwhileretrievingmessages', true);\n                        throw error;\n                    }\n                }\n                finally {\n                    this.pollingRunning = false;\n                }\n            });\n        }\n        /**\n         * Send a message to the chat.\n         *\n         * @param text Text of the nessage.\n         * @param beep ID of the user to beep.\n         */\n        sendMessage(text, beep = 0) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.isOnline) {\n                    // Silent error, the view should prevent this.\n                    return;\n                }\n                else if (beep === 0 && !text.trim()) {\n                    // Silent error.\n                    return;\n                }\n                this.sending = true;\n                try {\n                    yield chat[\"a\" /* AddonModChat */].sendMessage(this.sessionId, text, beep);\n                    // Update messages to show the sent message.\n                    utils[\"a\" /* CoreUtils */].ignoreErrors(this.fetchMessagesInterval());\n                }\n                catch (error) {\n                    // Only close the keyboard if an error happens, we want the user to be able to send multiple\n                    // messages without the keyboard being closed.\n                    app[\"a\" /* CoreApp */].closeKeyboard();\n                    this.newMessage = text;\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'addon.mod_chat.errorwhilesendingmessage', true);\n                }\n                finally {\n                    this.sending = false;\n                }\n            });\n        }\n        /**\n         * Try to reconnect.\n         *\n         * @return Promise resolved when done.\n         */\n        reconnect() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const modal = yield dom[\"a\" /* CoreDomUtils */].showModalLoading();\n                try {\n                    // Call startPolling would take a while for the first execution, so we'll execute it manually to check if it works now.\n                    yield this.fetchMessagesInterval();\n                    // It works, start the polling again.\n                    this.startPolling();\n                }\n                catch (_a) {\n                    // Ignore errors.\n                }\n                finally {\n                    modal.dismiss();\n                }\n            });\n        }\n        /**\n         * Scroll bottom when render has finished.\n         */\n        scrollToBottom() {\n            var _a;\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                // Need a timeout to leave time to the view to be rendered.\n                yield utils[\"a\" /* CoreUtils */].nextTick();\n                if (!this.viewDestroyed) {\n                    (_a = this.content) === null || _a === void 0 ? void 0 : _a.scrollToBottom();\n                }\n            });\n        }\n        /**\n         * Check if we can leave the page or not.\n         *\n         * @return Resolved with true if we can leave it, rejected if not.\n         */\n        canLeave() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                if (!this.messages.some((message) => !message.special)) {\n                    return true;\n                }\n                // Modified, confirm user wants to go back.\n                yield dom[\"a\" /* CoreDomUtils */].showConfirm(singletons[\"M\" /* Translate */].instant('addon.mod_chat.confirmloss'));\n                return true;\n            });\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnDestroy() {\n            this.onlineSubscription && this.onlineSubscription.unsubscribe();\n            this.stopPolling();\n            this.viewDestroyed = true;\n        }\n    }\n    AddonModChatChatPage.ɵfac = function AddonModChatChatPage_Factory(t) { return new (t || AddonModChatChatPage)(); };\n    AddonModChatChatPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModChatChatPage, selectors: [[\"page-addon-mod-chat-chat\"]], viewQuery: function AddonModChatChatPage_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"ud\" /* ɵɵviewQuery */](ionic_angular[\"v\" /* IonContent */], true);\n                core[\"ud\" /* ɵɵviewQuery */](send_message_form[\"a\" /* CoreSendMessageFormComponent */], true);\n            }\n            if (rf & 2) {\n                var _t;\n                core[\"dd\" /* ɵɵqueryRefresh */](_t = core[\"Nc\" /* ɵɵloadQuery */]()) && (ctx.content = _t.first);\n                core[\"dd\" /* ɵɵqueryRefresh */](_t = core[\"Nc\" /* ɵɵloadQuery */]()) && (ctx.sendMessageForm = _t.first);\n            }\n        }, decls: 20, vars: 14, consts: [[\"slot\", \"start\"], [3, \"text\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [\"slot\", \"end\"], [\"fill\", \"clear\", 3, \"click\", 4, \"ngIf\"], [3, \"hideUntil\"], [\"aria-live\", \"polite\", 1, \"addon-messages-discussion-container\"], [4, \"ngFor\", \"ngForOf\"], [\"icon\", \"far-comments\", 3, \"message\", 4, \"ngIf\"], [1, \"footer-adjustable\"], [3, \"color\"], [\"class\", \"ion-text-center\", 4, \"ngIf\"], [3, \"sendDisabled\", \"message\", \"placeholder\", \"onSubmit\", 4, \"ngIf\"], [\"expand\", \"block\", \"fill\", \"outline\", 3, \"click\", 4, \"ngIf\"], [\"fill\", \"clear\", 3, \"click\"], [\"name\", \"fas-users\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [\"class\", \"ion-text-center addon-messages-date\", 4, \"ngIf\"], [\"class\", \"ion-text-center addon-mod_chat-notice\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap addon-message\", 3, \"addon-message-mine\", \"addon-message-not-mine\", \"addon-message-no-user\", 4, \"ngIf\"], [1, \"ion-text-center\", \"addon-messages-date\"], [1, \"ion-text-center\", \"addon-mod_chat-notice\"], [\"class\", \"ion-text-wrap\", \"color\", \"success\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"danger\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"primary\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"light\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"info\", 4, \"ngIf\"], [\"color\", \"success\", 1, \"ion-text-wrap\"], [\"name\", \"fas-sign-in-alt\", \"aria-hidden\", \"true\"], [\"color\", \"danger\", 1, \"ion-text-wrap\"], [\"name\", \"fas-sign-out-alt\", \"aria-hidden\", \"true\"], [\"color\", \"primary\", 1, \"ion-text-wrap\"], [\"name\", \"fas-bell\", \"aria-hidden\", \"true\"], [\"color\", \"light\", 1, \"ion-text-wrap\"], [\"color\", \"info\", 1, \"ion-text-wrap\"], [\"name\", \"fas-asterisk\", \"aria-hidden\", \"true\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\", \"afterRender\"], [1, \"ion-text-wrap\", \"addon-message\"], [\"class\", \"addon-message-user\", 4, \"ngIf\"], [1, \"addon-message-text\"], [\"class\", \"tail\", 4, \"ngIf\"], [1, \"addon-message-user\"], [\"slot\", \"start\", 3, \"user\", \"linkProfile\"], [1, \"tail\"], [\"icon\", \"far-comments\", 3, \"message\"], [1, \"ion-text-center\"], [3, \"sendDisabled\", \"message\", \"placeholder\", \"onSubmit\"], [\"expand\", \"block\", \"fill\", \"outline\", 3, \"click\"]], template: function AddonModChatChatPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"zc\" /* ɵɵelement */](7, \"core-format-text\", 2);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](8, \"ion-buttons\", 3);\n                core[\"nd\" /* ɵɵtemplate */](9, AddonModChatChatPage_ion_button_9_Template, 3, 3, \"ion-button\", 4);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](10, \"ion-content\");\n                core[\"Ec\" /* ɵɵelementStart */](11, \"core-loading\", 5);\n                core[\"Ec\" /* ɵɵelementStart */](12, \"ion-list\", 6);\n                core[\"nd\" /* ɵɵtemplate */](13, AddonModChatChatPage_ng_container_13_Template, 4, 3, \"ng-container\", 7);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"nd\" /* ɵɵtemplate */](14, AddonModChatChatPage_core_empty_box_14_Template, 2, 3, \"core-empty-box\", 8);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](15, \"ion-footer\", 9);\n                core[\"Ec\" /* ɵɵelementStart */](16, \"ion-toolbar\", 10);\n                core[\"nd\" /* ɵɵtemplate */](17, AddonModChatChatPage_p_17_Template, 3, 3, \"p\", 11);\n                core[\"nd\" /* ɵɵtemplate */](18, AddonModChatChatPage_core_send_message_form_18_Template, 2, 5, \"core-send-message-form\", 12);\n                core[\"nd\" /* ɵɵtemplate */](19, AddonModChatChatPage_ion_button_19_Template, 3, 3, \"ion-button\", 13);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 12, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", ctx.title)(\"contextInstanceId\", ctx.cmId)(\"courseId\", ctx.courseId);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx.messages);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !ctx.messages || ctx.messages.length <= 0);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"color\", ctx.isOnline && ctx.polling && ctx.loaded ? \"contrast\" : \"light\");\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !ctx.isOnline);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.isOnline && ctx.polling && ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.isOnline && !ctx.polling && ctx.loaded);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], format_text[\"a\" /* CoreFormatTextDirective */], common[\"t\" /* NgIf */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], loading[\"a\" /* CoreLoadingComponent */], ionic_angular[\"P\" /* IonList */], common[\"s\" /* NgForOf */], ionic_angular[\"A\" /* IonFooter */], update_non_reactive_attributes[\"a\" /* CoreUpdateNonReactiveAttributesDirective */], ionic_angular[\"l\" /* IonButton */], ionic_angular[\"D\" /* IonIcon */], fa_icon[\"a\" /* CoreFaIconDirective */], ionic_angular[\"k\" /* IonBadge */], ionic_angular[\"I\" /* IonItem */], ionic_angular[\"O\" /* IonLabel */], ionic_angular[\"W\" /* IonNote */], user_avatar[\"a\" /* CoreUserAvatarComponent */], empty_box[\"a\" /* CoreEmptyBoxComponent */], send_message_form[\"a\" /* CoreSendMessageFormComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */], format_date[\"a\" /* CoreFormatDatePipe */]], styles: [\".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}ion-item.addon-message[_ngcontent-%COMP%]{--message-background:var(--addon-messages-message-bg);--message-activated-background:var(--addon-messages-message-activated-bg);--message-alignment:flex-start;border:0;border-radius:var(--medium-radius);padding:0 8px;margin:8px;--background:var(--message-background);background:var(--message-background);align-self:var(--message-alignment);width:90%;max-width:var(--list-item-max-width);--min-height:var(--a11y-min-target-size);position:relative;transition:width .5s ease-in-out;overflow:visible}ion-item.addon-message[_ngcontent-%COMP%]::part(native){--inner-border-width:0px;--inner-padding-end:0px;padding:0;margin:0}ion-item.addon-message[_ngcontent-%COMP%]:hover{filter:drop-shadow(2px 2px 2px rgba(0,0,0,.3))}ion-item.addon-message[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]:only-child{display:inline}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem;margin-top:0;color:var(--ion-text-color)}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{display:block;--core-avatar-size:var(--addon-messages-avatar-size);margin:0}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:500;flex-grow:1;padding-left:.5rem;padding-right:.5rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}ion-item.addon-message[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{color:var(--addon-messages-message-note-text);font-size:var(--addon-messages-message-note-font-size);margin:0;padding:8px 0;align-self:flex-start}ion-item.addon-message[tappable][_ngcontent-%COMP%]:active{--message-background:var(--message-activated-background)}ion-item.addon-message[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0;padding:8px 0}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-text[_ngcontent-%COMP%]{display:inline-flex}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-text[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:var(--ion-text-color)}ion-item.addon-message[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{content:\\\"\\\";width:0;height:0;position:absolute;touch-action:none;bottom:0;border:.5rem solid transparent;border-bottom:.5rem solid var(--message-background)}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]{--message-background:var(--addon-messages-message-mine-bg);--message-activated-background:var(--addon-messages-message-mine-activated-bg);--message-alignment:flex-end}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{float:right;margin:2px -3px -2px 5px}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{float:left}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:5px;margin-inline-start:5px;-webkit-margin-end:-3px;margin-inline-end:-3px}}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{right:-8px;margin-right:-.5rem}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:unset;right:unset;left:-8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:-.5rem;margin-inline-end:-.5rem}}ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:-8px;margin-left:-.5rem}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:unset;right:unset;right:-8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:-.5rem;margin-inline-start:-.5rem}}ion-item.addon-message[_ngcontent-%COMP%]   .addon-messages-delete-button[_ngcontent-%COMP%]{min-height:0;line-height:normal;margin-top:0;margin-bottom:0;height:var(--a11y-min-target-size)!important;align-self:flex-end}ion-item.addon-message[_ngcontent-%COMP%]   .addon-messages-delete-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.4em;line-height:normal;color:var(--danger)}ion-item.addon-message.addon-message-no-user[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}\"], data: { animation: [animations[\"a\" /* CoreAnimations */].SLIDE_IN_OUT] } });\n    return AddonModChatChatPage;\n})();\n\n// EXTERNAL MODULE: ./src/core/features/user/services/user.ts\nvar services_user = __webpack_require__(\"4pns\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/pages/session-messages/session-messages.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\", 10);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"coreFormatDate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](2, 1, message_r1.timestamp * 1000, \"strftimedayshort\"), \" \");\n    }\n}\nconst session_messages_c0 = function (a0) { return { $a: a0 }; };\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 17);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 18);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageenter\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.userfullname)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 19);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 20);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageexit\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.userfullname)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 21);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 22);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messagebeepseveryone\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.userfullname)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 21);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 22);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messagebeepsyou\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.userfullname)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 23);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 22);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"sd\" /* ɵɵtextInterpolate2 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 2, message_r1.timestamp * 1000, \"strftimetime\"), \" \", core[\"Rc\" /* ɵɵpipeBind2 */](5, 5, \"addon.mod_chat.messageyoubeep\", core[\"ad\" /* ɵɵpureFunction1 */](8, session_messages_c0, message_r1.beepWho)), \" \");\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-badge\", 24);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"span\");\n        core[\"zc\" /* ɵɵelement */](2, \"ion-icon\", 25);\n        core[\"pd\" /* ɵɵtext */](3);\n        core[\"Pc\" /* ɵɵpipe */](4, \"coreFormatDate\");\n        core[\"Ec\" /* ɵɵelementStart */](5, \"strong\");\n        core[\"pd\" /* ɵɵtext */](6);\n        core[\"zc\" /* ɵɵelement */](7, \"core-format-text\", 26);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        const ctx_r12 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Rc\" /* ɵɵpipeBind2 */](4, 5, message_r1.timestamp * 1000, \"strftimetime\"), \" \");\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", message_r1.userfullname, \" \");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"text\", message_r1.message)(\"contextInstanceId\", ctx_r12.cmId)(\"courseId\", ctx_r12.courseId);\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_div_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\", 11);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template, 6, 10, \"ion-badge\", 12);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template, 6, 10, \"ion-badge\", 13);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template, 6, 10, \"ion-badge\", 14);\n        core[\"nd\" /* ɵɵtemplate */](4, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template, 6, 10, \"ion-badge\", 14);\n        core[\"nd\" /* ɵɵtemplate */](5, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template, 6, 10, \"ion-badge\", 15);\n        core[\"nd\" /* ɵɵtemplate */](6, AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template, 8, 8, \"ion-badge\", 16);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r4 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.issystem && message_r1.message == \"enter\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.issystem && message_r1.message == \"exit\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.beep == \"all\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.userid != ctx_r4.currentUserId && message_r1.beep == ctx_r4.currentUserId);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.userid == ctx_r4.currentUserId && message_r1.beep && message_r1.beep != \"all\");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !message_r1.issystem && !message_r1.beep);\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_core_user_avatar_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-user-avatar\", 34);\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"Vc\" /* ɵɵproperty */](\"user\", message_r1)(\"linkProfile\", false);\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_div_4_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"div\");\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */](2).$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"qd\" /* ɵɵtextInterpolate */](message_r1.userfullname);\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_div_10_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"div\", 35);\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-item\", 27);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-label\");\n        core[\"Ec\" /* ɵɵelementStart */](2, \"h2\", 28);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_core_user_avatar_3_Template, 1, 2, \"core-user-avatar\", 29);\n        core[\"nd\" /* ɵɵtemplate */](4, AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_div_4_Template, 2, 1, \"div\", 30);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](5, \"div\", 31);\n        core[\"zc\" /* ɵɵelement */](6, \"core-format-text\", 26);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](7, \"ion-note\", 32);\n        core[\"pd\" /* ɵɵtext */](8);\n        core[\"Pc\" /* ɵɵpipe */](9, \"coreFormatDate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](10, AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_div_10_Template, 1, 0, \"div\", 33);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        const ctx_r5 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"qc\" /* ɵɵclassProp */](\"addon-message-mine\", message_r1.userid == ctx_r5.currentUserId)(\"addon-message-not-mine\", message_r1.userid != ctx_r5.currentUserId)(\"addon-message-no-user\", !message_r1.showUserData);\n        core[\"lc\" /* ɵɵadvance */](3);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.showUserData);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.showUserData);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"text\", message_r1.message)(\"contextInstanceId\", ctx_r5.cmId)(\"courseId\", ctx_r5.courseId);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Rc\" /* ɵɵpipeBind2 */](9, 13, message_r1.timestamp * 1000, \"strftimetime\"));\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.showTail);\n    }\n}\nfunction AddonModChatSessionMessagesPage_ng_container_15_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"nd\" /* ɵɵtemplate */](1, AddonModChatSessionMessagesPage_ng_container_15_div_1_Template, 3, 4, \"div\", 7);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatSessionMessagesPage_ng_container_15_div_2_Template, 7, 6, \"div\", 8);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatSessionMessagesPage_ng_container_15_ion_item_3_Template, 11, 16, \"ion-item\", 9);\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        const message_r1 = ctx.$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.showDate);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", message_r1.special);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", !message_r1.special);\n    }\n}\n/**\n * Page that displays list of chat session messages.\n */\nlet session_messages_AddonModChatSessionMessagesPage = /*@__PURE__*/ (() => {\n    class AddonModChatSessionMessagesPage {\n        constructor() {\n            this.messages = [];\n            this.loaded = false;\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnInit() {\n            try {\n                this.courseId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('courseId');\n                this.cmId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('cmId');\n                this.sessionStart = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('sessionStart');\n                this.sessionEnd = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('sessionEnd');\n                this.chatId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('chatId');\n                this.groupId = services_navigator[\"a\" /* CoreNavigator */].getRouteNumberParam('groupId') || 0;\n            }\n            catch (error) {\n                dom[\"a\" /* CoreDomUtils */].showErrorModal(error);\n                services_navigator[\"a\" /* CoreNavigator */].back();\n                return;\n            }\n            this.currentUserId = sites[\"b\" /* CoreSites */].getCurrentSiteUserId();\n            this.fetchMessages();\n        }\n        /**\n         * Fetch session messages.\n         *\n         * @return Promise resolved when done.\n         */\n        fetchMessages() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    const messages = yield chat[\"a\" /* AddonModChat */].getSessionMessages(this.chatId, this.sessionStart, this.sessionEnd, this.groupId, { cmId: this.cmId });\n                    this.messages = yield chat[\"a\" /* AddonModChat */].getMessagesUserData(messages, this.courseId);\n                    // Calculate which messages need to display the date or user data.\n                    for (let index = 0; index < this.messages.length; index++) {\n                        const prevMessage = index > 0 ? this.messages[index - 1] : undefined;\n                        this.messages[index] = chat_helper[\"a\" /* AddonModChatHelper */].formatMessage(this.currentUserId, this.messages[index], prevMessage);\n                        const message = this.messages[index];\n                        if (message.beep && message.beep != String(this.currentUserId)) {\n                            this.loadMessageBeepWho(message);\n                        }\n                    }\n                    this.messages[this.messages.length - 1].showTail = true;\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.errorloadingcontent', true);\n                }\n                finally {\n                    this.loaded = true;\n                }\n            });\n        }\n        loadMessageBeepWho(message) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                message.beepWho = yield this.getUserFullname(message.beep);\n            });\n        }\n        /**\n         * Get the user fullname for a beep.\n         *\n         * @param id User Id before parsing.\n         * @return User fullname.\n         */\n        getUserFullname(id) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const idNumber = parseInt(id, 10);\n                if (isNaN(idNumber)) {\n                    return id;\n                }\n                try {\n                    const user = yield services_user[\"a\" /* CoreUser */].getProfile(idNumber, this.courseId, true);\n                    return user.fullname;\n                }\n                catch (_a) {\n                    // Error getting profile.\n                    return id;\n                }\n            });\n        }\n        /**\n         * Refresh session messages.\n         *\n         * @param refresher Refresher.\n         */\n        refreshMessages(refresher) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    yield utils[\"a\" /* CoreUtils */].ignoreErrors(chat[\"a\" /* AddonModChat */].invalidateSessionMessages(this.chatId, this.sessionStart, this.groupId));\n                    yield this.fetchMessages();\n                }\n                finally {\n                    refresher.complete();\n                }\n            });\n        }\n    }\n    AddonModChatSessionMessagesPage.ɵfac = function AddonModChatSessionMessagesPage_Factory(t) { return new (t || AddonModChatSessionMessagesPage)(); };\n    AddonModChatSessionMessagesPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModChatSessionMessagesPage, selectors: [[\"page-addon-mod-chat-session-messages\"]], decls: 16, vars: 12, consts: [[\"slot\", \"start\"], [3, \"text\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"hideUntil\"], [1, \"addon-messages-discussion-container\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"ion-text-center addon-messages-date\", 4, \"ngIf\"], [\"class\", \"ion-text-center addon-mod_chat-notice\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap addon-message\", 3, \"addon-message-mine\", \"addon-message-not-mine\", \"addon-message-no-user\", 4, \"ngIf\"], [1, \"ion-text-center\", \"addon-messages-date\"], [1, \"ion-text-center\", \"addon-mod_chat-notice\"], [\"class\", \"ion-text-wrap\", \"color\", \"success\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"danger\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"primary\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"light\", 4, \"ngIf\"], [\"class\", \"ion-text-wrap\", \"color\", \"info\", 4, \"ngIf\"], [\"color\", \"success\", 1, \"ion-text-wrap\"], [\"name\", \"fas-sign-in-alt\", \"aria-hidden\", \"true\"], [\"color\", \"danger\", 1, \"ion-text-wrap\"], [\"name\", \"fas-sign-out-alt\", \"aria-hidden\", \"true\"], [\"color\", \"primary\", 1, \"ion-text-wrap\"], [\"name\", \"fas-bell\", \"aria-hidden\", \"true\"], [\"color\", \"light\", 1, \"ion-text-wrap\"], [\"color\", \"info\", 1, \"ion-text-wrap\"], [\"name\", \"fas-asterisk\", \"aria-hidden\", \"true\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [1, \"ion-text-wrap\", \"addon-message\"], [1, \"addon-message-user\"], [\"slot\", \"start\", 3, \"user\", \"linkProfile\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"addon-message-text\"], [\"slot\", \"end\"], [\"class\", \"tail\", 4, \"ngIf\"], [\"slot\", \"start\", 3, \"user\", \"linkProfile\"], [1, \"tail\"]], template: function AddonModChatSessionMessagesPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"pd\" /* ɵɵtext */](7);\n                core[\"Pc\" /* ɵɵpipe */](8, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-content\");\n                core[\"Ec\" /* ɵɵelementStart */](10, \"ion-refresher\", 2);\n                core[\"Mc\" /* ɵɵlistener */](\"ionRefresh\", function AddonModChatSessionMessagesPage_Template_ion_refresher_ionRefresh_10_listener($event) { return ctx.refreshMessages($event.target); });\n                core[\"zc\" /* ɵɵelement */](11, \"ion-refresher-content\", 3);\n                core[\"Pc\" /* ɵɵpipe */](12, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](13, \"core-loading\", 4);\n                core[\"Ec\" /* ɵɵelementStart */](14, \"ion-list\", 5);\n                core[\"nd\" /* ɵɵtemplate */](15, AddonModChatSessionMessagesPage_ng_container_15_Template, 4, 3, \"ng-container\", 6);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 6, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](8, 8, \"addon.mod_chat.messages\"));\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", !ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Wc\" /* ɵɵpropertyInterpolate */](\"pullingText\", core[\"Qc\" /* ɵɵpipeBind1 */](12, 10, \"core.pulltorefresh\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.loaded);\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx.messages);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], ionic_angular[\"bb\" /* IonRefresher */], ionic_angular[\"cb\" /* IonRefresherContent */], loading[\"a\" /* CoreLoadingComponent */], ionic_angular[\"P\" /* IonList */], common[\"s\" /* NgForOf */], common[\"t\" /* NgIf */], ionic_angular[\"k\" /* IonBadge */], ionic_angular[\"D\" /* IonIcon */], fa_icon[\"a\" /* CoreFaIconDirective */], format_text[\"a\" /* CoreFormatTextDirective */], ionic_angular[\"I\" /* IonItem */], ionic_angular[\"O\" /* IonLabel */], ionic_angular[\"W\" /* IonNote */], user_avatar[\"a\" /* CoreUserAvatarComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */], format_date[\"a\" /* CoreFormatDatePipe */]], styles: [\".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background:var(--background-alternative);--background:var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}ion-item.addon-message[_ngcontent-%COMP%]{--message-background:var(--addon-messages-message-bg);--message-activated-background:var(--addon-messages-message-activated-bg);--message-alignment:flex-start;border:0;border-radius:var(--medium-radius);padding:0 8px;margin:8px;--background:var(--message-background);background:var(--message-background);align-self:var(--message-alignment);width:90%;max-width:var(--list-item-max-width);--min-height:var(--a11y-min-target-size);position:relative;transition:width .5s ease-in-out;overflow:visible}ion-item.addon-message[_ngcontent-%COMP%]::part(native){--inner-border-width:0px;--inner-padding-end:0px;padding:0;margin:0}ion-item.addon-message[_ngcontent-%COMP%]:hover{filter:drop-shadow(2px 2px 2px rgba(0,0,0,.3))}ion-item.addon-message[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]:only-child{display:inline}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-bottom:.5rem;margin-top:0;color:var(--ion-text-color)}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{display:block;--core-avatar-size:var(--addon-messages-avatar-size);margin:0}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-user[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:500;flex-grow:1;padding-left:.5rem;padding-right:.5rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}ion-item.addon-message[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{color:var(--addon-messages-message-note-text);font-size:var(--addon-messages-message-note-font-size);margin:0;padding:8px 0;align-self:flex-start}ion-item.addon-message[tappable][_ngcontent-%COMP%]:active{--message-background:var(--message-activated-background)}ion-item.addon-message[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0;padding:8px 0}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-text[_ngcontent-%COMP%]{display:inline-flex}ion-item.addon-message[_ngcontent-%COMP%]   .addon-message-text[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:var(--ion-text-color)}ion-item.addon-message[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{content:\\\"\\\";width:0;height:0;position:absolute;touch-action:none;bottom:0;border:.5rem solid transparent;border-bottom:.5rem solid var(--message-background)}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]{--message-background:var(--addon-messages-message-mine-bg);--message-activated-background:var(--addon-messages-message-mine-activated-bg);--message-alignment:flex-end}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{float:right;margin:2px -3px -2px 5px}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{float:left}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:5px;margin-inline-start:5px;-webkit-margin-end:-3px;margin-inline-end:-3px}}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{right:-8px;margin-right:-.5rem}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:unset;right:unset;left:-8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:-.5rem;margin-inline-end:-.5rem}}ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:-8px;margin-left:-.5rem}[dir=rtl][_nghost-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{left:unset;right:unset;right:-8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item.addon-message.addon-message-not-mine[_ngcontent-%COMP%]   .tail[_ngcontent-%COMP%]{margin-left:unset;-webkit-margin-start:-.5rem;margin-inline-start:-.5rem}}ion-item.addon-message[_ngcontent-%COMP%]   .addon-messages-delete-button[_ngcontent-%COMP%]{min-height:0;line-height:normal;margin-top:0;margin-bottom:0;height:var(--a11y-min-target-size)!important;align-self:flex-end}ion-item.addon-message[_ngcontent-%COMP%]   .addon-messages-delete-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.4em;line-height:normal;color:var(--danger)}ion-item.addon-message.addon-message-no-user[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}\"] });\n    return AddonModChatSessionMessagesPage;\n})();\n\n// EXTERNAL MODULE: ./src/core/services/screen.ts\nvar screen = __webpack_require__(\"Y+03\");\n\n// EXTERNAL MODULE: ./src/app/app-routing.module.ts\nvar app_routing_module = __webpack_require__(\"vY5A\");\n\n// EXTERNAL MODULE: ./src/core/classes/items-management/list-items-manager.ts\nvar list_items_manager = __webpack_require__(\"EoRH\");\n\n// EXTERNAL MODULE: ./src/core/classes/items-management/routed-items-manager-sources-tracker.ts\nvar routed_items_manager_sources_tracker = __webpack_require__(\"baaQ\");\n\n// EXTERNAL MODULE: ./src/core/components/split-view/split-view.ts\nvar split_view = __webpack_require__(\"46ml\");\n\n// EXTERNAL MODULE: ./src/core/classes/items-management/routed-items-manager-source.ts\nvar routed_items_manager_source = __webpack_require__(\"CvRw\");\n\n// EXTERNAL MODULE: ./src/core/services/groups.ts\nvar groups = __webpack_require__(\"mWdr\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/classes/chat-sessions-source.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n/**\n * Provides a collection of sessions.\n */\nclass chat_sessions_source_AddonModChatSessionsSource extends routed_items_manager_source[\"a\" /* CoreRoutedItemsManagerSource */] {\n    constructor(courseId, chatId, cmId) {\n        super();\n        this.showAll = false;\n        this.groupId = 0;\n        this.COURSE_ID = courseId;\n        this.CHAT_ID = chatId;\n        this.CM_ID = cmId;\n    }\n    /**\n     * Invalidate chat cache.\n     */\n    invalidateCache() {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            yield utils[\"a\" /* CoreUtils */].ignoreErrors(utils[\"a\" /* CoreUtils */].allPromises([\n                groups[\"a\" /* CoreGroups */].invalidateActivityGroupInfo(this.CM_ID),\n                chat[\"a\" /* AddonModChat */].invalidateSessions(this.CHAT_ID, this.groupId, this.showAll),\n            ]));\n        });\n    }\n    /**\n     * @inheritdoc\n     */\n    loadPageItems() {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            this.groupInfo = yield groups[\"a\" /* CoreGroups */].getActivityGroupInfo(this.CM_ID, false);\n            this.groupId = groups[\"a\" /* CoreGroups */].validateGroupId(this.groupId, this.groupInfo);\n            const sessions = yield chat[\"a\" /* AddonModChat */].getSessions(this.CHAT_ID, this.groupId, this.showAll, { cmId: this.CM_ID });\n            // Fetch user profiles.\n            const promises = [];\n            const formattedSessions = sessions.map((session) => {\n                session.duration = session.sessionend - session.sessionstart;\n                session.sessionusers.forEach((sessionUser) => {\n                    // The WS does not return the user name, fetch user profile.\n                    promises.push(this.loadUserFullname(sessionUser));\n                });\n                // If session has more than 4 users we display a \"Show more\" link.\n                session.allsessionusers = session.sessionusers;\n                if (session.sessionusers.length > 4) {\n                    session.sessionusers = session.allsessionusers.slice(0, 3);\n                }\n                return session;\n            });\n            yield Promise.all(promises);\n            return { items: formattedSessions };\n        });\n    }\n    /**\n     * @inheritdoc\n     */\n    getItemPath(session) {\n        return `${session.sessionstart}/${session.sessionend}`;\n    }\n    /**\n     * @inheritdoc\n     */\n    getItemQueryParams() {\n        return {\n            chatId: this.CHAT_ID,\n            groupId: this.groupId,\n        };\n    }\n    /**\n     * Load the fullname of a user.\n     *\n     * @param id User ID.\n     * @return Promise resolved when done.\n     */\n    loadUserFullname(sessionUser) {\n        return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n            if (sessionUser.userfullname) {\n                return;\n            }\n            try {\n                const user = yield services_user[\"a\" /* CoreUser */].getProfile(sessionUser.userid, this.COURSE_ID, true);\n                sessionUser.userfullname = user.fullname;\n            }\n            catch (_a) {\n                // Error getting profile, most probably the user is deleted.\n                sessionUser.userfullname = singletons[\"M\" /* Translate */].instant('core.deleteduser') + ' ' + sessionUser.userid;\n            }\n        });\n    }\n}\n\n// EXTERNAL MODULE: ./node_modules/@angular/forms/__ivy_ngcc__/fesm2015/forms.js\nvar fesm2015_forms = __webpack_require__(\"3Pt+\");\n\n// EXTERNAL MODULE: ./src/core/pipes/duration.ts\nvar duration = __webpack_require__(\"llyR\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/pages/sessions/sessions.ts\n\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction AddonModChatSessionsPage_ion_item_15_ng_container_2_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.groupsseparate\"));\n    }\n}\nfunction AddonModChatSessionsPage_ion_item_15_ng_container_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Cc\" /* ɵɵelementContainerStart */](0);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Bc\" /* ɵɵelementContainerEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.groupsvisible\"));\n    }\n}\nfunction AddonModChatSessionsPage_ion_item_15_ion_select_option_6_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-select-option\", 14);\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const groupOpt_r6 = ctx.$implicit;\n        core[\"Vc\" /* ɵɵproperty */](\"value\", groupOpt_r6.id);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", groupOpt_r6.name, \" \");\n    }\n}\nconst sessions_c0 = function (a0) { return { header: a0 }; };\nfunction AddonModChatSessionsPage_ion_item_15_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r8 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-item\", 9);\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-label\", 10);\n        core[\"nd\" /* ɵɵtemplate */](2, AddonModChatSessionsPage_ion_item_15_ng_container_2_Template, 3, 3, \"ng-container\", 11);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatSessionsPage_ion_item_15_ng_container_3_Template, 3, 3, \"ng-container\", 11);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](4, \"ion-select\", 12);\n        core[\"Mc\" /* ɵɵlistener */](\"ngModelChange\", function AddonModChatSessionsPage_ion_item_15_Template_ion_select_ngModelChange_4_listener($event) { core[\"fd\" /* ɵɵrestoreView */](_r8); const ctx_r7 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r7.groupId = $event; })(\"ionChange\", function AddonModChatSessionsPage_ion_item_15_Template_ion_select_ionChange_4_listener() { core[\"fd\" /* ɵɵrestoreView */](_r8); const ctx_r9 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r9.reloadSessions(); });\n        core[\"Pc\" /* ɵɵpipe */](5, \"translate\");\n        core[\"nd\" /* ɵɵtemplate */](6, AddonModChatSessionsPage_ion_item_15_ion_select_option_6_Template, 2, 2, \"ion-select-option\", 13);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const ctx_r0 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx_r0.groupInfo.separateGroups);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx_r0.groupInfo.visibleGroups);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngModel\", ctx_r0.groupId)(\"interfaceOptions\", core[\"ad\" /* ɵɵpureFunction1 */](7, sessions_c0, core[\"Qc\" /* ɵɵpipeBind1 */](5, 5, \"core.group\")));\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx_r0.groupInfo.groups);\n    }\n}\nfunction AddonModChatSessionsPage_ion_card_21_p_6_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"p\");\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"coreDuration\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const session_r10 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, session_r10.duration));\n    }\n}\nfunction AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"span\");\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const user_r15 = core[\"Oc\" /* ɵɵnextContext */]().$implicit;\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\"(\", user_r15.messagecount, \")\");\n    }\n}\nfunction AddonModChatSessionsPage_ion_card_21_ion_item_8_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-item\");\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-label\");\n        core[\"pd\" /* ɵɵtext */](2);\n        core[\"nd\" /* ɵɵtemplate */](3, AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template, 2, 1, \"span\", 11);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const user_r15 = ctx.$implicit;\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", user_r15.userfullname, \" \");\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", user_r15.messagecount);\n    }\n}\nfunction AddonModChatSessionsPage_ion_card_21_ion_button_9_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r20 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-button\", 20);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModChatSessionsPage_ion_card_21_ion_button_9_Template_ion_button_click_0_listener($event) { core[\"fd\" /* ɵɵrestoreView */](_r20); const session_r10 = core[\"Oc\" /* ɵɵnextContext */]().$implicit; const ctx_r18 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r18.showMoreUsers(session_r10, $event); });\n        core[\"pd\" /* ɵɵtext */](1);\n        core[\"Pc\" /* ɵɵpipe */](2, \"translate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"rd\" /* ɵɵtextInterpolate1 */](\" \", core[\"Qc\" /* ɵɵpipeBind1 */](2, 1, \"core.showmore\"), \" \");\n    }\n}\nfunction AddonModChatSessionsPage_ion_card_21_Template(rf, ctx) {\n    if (rf & 1) {\n        const _r22 = core[\"Fc\" /* ɵɵgetCurrentView */]();\n        core[\"Ec\" /* ɵɵelementStart */](0, \"ion-card\", 15);\n        core[\"Mc\" /* ɵɵlistener */](\"click\", function AddonModChatSessionsPage_ion_card_21_Template_ion_card_click_0_listener() { core[\"fd\" /* ɵɵrestoreView */](_r22); const session_r10 = ctx.$implicit; const ctx_r21 = core[\"Oc\" /* ɵɵnextContext */](); return ctx_r21.sessions.select(session_r10); });\n        core[\"Ec\" /* ɵɵelementStart */](1, \"ion-item\", 16);\n        core[\"Ec\" /* ɵɵelementStart */](2, \"ion-label\");\n        core[\"Ec\" /* ɵɵelementStart */](3, \"p\", 17);\n        core[\"pd\" /* ɵɵtext */](4);\n        core[\"Pc\" /* ɵɵpipe */](5, \"coreFormatDate\");\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](6, AddonModChatSessionsPage_ion_card_21_p_6_Template, 3, 3, \"p\", 11);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"Ec\" /* ɵɵelementStart */](7, \"ion-card-content\");\n        core[\"nd\" /* ɵɵtemplate */](8, AddonModChatSessionsPage_ion_card_21_ion_item_8_Template, 4, 2, \"ion-item\", 18);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n        core[\"nd\" /* ɵɵtemplate */](9, AddonModChatSessionsPage_ion_card_21_ion_button_9_Template, 3, 3, \"ion-button\", 19);\n        core[\"Dc\" /* ɵɵelementEnd */]();\n    }\n    if (rf & 2) {\n        const session_r10 = ctx.$implicit;\n        const ctx_r1 = core[\"Oc\" /* ɵɵnextContext */]();\n        core[\"qc\" /* ɵɵclassProp */](\"addon-mod-chat-session-show-more\", session_r10.sessionusers.length < session_r10.allsessionusers.length);\n        core[\"mc\" /* ɵɵattribute */](\"aria-current\", ctx_r1.sessions.getItemAriaCurrent(session_r10));\n        core[\"lc\" /* ɵɵadvance */](4);\n        core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](5, 7, session_r10.sessionstart * 1000));\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", session_r10.duration);\n        core[\"lc\" /* ɵɵadvance */](2);\n        core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", session_r10.sessionusers);\n        core[\"lc\" /* ɵɵadvance */](1);\n        core[\"Vc\" /* ɵɵproperty */](\"ngIf\", session_r10.sessionusers.length < session_r10.allsessionusers.length);\n    }\n}\nfunction AddonModChatSessionsPage_core_empty_box_22_Template(rf, ctx) {\n    if (rf & 1) {\n        core[\"zc\" /* ɵɵelement */](0, \"core-empty-box\", 21);\n        core[\"Pc\" /* ɵɵpipe */](1, \"translate\");\n    }\n    if (rf & 2) {\n        core[\"Vc\" /* ɵɵproperty */](\"message\", core[\"Qc\" /* ɵɵpipeBind1 */](1, 1, \"addon.mod_chat.nosessionsfound\"));\n    }\n}\n/**\n * Page that displays list of chat sessions.\n */\nlet sessions_AddonModChatSessionsPage = /*@__PURE__*/ (() => {\n    class AddonModChatSessionsPage {\n        constructor() {\n            try {\n                const courseId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('courseId');\n                const chatId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('chatId');\n                const cmId = services_navigator[\"a\" /* CoreNavigator */].getRequiredRouteNumberParam('cmId');\n                const source = routed_items_manager_sources_tracker[\"a\" /* CoreRoutedItemsManagerSourcesTracker */].getOrCreateSource(chat_sessions_source_AddonModChatSessionsSource, [courseId, chatId, cmId]);\n                this.sessions = new list_items_manager[\"a\" /* CoreListItemsManager */](source, AddonModChatSessionsPage);\n            }\n            catch (error) {\n                dom[\"a\" /* CoreDomUtils */].showErrorModal(error);\n                services_navigator[\"a\" /* CoreNavigator */].back();\n                return;\n            }\n        }\n        get groupId() {\n            return this.sessions.getSource().groupId;\n        }\n        set groupId(value) {\n            this.sessions.getSource().groupId = value;\n        }\n        get showAll() {\n            return this.sessions.getSource().showAll;\n        }\n        set showAll(value) {\n            this.sessions.getSource().showAll = value;\n        }\n        get groupInfo() {\n            return this.sessions.getSource().groupInfo;\n        }\n        /**\n         * @inheritdoc\n         */\n        ngAfterViewInit() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                yield this.fetchSessions();\n                this.sessions.start(this.splitView);\n            });\n        }\n        /**\n         * Fetch chat sessions.\n         *\n         * @param showLoading Display a loading modal.\n         */\n        fetchSessions() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    yield this.sessions.load();\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.errorloadingcontent', true);\n                }\n            });\n        }\n        /**\n         * Reload chat sessions.\n         */\n        reloadSessions() {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                const modal = yield dom[\"a\" /* CoreDomUtils */].showModalLoading();\n                try {\n                    yield this.sessions.reload();\n                }\n                catch (error) {\n                    dom[\"a\" /* CoreDomUtils */].showErrorModalDefault(error, 'core.errorloadingcontent', true);\n                }\n                finally {\n                    modal.dismiss();\n                }\n            });\n        }\n        /**\n         * Refresh chat sessions.\n         *\n         * @param refresher Refresher.\n         */\n        refreshSessions(refresher) {\n            return Object(tslib_es6[\"a\" /* __awaiter */])(this, void 0, void 0, function* () {\n                try {\n                    this.sessions.getSource().setDirty(true);\n                    yield this.sessions.getSource().invalidateCache();\n                    yield this.fetchSessions();\n                }\n                finally {\n                    refresher.complete();\n                }\n            });\n        }\n        /**\n         * Show more session users.\n         *\n         * @param session Chat session.\n         * @param event The event.\n         */\n        showMoreUsers(session, event) {\n            if (session.allsessionusers) {\n                session.sessionusers = session.allsessionusers;\n            }\n            event.stopPropagation();\n        }\n        /**\n         * @inheritdoc\n         */\n        ngOnDestroy() {\n            this.sessions.destroy();\n        }\n    }\n    AddonModChatSessionsPage.ɵfac = function AddonModChatSessionsPage_Factory(t) { return new (t || AddonModChatSessionsPage)(); };\n    AddonModChatSessionsPage.ɵcmp = core[\"sc\" /* ɵɵdefineComponent */]({ type: AddonModChatSessionsPage, selectors: [[\"page-addon-mod-chat-sessions\"]], viewQuery: function AddonModChatSessionsPage_Query(rf, ctx) {\n            if (rf & 1) {\n                core[\"ud\" /* ɵɵviewQuery */](split_view[\"a\" /* CoreSplitViewComponent */], true);\n            }\n            if (rf & 2) {\n                var _t;\n                core[\"dd\" /* ɵɵqueryRefresh */](_t = core[\"Nc\" /* ɵɵloadQuery */]()) && (ctx.splitView = _t.first);\n            }\n        }, decls: 23, vars: 18, consts: [[\"slot\", \"start\"], [3, \"text\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"hideUntil\"], [\"class\", \"ion-text-wrap core-group-selector\", 4, \"ngIf\"], [3, \"ngModel\", \"ngModelChange\", \"ionChange\"], [\"button\", \"\", 3, \"addon-mod-chat-session-show-more\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"icon\", \"far-comments\", 3, \"message\", 4, \"ngIf\"], [1, \"ion-text-wrap\", \"core-group-selector\"], [\"id\", \"addon-chat-groupslabel\"], [4, \"ngIf\"], [\"aria-labelledby\", \"addon-chat-groupslabel\", \"interface\", \"action-sheet\", 3, \"ngModel\", \"interfaceOptions\", \"ngModelChange\", \"ionChange\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [\"button\", \"\", 3, \"click\"], [1, \"ion-text-wrap\"], [1, \"item-heading\"], [4, \"ngFor\", \"ngForOf\"], [\"fill\", \"clear\", \"expand\", \"block\", 3, \"click\", 4, \"ngIf\"], [\"fill\", \"clear\", \"expand\", \"block\", 3, \"click\"], [\"icon\", \"far-comments\", 3, \"message\"]], template: function AddonModChatSessionsPage_Template(rf, ctx) {\n            if (rf & 1) {\n                core[\"Ec\" /* ɵɵelementStart */](0, \"ion-header\");\n                core[\"Ec\" /* ɵɵelementStart */](1, \"ion-toolbar\");\n                core[\"Ec\" /* ɵɵelementStart */](2, \"ion-buttons\", 0);\n                core[\"zc\" /* ɵɵelement */](3, \"ion-back-button\", 1);\n                core[\"Pc\" /* ɵɵpipe */](4, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](5, \"ion-title\");\n                core[\"Ec\" /* ɵɵelementStart */](6, \"h1\");\n                core[\"pd\" /* ɵɵtext */](7);\n                core[\"Pc\" /* ɵɵpipe */](8, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](9, \"ion-content\");\n                core[\"Ec\" /* ɵɵelementStart */](10, \"core-split-view\");\n                core[\"Ec\" /* ɵɵelementStart */](11, \"ion-refresher\", 2);\n                core[\"Mc\" /* ɵɵlistener */](\"ionRefresh\", function AddonModChatSessionsPage_Template_ion_refresher_ionRefresh_11_listener($event) { return ctx.refreshSessions($event.target); });\n                core[\"zc\" /* ɵɵelement */](12, \"ion-refresher-content\", 3);\n                core[\"Pc\" /* ɵɵpipe */](13, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](14, \"core-loading\", 4);\n                core[\"nd\" /* ɵɵtemplate */](15, AddonModChatSessionsPage_ion_item_15_Template, 7, 9, \"ion-item\", 5);\n                core[\"Ec\" /* ɵɵelementStart */](16, \"ion-item\");\n                core[\"Ec\" /* ɵɵelementStart */](17, \"ion-label\");\n                core[\"pd\" /* ɵɵtext */](18);\n                core[\"Pc\" /* ɵɵpipe */](19, \"translate\");\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Ec\" /* ɵɵelementStart */](20, \"ion-toggle\", 6);\n                core[\"Mc\" /* ɵɵlistener */](\"ngModelChange\", function AddonModChatSessionsPage_Template_ion_toggle_ngModelChange_20_listener($event) { return ctx.showAll = $event; })(\"ionChange\", function AddonModChatSessionsPage_Template_ion_toggle_ionChange_20_listener() { return ctx.reloadSessions(); });\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"nd\" /* ɵɵtemplate */](21, AddonModChatSessionsPage_ion_card_21_Template, 10, 9, \"ion-card\", 7);\n                core[\"nd\" /* ɵɵtemplate */](22, AddonModChatSessionsPage_core_empty_box_22_Template, 2, 3, \"core-empty-box\", 8);\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n                core[\"Dc\" /* ɵɵelementEnd */]();\n            }\n            if (rf & 2) {\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"Vc\" /* ɵɵproperty */](\"text\", core[\"Qc\" /* ɵɵpipeBind1 */](4, 10, \"core.back\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](8, 12, \"addon.mod_chat.chatreport\"));\n                core[\"lc\" /* ɵɵadvance */](4);\n                core[\"Vc\" /* ɵɵproperty */](\"disabled\", !ctx.sessions.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Wc\" /* ɵɵpropertyInterpolate */](\"pullingText\", core[\"Qc\" /* ɵɵpipeBind1 */](13, 14, \"core.pulltorefresh\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"hideUntil\", ctx.sessions.loaded);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.groupInfo && (ctx.groupInfo.separateGroups || ctx.groupInfo.visibleGroups));\n                core[\"lc\" /* ɵɵadvance */](3);\n                core[\"qd\" /* ɵɵtextInterpolate */](core[\"Qc\" /* ɵɵpipeBind1 */](19, 16, \"addon.mod_chat.showincompletesessions\"));\n                core[\"lc\" /* ɵɵadvance */](2);\n                core[\"Vc\" /* ɵɵproperty */](\"ngModel\", ctx.showAll);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngForOf\", ctx.sessions.items);\n                core[\"lc\" /* ɵɵadvance */](1);\n                core[\"Vc\" /* ɵɵproperty */](\"ngIf\", ctx.sessions.empty);\n            }\n        }, directives: [ionic_angular[\"C\" /* IonHeader */], ionic_angular[\"Ab\" /* IonToolbar */], ionic_angular[\"m\" /* IonButtons */], ionic_angular[\"h\" /* IonBackButton */], ionic_angular[\"i\" /* IonBackButtonDelegate */], ionic_angular[\"yb\" /* IonTitle */], content[\"a\" /* CoreContentDirective */], ionic_angular[\"v\" /* IonContent */], split_view[\"a\" /* CoreSplitViewComponent */], ionic_angular[\"bb\" /* IonRefresher */], ionic_angular[\"cb\" /* IonRefresherContent */], loading[\"a\" /* CoreLoadingComponent */], common[\"t\" /* NgIf */], ionic_angular[\"I\" /* IonItem */], ionic_angular[\"O\" /* IonLabel */], ionic_angular[\"zb\" /* IonToggle */], ionic_angular[\"d\" /* BooleanValueAccessor */], fesm2015_forms[\"r\" /* NgControlStatus */], fesm2015_forms[\"u\" /* NgModel */], common[\"s\" /* NgForOf */], ionic_angular[\"lb\" /* IonSelect */], ionic_angular[\"Ob\" /* SelectValueAccessor */], ionic_angular[\"mb\" /* IonSelectOption */], ionic_angular[\"n\" /* IonCard */], ionic_angular[\"o\" /* IonCardContent */], update_non_reactive_attributes[\"a\" /* CoreUpdateNonReactiveAttributesDirective */], ionic_angular[\"l\" /* IonButton */], empty_box[\"a\" /* CoreEmptyBoxComponent */]], pipes: [ngx_translate_core[\"d\" /* TranslatePipe */], format_date[\"a\" /* CoreFormatDatePipe */], duration[\"a\" /* CoreDurationPipe */]], encapsulation: 2 });\n    return AddonModChatSessionsPage;\n})();\n\n// EXTERNAL MODULE: ./src/core/guards/can-leave.ts\nvar can_leave = __webpack_require__(\"MLi9\");\n\n// CONCATENATED MODULE: ./src/addons/mod/chat/chat-lazy.module.ts\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst commonRoutes = [\n    {\n        path: ':courseId/:cmId',\n        component: index_AddonModChatIndexPage,\n    },\n    {\n        path: ':courseId/:cmId/chat',\n        component: chat_AddonModChatChatPage,\n        canDeactivate: [can_leave[\"a\" /* CanLeaveGuard */]],\n    },\n];\nconst mobileRoutes = [\n    ...commonRoutes,\n    {\n        path: ':courseId/:cmId/sessions',\n        component: sessions_AddonModChatSessionsPage,\n    },\n    {\n        path: ':courseId/:cmId/sessions/:sessionStart/:sessionEnd',\n        component: session_messages_AddonModChatSessionMessagesPage,\n    },\n];\nconst tabletRoutes = [\n    ...commonRoutes,\n    {\n        path: ':courseId/:cmId/sessions',\n        component: sessions_AddonModChatSessionsPage,\n        children: [\n            {\n                path: ':sessionStart/:sessionEnd',\n                component: session_messages_AddonModChatSessionMessagesPage,\n            },\n        ],\n    },\n];\nconst routes = [\n    ...Object(app_routing_module[\"c\" /* conditionalRoutes */])(mobileRoutes, () => screen[\"a\" /* CoreScreen */].isMobile),\n    ...Object(app_routing_module[\"c\" /* conditionalRoutes */])(tabletRoutes, () => screen[\"a\" /* CoreScreen */].isTablet),\n];\nlet chat_lazy_module_AddonModChatLazyModule = /*@__PURE__*/ (() => {\n    class AddonModChatLazyModule {\n    }\n    AddonModChatLazyModule.ɵmod = core[\"wc\" /* ɵɵdefineNgModule */]({ type: AddonModChatLazyModule });\n    AddonModChatLazyModule.ɵinj = core[\"vc\" /* ɵɵdefineInjector */]({ factory: function AddonModChatLazyModule_Factory(t) { return new (t || AddonModChatLazyModule)(); }, imports: [[\n                router[\"m\" /* RouterModule */].forChild(routes),\n                shared_module[\"a\" /* CoreSharedModule */],\n                components_module[\"a\" /* AddonModChatComponentsModule */],\n            ]] });\n    return AddonModChatLazyModule;\n})();\n(function () {\n    (typeof ngJitMode === \"undefined\" || ngJitMode) && core[\"kd\" /* ɵɵsetNgModuleScope */](chat_lazy_module_AddonModChatLazyModule, { declarations: [index_AddonModChatIndexPage,\n            chat_AddonModChatChatPage,\n            sessions_AddonModChatSessionsPage,\n            session_messages_AddonModChatSessionMessagesPage], imports: [router[\"m\" /* RouterModule */], shared_module[\"a\" /* CoreSharedModule */],\n            components_module[\"a\" /* AddonModChatComponentsModule */]] });\n})();\n\n\n/***/ })\n\n}]);","inputSourceMap":null}