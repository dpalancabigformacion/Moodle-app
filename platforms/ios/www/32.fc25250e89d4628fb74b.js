(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{eJtl:function(e,t,o){"use strict";o.r(t),o.d(t,"AddonModFeedbackLazyModule",(function(){return z}));var n=o("tyNb"),a=o("L3Fv"),d=o("1IpS"),c=o("ghUQ"),i=o("pHTc"),r=o("hYz8"),s=o("fXoL"),l=o("TEn/"),m=o("4JiN"),p=o("hMzs"),u=o("nt/U"),_=o("sYmb");let g=(()=>{class AddonModFeedbackIndexPage extends c.a{ngOnInit(){super.ngOnInit(),this.selectedTab=i.a.getRouteParam("tab"),this.selectedGroup=i.a.getRouteNumberParam("group")}}return AddonModFeedbackIndexPage.ɵfac=function AddonModFeedbackIndexPage_Factory(e){return b(e||AddonModFeedbackIndexPage)},AddonModFeedbackIndexPage.ɵcmp=s.sc({type:AddonModFeedbackIndexPage,selectors:[["page-addon-mod-feedback-index"]],viewQuery:function AddonModFeedbackIndexPage_Query(e,t){var o;(1&e&&s.ud(r.a,!0),2&e)&&(s.dd(o=s.Nc())&&(t.activityComponent=o.first))},features:[s.ic],decls:14,vars:14,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","group","tab","dataRetrieved"]],template:function AddonModFeedbackIndexPage_Template(e,t){1&e&&(s.Ec(0,"ion-header",0),s.Ec(1,"ion-toolbar"),s.Ec(2,"ion-buttons",1),s.zc(3,"ion-back-button",2),s.Pc(4,"translate"),s.Dc(),s.Ec(5,"ion-title"),s.Ec(6,"h1"),s.zc(7,"core-format-text",3),s.Dc(),s.Dc(),s.zc(8,"ion-buttons",4),s.Dc(),s.Dc(),s.Ec(9,"ion-content",5),s.Ec(10,"ion-refresher",6),s.Mc("ionRefresh",(function AddonModFeedbackIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==t.activityComponent?null:t.activityComponent.doRefresh(e.target)})),s.zc(11,"ion-refresher-content",7),s.Pc(12,"translate"),s.Dc(),s.Ec(13,"addon-mod-feedback-index",8),s.Mc("dataRetrieved",(function AddonModFeedbackIndexPage_Template_addon_mod_feedback_index_dataRetrieved_13_listener(e){return t.updateData(e)})),s.Dc(),s.Dc()),2&e&&(s.lc(3),s.Vc("text",s.Qc(4,10,"core.back")),s.lc(4),s.Vc("text",t.title)("contextInstanceId",null==t.module?null:t.module.id)("courseId",t.courseId),s.lc(3),s.Vc("disabled",null==t.activityComponent?null:t.activityComponent.showLoading),s.lc(1),s.Wc("pullingText",s.Qc(12,12,"core.pulltorefresh")),s.lc(2),s.Vc("module",t.module)("courseId",t.courseId)("group",t.selectedGroup)("tab",t.selectedTab))},directives:[l.C,m.b,l.Ab,l.m,l.h,l.i,l.yb,p.a,u.a,l.v,l.bb,l.cb,r.a],pipes:[_.d],encapsulation:2}),AddonModFeedbackIndexPage})();const b=s.Gc(g);var f=o("mrSG"),h=o("baaQ"),A=o("EoRH"),M=o("FYaz"),k=o("46ml"),F=o("3LXp"),v=o("bFG1"),P=o("jVvP"),I=o("PgjG"),y=o("ofXK"),D=o("xpMl"),E=o("3Pt+"),T=o("FeAf"),x=o("uYHD");function AddonModFeedbackAttemptsPage_ion_item_16_ng_container_2_Template(e,t){1&e&&(s.Cc(0),s.pd(1),s.Pc(2,"translate"),s.Bc()),2&e&&(s.lc(1),s.qd(s.Qc(2,1,"core.groupsseparate")))}function AddonModFeedbackAttemptsPage_ion_item_16_ng_container_3_Template(e,t){1&e&&(s.Cc(0),s.pd(1),s.Pc(2,"translate"),s.Bc()),2&e&&(s.lc(1),s.qd(s.Qc(2,1,"core.groupsvisible")))}function AddonModFeedbackAttemptsPage_ion_item_16_ion_select_option_6_Template(e,t){if(1&e&&(s.Ec(0,"ion-select-option",13),s.pd(1),s.Dc()),2&e){const e=t.$implicit;s.Vc("value",e.id),s.lc(1),s.rd(" ",e.name," ")}}const _c0=function(e){return{header:e}};function AddonModFeedbackAttemptsPage_ion_item_16_Template(e,t){if(1&e){const e=s.Fc();s.Ec(0,"ion-item",9),s.Ec(1,"ion-label",10),s.nd(2,AddonModFeedbackAttemptsPage_ion_item_16_ng_container_2_Template,3,3,"ng-container",7),s.nd(3,AddonModFeedbackAttemptsPage_ion_item_16_ng_container_3_Template,3,3,"ng-container",7),s.Dc(),s.Ec(4,"ion-select",11),s.Mc("ngModelChange",(function AddonModFeedbackAttemptsPage_ion_item_16_Template_ion_select_ngModelChange_4_listener(t){s.fd(e);return s.Oc().selectedGroup=t}))("ionChange",(function AddonModFeedbackAttemptsPage_ion_item_16_Template_ion_select_ionChange_4_listener(){s.fd(e);return s.Oc().reloadAttempts()})),s.Pc(5,"translate"),s.nd(6,AddonModFeedbackAttemptsPage_ion_item_16_ion_select_option_6_Template,2,2,"ion-select-option",12),s.Dc(),s.Dc()}if(2&e){const e=s.Oc();s.lc(2),s.Vc("ngIf",e.groupInfo.separateGroups),s.lc(1),s.Vc("ngIf",e.groupInfo.visibleGroups),s.lc(1),s.Vc("ngModel",e.selectedGroup)("interfaceOptions",s.ad(7,_c0,s.Qc(5,5,"core.group"))),s.lc(2),s.Vc("ngForOf",e.groupInfo.groups)}}function AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_p_5_Template(e,t){if(1&e&&(s.Ec(0,"p"),s.pd(1),s.Pc(2,"coreFormatDate"),s.Dc()),2&e){const e=s.Oc().$implicit;s.lc(1),s.qd(s.Qc(2,1,1e3*e.timemodified))}}function AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_Template(e,t){if(1&e){const e=s.Fc();s.Ec(0,"ion-item",15),s.Mc("click",(function AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_Template_ion_item_click_0_listener(){s.fd(e);const o=t.$implicit,n=s.Oc(2);return null==n.attempts?null:n.attempts.select(o)})),s.zc(1,"core-user-avatar",16),s.Ec(2,"ion-label"),s.Ec(3,"p",17),s.pd(4),s.Dc(),s.nd(5,AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_p_5_Template,3,3,"p",7),s.Dc(),s.Dc()}if(2&e){const e=t.$implicit,o=s.Oc(2);s.mc("aria-current",null==o.attempts?null:o.attempts.getItemAriaCurrent(e)),s.lc(1),s.Vc("user",e)("linkProfile",!1),s.lc(3),s.qd(e.fullname),s.lc(1),s.Vc("ngIf",e.timemodified)}}const _c1=function(e){return{$a:e}};function AddonModFeedbackAttemptsPage_ng_container_17_Template(e,t){if(1&e&&(s.Cc(0),s.Ec(1,"ion-item-divider"),s.Ec(2,"ion-label"),s.Ec(3,"h2"),s.pd(4),s.Pc(5,"translate"),s.Dc(),s.Dc(),s.Dc(),s.nd(6,AddonModFeedbackAttemptsPage_ng_container_17_ion_item_6_Template,6,5,"ion-item",14),s.Bc()),2&e){const e=s.Oc();s.lc(4),s.qd(s.Rc(5,2,"addon.mod_feedback.non_anonymous_entries",s.ad(5,_c1,e.identifiableAttemptsTotal))),s.lc(2),s.Vc("ngForOf",e.identifiableAttempts)}}function AddonModFeedbackAttemptsPage_ng_container_18_ion_item_6_Template(e,t){if(1&e){const e=s.Fc();s.Ec(0,"ion-item",15),s.Mc("click",(function AddonModFeedbackAttemptsPage_ng_container_18_ion_item_6_Template_ion_item_click_0_listener(){s.fd(e);const o=t.$implicit,n=s.Oc(2);return null==n.attempts?null:n.attempts.select(o)})),s.zc(1,"core-user-avatar",18),s.Ec(2,"ion-label"),s.Ec(3,"p",17),s.pd(4),s.Pc(5,"translate"),s.Dc(),s.Ec(6,"p"),s.pd(7),s.Pc(8,"translate"),s.Dc(),s.Dc(),s.Dc()}if(2&e){const e=t.$implicit,o=s.Oc(2);s.mc("aria-current",null==o.attempts?null:o.attempts.getItemAriaCurrent(e)),s.lc(1),s.Vc("linkProfile",!1),s.lc(3),s.qd(s.Qc(5,5,"addon.mod_feedback.anonymous_user")),s.lc(3),s.sd("",s.Qc(8,7,"addon.mod_feedback.response_nr"),": ",e.number,"")}}function AddonModFeedbackAttemptsPage_ng_container_18_Template(e,t){if(1&e&&(s.Cc(0),s.Ec(1,"ion-item-divider"),s.Ec(2,"ion-label"),s.Ec(3,"h2"),s.pd(4),s.Pc(5,"translate"),s.Dc(),s.Dc(),s.Dc(),s.nd(6,AddonModFeedbackAttemptsPage_ng_container_18_ion_item_6_Template,9,9,"ion-item",14),s.Bc()),2&e){const e=s.Oc();s.lc(4),s.qd(s.Rc(5,2,"addon.mod_feedback.anonymous_entries",s.ad(5,_c1,e.anonymousAttemptsTotal))),s.lc(2),s.Vc("ngForOf",e.anonymousAttempts)}}let C=(()=>{class AddonModFeedbackAttemptsPage{constructor(e){this.route=e,this.fetchFailed=!1,this.promisedAttempts=new M.a}get attempts(){return this.promisedAttempts.value}get groupInfo(){var e;return null===(e=this.attempts)||void 0===e?void 0:e.getSource().groupInfo}get selectedGroup(){var e;return null===(e=this.attempts)||void 0===e?void 0:e.getSource().selectedGroup}set selectedGroup(e){this.attempts&&(this.attempts.getSource().selectedGroup=e,this.attempts.getSource().setDirty(!0))}get identifiableAttempts(){var e,t;return null!==(t=null===(e=this.attempts)||void 0===e?void 0:e.getSource().identifiable)&&void 0!==t?t:[]}get identifiableAttemptsTotal(){var e,t;return null!==(t=null===(e=this.attempts)||void 0===e?void 0:e.getSource().identifiableTotal)&&void 0!==t?t:0}get anonymousAttempts(){var e,t;return null!==(t=null===(e=this.attempts)||void 0===e?void 0:e.getSource().anonymous)&&void 0!==t?t:[]}get anonymousAttemptsTotal(){var e,t;return null!==(t=null===(e=this.attempts)||void 0===e?void 0:e.getSource().anonymousTotal)&&void 0!==t?t:0}ngAfterViewInit(){return Object(f.a)(this,void 0,void 0,(function*(){try{const e=i.a.getRequiredRouteNumberParam("cmId"),t=i.a.getRequiredRouteNumberParam("courseId"),o=h.a.getOrCreateSource(P.a,[t,e]);o.selectedGroup=i.a.getRouteNumberParam("group")||0,this.promisedAttempts.resolve(new attempts_AddonModFeedbackAttemptsManager(o,this.route.component))}catch(e){return F.a.showErrorModal(e),i.a.back(),void 0}const e=yield this.promisedAttempts;try{this.fetchFailed=!1,yield e.getSource().loadFeedback(),yield e.load()}catch(e){this.fetchFailed=!0,F.a.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}yield e.start(this.splitView)}))}ngOnDestroy(){var e;null===(e=this.attempts)||void 0===e?void 0:e.destroy()}fetchMoreAttempts(e){return Object(f.a)(this,void 0,void 0,(function*(){const t=yield this.promisedAttempts;try{this.fetchFailed=!1,yield t.load()}catch(e){this.fetchFailed=!0,F.a.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}finally{e&&e()}}))}refreshFeedback(e){return Object(f.a)(this,void 0,void 0,(function*(){const t=yield this.promisedAttempts;try{this.fetchFailed=!1,yield v.a.ignoreErrors(t.getSource().invalidateCache()),yield t.getSource().loadFeedback(),yield t.reload()}catch(e){this.fetchFailed=!0,F.a.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}finally{e.complete()}}))}reloadAttempts(){return Object(f.a)(this,void 0,void 0,(function*(){const e=yield this.promisedAttempts;yield e.reload()}))}}return AddonModFeedbackAttemptsPage.ɵfac=function AddonModFeedbackAttemptsPage_Factory(e){return new(e||AddonModFeedbackAttemptsPage)(s.yc(n.a))},AddonModFeedbackAttemptsPage.ɵcmp=s.sc({type:AddonModFeedbackAttemptsPage,selectors:[["page-addon-mod-feedback-attempts"]],viewQuery:function AddonModFeedbackAttemptsPage_Query(e,t){var o;(1&e&&s.ud(k.a,!0),2&e)&&(s.dd(o=s.Nc())&&(t.splitView=o.first))},decls:20,vars:16,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"ion-no-margin"],["class","ion-text-wrap core-group-selector",4,"ngIf"],[4,"ngIf"],[3,"enabled","error","action"],[1,"ion-text-wrap","core-group-selector"],["id","addon-feedback-groupslabel"],["aria-labelledby","addon-feedback-groupslabel","interface","action-sheet",3,"ngModel","interfaceOptions","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","ion-text-wrap","button","","detail","true",3,"click",4,"ngFor","ngForOf"],["button","","detail","true",1,"ion-text-wrap",3,"click"],["slot","start",3,"user","linkProfile"],[1,"item-heading"],["slot","start",3,"linkProfile"]],template:function AddonModFeedbackAttemptsPage_Template(e,t){1&e&&(s.Ec(0,"ion-header"),s.Ec(1,"ion-toolbar"),s.Ec(2,"ion-buttons",0),s.zc(3,"ion-back-button",1),s.Pc(4,"translate"),s.Dc(),s.Ec(5,"ion-title"),s.Ec(6,"h1"),s.pd(7),s.Pc(8,"translate"),s.Dc(),s.Dc(),s.Dc(),s.Dc(),s.Ec(9,"ion-content"),s.Ec(10,"core-split-view"),s.Ec(11,"ion-refresher",2),s.Mc("ionRefresh",(function AddonModFeedbackAttemptsPage_Template_ion_refresher_ionRefresh_11_listener(e){return t.refreshFeedback(e.target)})),s.zc(12,"ion-refresher-content",3),s.Pc(13,"translate"),s.Dc(),s.Ec(14,"core-loading",4),s.Ec(15,"ion-list",5),s.nd(16,AddonModFeedbackAttemptsPage_ion_item_16_Template,7,9,"ion-item",6),s.nd(17,AddonModFeedbackAttemptsPage_ng_container_17_Template,7,7,"ng-container",7),s.nd(18,AddonModFeedbackAttemptsPage_ng_container_18_Template,7,7,"ng-container",7),s.Ec(19,"core-infinite-loading",8),s.Mc("action",(function AddonModFeedbackAttemptsPage_Template_core_infinite_loading_action_19_listener(e){return t.fetchMoreAttempts(e)})),s.Dc(),s.Dc(),s.Dc(),s.Dc(),s.Dc()),2&e&&(s.lc(3),s.Vc("text",s.Qc(4,10,"core.back")),s.lc(4),s.qd(s.Qc(8,12,"addon.mod_feedback.responses")),s.lc(4),s.Vc("disabled",!t.attempts||!t.attempts.loaded),s.lc(1),s.Wc("pullingText",s.Qc(13,14,"core.pulltorefresh")),s.lc(2),s.Vc("hideUntil",t.attempts&&t.attempts.loaded),s.lc(2),s.Vc("ngIf",t.groupInfo&&(t.groupInfo.separateGroups||t.groupInfo.visibleGroups)),s.lc(1),s.Vc("ngIf",t.identifiableAttemptsTotal>0),s.lc(1),s.Vc("ngIf",t.identifiableAttemptsTotal===t.identifiableAttempts.length&&t.anonymousAttemptsTotal>0),s.lc(1),s.Vc("enabled",t.attempts&&t.attempts.loaded&&!t.attempts.completed)("error",t.fetchFailed))},directives:[l.C,l.Ab,l.m,l.h,l.i,l.yb,u.a,l.v,k.a,l.bb,l.cb,I.a,l.P,y.t,D.a,l.I,l.O,l.lb,l.Ob,E.r,E.u,y.s,l.mb,l.J,T.a],pipes:[_.d,x.a],encapsulation:2}),AddonModFeedbackAttemptsPage})();class attempts_AddonModFeedbackAttemptsManager extends A.a{}var O=o("vY5A"),w=o("Y+03");const R=[{path:":courseId/:cmId",component:g},{path:":courseId/:cmId/form",loadChildren:()=>Promise.all([o.e(0),o.e(56)]).then(o.bind(null,"HFvr")).then((e=>e.AddonModFeedbackFormPageModule))},{path:":courseId/:cmId/nonrespondents",loadChildren:()=>o.e(57).then(o.bind(null,"B1At")).then((e=>e.AddonModFeedbackNonRespondentsPageModule))}],V=[...R,{path:":courseId/:cmId/attempts",component:C},{path:":courseId/:cmId/attempts/:attemptId",loadChildren:()=>o.e(12).then(o.bind(null,"LXV0")).then((e=>e.AddonModFeedbackAttemptPageModule))}],G=[...R,{path:":courseId/:cmId/attempts",component:C,children:[{path:":attemptId",loadChildren:()=>o.e(12).then(o.bind(null,"LXV0")).then((e=>e.AddonModFeedbackAttemptPageModule))}]}],S=[...Object(O.c)(V,(()=>w.a.isMobile)),...Object(O.c)(G,(()=>w.a.isTablet))];let z=(()=>{class AddonModFeedbackLazyModule{}return AddonModFeedbackLazyModule.ɵmod=s.wc({type:AddonModFeedbackLazyModule}),AddonModFeedbackLazyModule.ɵinj=s.vc({factory:function AddonModFeedbackLazyModule_Factory(e){return new(e||AddonModFeedbackLazyModule)},imports:[[n.m.forChild(S),a.a,d.a]]}),AddonModFeedbackLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&s.kd(z,{declarations:[g,C],imports:[n.m,a.a,d.a]}))},jVvP:function(e,t,o){"use strict";o.d(t,"a",(function(){return AddonModFeedbackAttemptsSource}));var n=o("mrSG"),a=o("CvRw"),d=o("mWdr"),c=o("MNPK"),i=o("96hm");class AddonModFeedbackAttemptsSource extends a.a{constructor(e,t){super(),this.COURSE_ID=e,this.CM_ID=t}getItemPath(e){return e.id.toString()}getPagesLoaded(){if(!this.identifiable||!this.anonymous)return 0;const e=this.getPageLength();return Math.ceil(Math.max(this.anonymous.length,this.identifiable.length)/e)}isIdentifiableAttempt(e){return"fullname"in e}isAnonymousAttempt(e){return"number"in e}invalidateCache(){return Object(n.a)(this,void 0,void 0,(function*(){yield Promise.all([d.a.invalidateActivityGroupInfo(this.CM_ID),this.feedback&&c.a.invalidateResponsesAnalysisData(this.feedback.id)])}))}loadFeedback(){return Object(n.a)(this,void 0,void 0,(function*(){this.feedback=yield c.a.getFeedback(this.COURSE_ID,this.CM_ID),this.groupInfo=yield d.a.getActivityGroupInfo(this.CM_ID),this.selectedGroup=d.a.validateGroupId(this.selectedGroup,this.groupInfo)}))}getPageLength(){return c.b.PER_PAGE}loadPageItems(e){return Object(n.a)(this,void 0,void 0,(function*(){if(!this.feedback)throw new Error("Can't load attempts without feeback");const t=yield i.a.getResponsesAnalysis(this.feedback.id,{page:e,groupId:this.selectedGroup,cmId:this.CM_ID});0===e&&(this.identifiableTotal=t.totalattempts,this.anonymousTotal=t.totalanonattempts);const o=this.getPageLength()*(e+1);return{items:[...0===e||t.totalattempts>c.b.PER_PAGE?t.attempts:[],...0===e||t.totalanonattempts>c.b.PER_PAGE?t.anonattempts:[]],hasMoreItems:t.totalattempts>o||t.totalanonattempts>o}}))}setItems(e,t){this.identifiable=e.filter(this.isIdentifiableAttempt),this.anonymous=e.filter(this.isAnonymousAttempt),super.setItems(this.identifiable.concat(this.anonymous),t)}}}}]);