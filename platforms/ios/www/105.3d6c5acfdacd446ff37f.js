(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{QXg6:function(n,e,o){"use strict";o.r(e),o.d(e,"CoreLoginReconnectPageModule",(function(){return y}));var t=o("tyNb"),i=o("L3Fv"),c=o("mrSG"),r=o("3Pt+"),a=o("nvXB"),s=o("9+EE"),g=o("3LXp"),l=o("bFG1"),d=o("mv9v"),_=o("fjkH"),u=o("93ts"),m=o("pHTc"),p=o("4reR"),f=o("fXoL"),h=o("TEn/"),P=o("nt/U"),C=o("ofXK"),O=o("NcPy"),b=o("hMzs"),M=o("3CSS"),v=o("lqoc"),w=o("ACYt"),k=o("sYmb");const R=["reconnectForm"],_c1=function(n){return{$a:n}};function CoreLoginReconnectPage_img_12_Template(n,e){if(1&n&&(f.zc(0,"img",14),f.Pc(1,"translate")),2&n){const n=f.Oc();f.Wc("alt",f.Rc(1,3,"core.pictureof",f.ad(6,_c1,n.userFullName))),f.Vc("src",n.userAvatar,f.id)("siteId",n.siteId)}}function CoreLoginReconnectPage_div_13_img_1_Template(n,e){if(1&n&&f.zc(0,"img",18),2&n){const n=f.Oc(2);f.Vc("src",n.logoUrl,f.id)}}function CoreLoginReconnectPage_div_13_img_2_Template(n,e){1&n&&f.zc(0,"img",19)}function CoreLoginReconnectPage_div_13_Template(n,e){if(1&n&&(f.Ec(0,"div",15),f.nd(1,CoreLoginReconnectPage_div_13_img_1_Template,1,1,"img",16),f.nd(2,CoreLoginReconnectPage_div_13_img_2_Template,1,0,"img",17),f.Dc()),2&n){const n=f.Oc();f.lc(1),f.Vc("ngIf",n.logoUrl),f.lc(1),f.Vc("ngIf",!n.logoUrl)}}function CoreLoginReconnectPage_p_14_Template(n,e){if(1&n&&(f.Ec(0,"p",20),f.zc(1,"core-format-text",21),f.Dc()),2&n){const n=f.Oc();f.lc(1),f.Vc("text",n.siteName)("filter",!1)}}function CoreLoginReconnectPage_ion_card_17_Template(n,e){1&n&&(f.Ec(0,"ion-card",22),f.Ec(1,"ion-item"),f.zc(2,"ion-icon",23),f.Ec(3,"ion-label"),f.Ec(4,"p"),f.pd(5),f.Pc(6,"translate"),f.Dc(),f.Dc(),f.Dc(),f.Dc()),2&n&&(f.lc(5),f.qd(f.Qc(6,1,"core.lostconnection")))}function CoreLoginReconnectPage_form_18_ng_container_20_Template(n,e){if(1&n){const n=f.Fc();f.Cc(0),f.Ec(1,"div",34),f.pd(2),f.Pc(3,"translate"),f.Dc(),f.Ec(4,"ion-button",35),f.Mc("click",(function CoreLoginReconnectPage_form_18_ng_container_20_Template_ion_button_click_4_listener(){f.fd(n);return f.Oc(2).showInstructionsAndScanQR()})),f.zc(5,"ion-icon",36),f.pd(6),f.Pc(7,"translate"),f.Dc(),f.Bc()}2&n&&(f.lc(2),f.qd(f.Qc(3,2,"core.login.or")),f.lc(4),f.rd(" ",f.Qc(7,4,"core.scanqr")," "))}function CoreLoginReconnectPage_form_18_Template(n,e){if(1&n){const n=f.Fc();f.Ec(0,"form",24,25),f.Mc("ngSubmit",(function CoreLoginReconnectPage_form_18_Template_form_ngSubmit_0_listener(e){f.fd(n);return f.Oc().login(e)})),f.Ec(2,"ion-item",26),f.Ec(3,"ion-label"),f.Ec(4,"p"),f.pd(5),f.Dc(),f.Dc(),f.Dc(),f.Ec(6,"ion-item",27),f.Ec(7,"ion-label",28),f.pd(8),f.Pc(9,"translate"),f.Dc(),f.Ec(10,"core-show-password",29),f.zc(11,"ion-input",30),f.Pc(12,"translate"),f.Dc(),f.Dc(),f.Ec(13,"div",31),f.Ec(14,"ion-button",32),f.Mc("click",(function CoreLoginReconnectPage_form_18_Template_ion_button_click_14_listener(e){f.fd(n);return f.Oc().cancel(e)})),f.pd(15),f.Pc(16,"translate"),f.Dc(),f.Ec(17,"ion-button",33),f.pd(18),f.Pc(19,"translate"),f.Dc(),f.Dc(),f.nd(20,CoreLoginReconnectPage_form_18_ng_container_20_Template,8,6,"ng-container",13),f.Dc()}if(2&n){const n=f.Oc();f.Vc("formGroup",n.credForm),f.lc(5),f.qd(n.username),f.lc(3),f.qd(f.Qc(9,9,"core.login.password")),f.lc(3),f.Wc("placeholder",f.Qc(12,11,"core.login.password")),f.Vc("clearOnEdit",!1),f.lc(4),f.rd(" ",f.Qc(16,13,"core.login.cancel")," "),f.lc(2),f.Vc("disabled",!n.credForm.valid),f.lc(1),f.rd(" ",f.Qc(19,15,"core.login.loginbutton")," "),f.lc(2),f.Vc("ngIf",n.showScanQR)}}function CoreLoginReconnectPage_ion_button_19_Template(n,e){if(1&n){const n=f.Fc();f.Ec(0,"ion-button",37),f.Mc("click",(function CoreLoginReconnectPage_ion_button_19_Template_ion_button_click_0_listener(){f.fd(n);return f.Oc().forgottenPassword()})),f.pd(1),f.Pc(2,"translate"),f.Dc()}2&n&&(f.lc(1),f.rd(" ",f.Qc(2,1,"core.login.forgotten")," "))}function CoreLoginReconnectPage_ion_list_20_ion_button_6_Template(n,e){if(1&n){const n=f.Fc();f.Ec(0,"ion-button",42),f.Mc("click",(function CoreLoginReconnectPage_ion_list_20_ion_button_6_Template_ion_button_click_0_listener(){f.fd(n);const o=e.$implicit;return f.Oc(2).oauthClicked(o)})),f.zc(1,"img",43),f.Ec(2,"ion-label"),f.pd(3),f.Dc(),f.Dc()}if(2&n){const n=e.$implicit;f.mc("aria-label",n.name),f.lc(1),f.Vc("src",n.iconurl,f.id),f.lc(2),f.qd(n.name)}}function CoreLoginReconnectPage_ion_list_20_Template(n,e){if(1&n&&(f.Ec(0,"ion-list",38),f.Ec(1,"ion-item",39),f.Ec(2,"ion-label"),f.Ec(3,"h3",40),f.pd(4),f.Pc(5,"translate"),f.Dc(),f.Dc(),f.Dc(),f.nd(6,CoreLoginReconnectPage_ion_list_20_ion_button_6_Template,4,3,"ion-button",41),f.Dc()),2&n){const n=f.Oc();f.lc(4),f.qd(f.Qc(5,2,"core.login.potentialidps")),f.lc(2),f.Vc("ngForOf",n.identityProviders)}}function CoreLoginReconnectPage_ion_list_21_Template(n,e){if(1&n){const n=f.Fc();f.Ec(0,"ion-list"),f.Ec(1,"ion-button",35),f.Mc("click",(function CoreLoginReconnectPage_ion_list_21_Template_ion_button_click_1_listener(e){f.fd(n);return f.Oc().cancel(e)})),f.pd(2),f.Pc(3,"translate"),f.Dc(),f.Dc()}2&n&&(f.lc(2),f.rd(" ",f.Qc(3,1,"core.login.cancel")," "))}const _c2=function(n){return{"item-avatar-center":n}};let L=(()=>{class CoreLoginReconnectPage{constructor(n){this.fb=n,this.showForgottenPassword=!0,this.showSiteAvatar=!1,this.isOAuth=!1,this.showScanQR=!1,this.viewLeft=!1,this.eventThrown=!1,this.loginSuccessful=!1;const e=s.b.getCurrentSite();this.isLoggedOut=!e||e.isLoggedOut(),this.credForm=n.group({password:["",r.F.required]})}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){try{this.siteId=m.a.getRequiredRouteParam("siteId");const n=m.a.getRouteParam("redirectPath"),e=m.a.getRouteParam("urlToOpen");(n||e)&&(this.redirectData={redirectPath:n,redirectOptions:m.a.getRouteParam("redirectOptions"),urlToOpen:e});const o=yield s.b.getSite(this.siteId);if(!o.infos)throw new u.a("Invalid site");this.username=o.infos.username,this.userFullName=o.infos.fullname,this.userAvatar=o.infos.userpictureurl,this.siteUrl=o.infos.siteurl,this.siteName=o.getSiteName(),this.isOAuth=o.isOAuth(),this.showSiteAvatar=!!this.userAvatar&&!d.a.getFixedSites(),this.checkSiteConfig(o)}catch(n){return g.a.showErrorModal(n),this.cancel()}}))}ngOnDestroy(){this.viewLeft=!0,_.b.trigger(_.b.LOGIN_SITE_UNCHECKED,{config:this.siteConfig,loginSuccessful:this.loginSuccessful},this.siteId)}checkSiteConfig(n){var e;return Object(c.a)(this,void 0,void 0,(function*(){if(this.siteConfig=yield l.a.ignoreErrors(n.getPublicConfig({readingStrategy:3})),!this.siteConfig)return;const o=d.a.getDisabledFeatures(this.siteConfig);this.identityProviders=d.a.getValidIdentityProviders(this.siteConfig,o),this.showForgottenPassword=!d.a.isForgottenPasswordDisabled(this.siteConfig),this.eventThrown||this.viewLeft||(this.eventThrown=!0,_.b.trigger(_.b.LOGIN_SITE_CHECKED,{config:this.siteConfig})),this.showScanQR=d.a.displayQRInSiteScreen()||d.a.displayQRInCredentialsScreen(this.siteConfig.tool_mobile_qrcodetype),yield s.b.checkApplication(this.siteConfig),(null===(e=this.userAvatar)||void 0===e?void 0:e.startsWith(this.siteUrl+"/theme/image.php"))&&(this.showSiteAvatar=!1),this.logoUrl=d.a.getLogoUrl(this.siteConfig)}))}cancel(n){n&&(n.preventDefault(),n.stopPropagation()),this.isLoggedOut&&m.a.navigate("/login/sites",{reset:!0}),s.b.logout()}login(n){return Object(c.a)(this,void 0,void 0,(function*(){n.preventDefault(),n.stopPropagation(),a.a.closeKeyboard();const e=this.credForm.value.password;if(!e)return g.a.showErrorModal("core.login.passwordrequired",!0),void 0;if(!a.a.isOnline())return g.a.showErrorModal("core.networkerrormsg",!0),void 0;const o=yield g.a.showModalLoading();try{const n=yield s.b.getUserToken(this.siteUrl,this.username,e);yield s.b.updateSiteToken(this.siteUrl,this.username,n.token,n.privateToken),p.a.triggerFormSubmittedEvent(this.formElement,!0),yield s.b.updateSiteInfoByUrl(this.siteUrl,this.username),this.credForm.controls.password.reset(),this.loginSuccessful=!0,yield m.a.navigateToSiteHome({params:this.redirectData})}catch(n){d.a.treatUserTokenError(this.siteUrl,n,this.username,e),n.loggedout?this.cancel():"forcepasswordchangenotice"==n.errorcode&&this.credForm.controls.password.reset()}finally{o.dismiss()}}))}forgottenPassword(){d.a.forgottenPasswordClicked(this.siteUrl,this.username,this.siteConfig)}oauthClicked(n){var e;d.a.openBrowserForOAuthLogin(this.siteUrl,n,null===(e=this.siteConfig)||void 0===e?void 0:e.launchurl,this.redirectData)||g.a.showErrorModal("Invalid data.")}showInstructionsAndScanQR(){return Object(c.a)(this,void 0,void 0,(function*(){try{yield d.a.showScanQRInstructions(),yield d.a.scanQR()}catch(n){}}))}keyDown(n){"Escape"==n.key&&(n.preventDefault(),n.stopPropagation())}keyUp(n){"Escape"==n.key&&this.cancel(n)}}return CoreLoginReconnectPage.ɵfac=function CoreLoginReconnectPage_Factory(n){return new(n||CoreLoginReconnectPage)(f.yc(r.f))},CoreLoginReconnectPage.ɵcmp=f.sc({type:CoreLoginReconnectPage,selectors:[["page-core-login-reconnect"]],viewQuery:function CoreLoginReconnectPage_Query(n,e){var o;(1&n&&f.ud(R,!0),2&n)&&(f.dd(o=f.Nc())&&(e.formElement=o.first))},decls:22,vars:18,consts:[["slot","start"],[3,"text"],[1,"ion-padding",3,"keydown","keyup"],[1,"list-item-limited-width"],[1,"ion-text-wrap","ion-text-center","ion-margin-bottom",3,"ngClass"],["class","large-avatar","core-external-content","","onError","this.src='assets/img/user-avatar.png'",3,"src","siteId","alt",4,"ngIf"],["class","core-login-site-logo",4,"ngIf"],["class","ion-padding core-sitename",4,"ngIf"],[1,"core-siteurl"],["class","core-danger-card core-login-reconnect-warning",4,"ngIf"],["class","core-login-form",3,"formGroup","ngSubmit",4,"ngIf"],["expand","block","fill","clear","class","core-login-forgotten-password core-button-as-link ion-text-wrap",3,"click",4,"ngIf"],["class","ion-padding-top core-login-identity-providers",4,"ngIf"],[4,"ngIf"],["core-external-content","","onError","this.src='assets/img/user-avatar.png'",1,"large-avatar",3,"src","siteId","alt"],[1,"core-login-site-logo"],["role","presentation","onError","this.src='assets/img/login_logo.png'","alt","",3,"src",4,"ngIf"],["src","assets/img/login_logo.png","role","presentation","alt","",4,"ngIf"],["role","presentation","onError","this.src='assets/img/login_logo.png'","alt","",3,"src"],["src","assets/img/login_logo.png","role","presentation","alt",""],[1,"ion-padding","core-sitename"],[3,"text","filter"],[1,"core-danger-card","core-login-reconnect-warning"],["name","fas-exclamation-circle","slot","start","aria-hidden","true"],[1,"core-login-form",3,"formGroup","ngSubmit"],["reconnectForm",""],[1,"ion-text-wrap","core-username","item-interactive"],[1,"ion-margin-bottom"],[1,"sr-only"],["name","password"],["name","password","type","password","formControlName","password","autocomplete","current-password","enterkeyhint","go","required","true",1,"core-ioninput-password",3,"placeholder","clearOnEdit"],[1,"adaptable-buttons-row"],["expand","block","fill","outline",1,"ion-margin","ion-text-wrap",3,"click"],["type","submit","expand","block",1,"ion-margin","core-login-login-button","ion-text-wrap",3,"disabled"],[1,"ion-text-center","ion-padding"],["expand","block","fill","outline",1,"ion-margin",3,"click"],["slot","start","name","fas-qrcode","aria-hidden","true"],["expand","block","fill","clear",1,"core-login-forgotten-password","core-button-as-link","ion-text-wrap",3,"click"],[1,"ion-padding-top","core-login-identity-providers"],[1,"ion-text-wrap"],[1,"item-heading"],["fill","outline","class","ion-text-wrap ion-margin core-oauth-provider","expand","block",3,"click",4,"ngFor","ngForOf"],["fill","outline","expand","block",1,"ion-text-wrap","ion-margin","core-oauth-provider",3,"click"],["alt","","width","32","height","32","slot","start",3,"src"]],template:function CoreLoginReconnectPage_Template(n,e){1&n&&(f.Ec(0,"ion-header"),f.Ec(1,"ion-toolbar"),f.Ec(2,"ion-buttons",0),f.zc(3,"ion-back-button",1),f.Pc(4,"translate"),f.Dc(),f.Ec(5,"ion-title"),f.Ec(6,"h1"),f.pd(7),f.Pc(8,"translate"),f.Dc(),f.Dc(),f.Dc(),f.Dc(),f.Ec(9,"ion-content",2),f.Mc("keydown",(function CoreLoginReconnectPage_Template_ion_content_keydown_9_listener(n){return e.keyDown(n)}))("keyup",(function CoreLoginReconnectPage_Template_ion_content_keyup_9_listener(n){return e.keyUp(n)})),f.Ec(10,"div",3),f.Ec(11,"div",4),f.nd(12,CoreLoginReconnectPage_img_12_Template,2,8,"img",5),f.nd(13,CoreLoginReconnectPage_div_13_Template,3,2,"div",6),f.nd(14,CoreLoginReconnectPage_p_14_Template,2,2,"p",7),f.Ec(15,"p",8),f.pd(16),f.Dc(),f.nd(17,CoreLoginReconnectPage_ion_card_17_Template,7,3,"ion-card",9),f.Dc(),f.nd(18,CoreLoginReconnectPage_form_18_Template,21,17,"form",10),f.nd(19,CoreLoginReconnectPage_ion_button_19_Template,3,3,"ion-button",11),f.nd(20,CoreLoginReconnectPage_ion_list_20_Template,7,4,"ion-list",12),f.nd(21,CoreLoginReconnectPage_ion_list_21_Template,4,3,"ion-list",13),f.Dc(),f.Dc()),2&n&&(f.lc(3),f.Vc("text",f.Qc(4,12,"core.back")),f.lc(4),f.qd(f.Qc(8,14,"core.login.reconnect")),f.lc(4),f.Vc("ngClass",f.ad(16,_c2,e.showSiteAvatar)),f.lc(1),f.Vc("ngIf",e.showSiteAvatar),f.lc(1),f.Vc("ngIf",!e.showSiteAvatar),f.lc(1),f.Vc("ngIf",e.siteName),f.lc(2),f.qd(e.siteUrl),f.lc(1),f.Vc("ngIf",!e.isLoggedOut),f.lc(1),f.Vc("ngIf",!e.isOAuth),f.lc(1),f.Vc("ngIf",e.showForgottenPassword&&!e.isOAuth),f.lc(1),f.Vc("ngIf",e.identityProviders&&e.identityProviders.length),f.lc(1),f.Vc("ngIf",e.isOAuth))},directives:[h.C,h.Ab,h.m,h.h,h.i,h.yb,P.a,h.v,C.q,C.t,O.a,b.a,h.n,h.I,h.D,M.a,h.O,r.H,r.s,r.k,v.a,h.H,h.Pb,r.r,r.i,r.C,w.a,h.l,h.P,C.s],pipes:[k.d],styles:["[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background:var(--core-login-background);--ion-item-background:var(--core-login-background)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color:var(--core-login-text-color);-webkit-text-decoration-color:var(--core-login-text-color);text-decoration-color:var(--core-login-text-color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--core-login-text-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item.item-input[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.ios[_ngcontent-%COMP%]{--inner-border-width:0 0 1px 0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background:var(--core-login-input-background);--color:var(--core-login-input-color)}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-username.item.md[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-left:unset;-webkit-padding-start:8px;padding-inline-start:8px}}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%] + .core-siteurl[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:0}[_nghost-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:5px auto}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}body.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], body.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background:var(--core-login-background-dark);--loading-text-color:#fff;--loading-spinner:#fff}"]}),CoreLoginReconnectPage})();const E=[{path:"",component:L}];let y=(()=>{class CoreLoginReconnectPageModule{}return CoreLoginReconnectPageModule.ɵmod=f.wc({type:CoreLoginReconnectPageModule}),CoreLoginReconnectPageModule.ɵinj=f.vc({factory:function CoreLoginReconnectPageModule_Factory(n){return new(n||CoreLoginReconnectPageModule)},imports:[[t.m.forChild(E),i.a],t.m]}),CoreLoginReconnectPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&f.kd(y,{declarations:[L],imports:[t.m,i.a],exports:[t.m]}))}}]);