(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{MncD:function(e,n,t){"use strict";t.r(n),t.d(n,"AddonCalendarDayPageModule",(function(){return G}));var a=t("tyNb"),i=t("L3Fv"),o=t("9Xwr"),d=t("mrSG"),r=t("nvXB"),c=t("fjkH"),l=t("9+EE"),s=t("3LXp"),m=t("Q98t"),_=t("SmTL"),g=t("Lc7R"),u=t("n6RP"),v=t("+lfu"),h=t("Xzvb"),f=t("ZSwf"),y=t("kLT3"),p=t("wd/R"),E=t.n(p),D=t("j3ag"),b=t("pHTc"),C=t("bFG1"),P=t("BaYo"),O=t("xQjX"),I=t("MpCO"),A=t("+0Ti"),T=t("fXoL"),M=t("TEn/"),S=t("ACYt"),x=t("3CSS"),w=t("fQ68"),k=t("ofXK"),N=t("8/N+"),V=t("nt/U"),j=t("PgjG"),F=t("r8G5"),z=t("hMzs"),L=t("eAud"),Q=t("yNDK"),U=t("sYmb");function AddonCalendarDayPage_core_context_menu_item_14_Template(e,n){if(1&e){const e=T.Fc();T.Ec(0,"core-context-menu-item",20),T.Mc("action",(function AddonCalendarDayPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){T.fd(e);return T.Oc().goToCurrentDay()})),T.Pc(1,"translate"),T.Dc()}2&e&&T.Vc("priority",900)("content",T.Qc(1,2,"addon.calendar.today"))}const _c0=function(e){return{$a:e}};function AddonCalendarDayPage_ng_template_37_ion_card_1_Template(e,n){1&e&&(T.Ec(0,"ion-card",24),T.Ec(1,"ion-item"),T.zc(2,"ion-icon",25),T.Ec(3,"ion-label"),T.pd(4),T.Pc(5,"translate"),T.Pc(6,"translate"),T.Dc(),T.Dc(),T.Dc()),2&e&&(T.lc(4),T.qd(T.Rc(5,1,"core.hasdatatosync",T.ad(6,_c0,T.Qc(6,4,"core.day")))))}function AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template(e,n){1&e&&(T.zc(0,"core-empty-box",26),T.Pc(1,"translate")),2&e&&T.Vc("message",T.Qc(1,1,"addon.calendar.noevents"))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template(e,n){if(1&e&&T.zc(0,"core-mod-icon",38),2&e){const e=T.Oc().$implicit;T.Vc("modicon",e.moduleIcon)("showAlt",!1)("modname",e.modulename)("componentId",e.instance)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template(e,n){if(1&e&&T.zc(0,"ion-icon",39),2&e){const e=T.Oc().$implicit;T.Vc("name",e.eventIcon)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template(e,n){if(1&e&&(T.Ec(0,"span",32),T.pd(1),T.Dc()),2&e){const e=T.Oc().$implicit;T.lc(1),T.qd(e.iconTitle)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_13_Template(e,n){1&e&&(T.Ec(0,"ion-note",2),T.zc(1,"ion-icon",40),T.Ec(2,"span",41),T.pd(3),T.Pc(4,"translate"),T.Dc(),T.Dc()),2&e&&(T.lc(3),T.qd(T.Qc(4,1,"core.notsent")))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template(e,n){1&e&&(T.Ec(0,"ion-note",2),T.zc(1,"ion-icon",42),T.Ec(2,"span",41),T.pd(3),T.Pc(4,"translate"),T.Dc(),T.Dc()),2&e&&(T.lc(3),T.qd(T.Qc(4,1,"core.deletedoffline")))}const _c1=function(e){return[e]};function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template(e,n){if(1&e){const e=T.Fc();T.Cc(0),T.Ec(1,"ion-card"),T.Ec(2,"ion-item",29),T.Mc("click",(function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template_ion_item_click_2_listener(){T.fd(e);const t=n.$implicit;return T.Oc(3).gotoEvent(t.id)})),T.nd(3,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template,1,4,"core-mod-icon",30),T.nd(4,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template,1,1,"ion-icon",31),T.Ec(5,"ion-label"),T.Ec(6,"span",32),T.pd(7),T.Pc(8,"translate"),T.nd(9,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template,2,1,"span",33),T.Dc(),T.Ec(10,"p",34),T.zc(11,"core-format-text",35),T.Dc(),T.zc(12,"p",36),T.Dc(),T.nd(13,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_13_Template,5,3,"ion-note",37),T.nd(14,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template,5,3,"ion-note",37),T.Dc(),T.Dc(),T.Bc()}if(2&e){const e=n.$implicit;T.lc(2),T.qc("item-dimmed",e.ispast),T.Vc("ngClass",T.ad(17,_c1,"addon-calendar-eventtype-"+e.eventtype))("detail",!1),T.mc("aria-label",e.name),T.lc(1),T.Vc("ngIf",e.moduleIcon),T.lc(1),T.Vc("ngIf",e.eventIcon&&!e.moduleIcon),T.lc(3),T.rd(" ",T.Qc(8,15,"addon.calendar.type"+e.formattedType)," "),T.lc(2),T.Vc("ngIf",e.moduleIcon&&e.iconTitle),T.lc(2),T.Vc("text",e.name)("contextLevel",e.contextLevel)("contextInstanceId",e.contextInstanceId),T.lc(1),T.Vc("innerHTML",e.formattedtime,T.gd),T.lc(1),T.Vc("ngIf",e.offline&&!e.deleted),T.lc(1),T.Vc("ngIf",e.deleted)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_Template(e,n){if(1&e&&(T.Ec(0,"ion-list",27),T.nd(1,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template,15,19,"ng-container",28),T.Dc()),2&e){const e=T.Oc().item;T.lc(1),T.Vc("ngForOf",e.filteredEvents)}}function AddonCalendarDayPage_ng_template_37_Template(e,n){if(1&e&&(T.Ec(0,"core-loading",9),T.nd(1,AddonCalendarDayPage_ng_template_37_ion_card_1_Template,7,8,"ion-card",21),T.nd(2,AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template,2,3,"core-empty-box",22),T.nd(3,AddonCalendarDayPage_ng_template_37_ion_list_3_Template,2,1,"ion-list",23),T.Dc()),2&e){const e=n.item;T.Vc("hideUntil",e.loaded),T.lc(1),T.Vc("ngIf",e.hasOffline),T.lc(1),T.Vc("ngIf",!e.filteredEvents||!e.filteredEvents.length),T.lc(1),T.Vc("ngIf",e.filteredEvents&&e.filteredEvents.length)}}function AddonCalendarDayPage_ion_fab_38_Template(e,n){if(1&e){const e=T.Fc();T.Ec(0,"ion-fab",43),T.Ec(1,"ion-fab-button",44),T.Mc("click",(function AddonCalendarDayPage_ion_fab_38_Template_ion_fab_button_click_1_listener(){T.fd(e);return T.Oc().openEdit()})),T.Pc(2,"translate"),T.zc(3,"ion-icon",45),T.Ec(4,"span",32),T.pd(5),T.Pc(6,"translate"),T.Dc(),T.Dc(),T.Dc()}2&e&&(T.lc(1),T.mc("aria-label",T.Qc(2,2,"addon.calendar.newevent")),T.lc(4),T.qd(T.Qc(6,4,"addon.calendar.newevent")))}let R=(()=>{class AddonCalendarDayPage{constructor(){this.loaded=!1,this.isOnline=!1,this.syncIcon=P.a.ICON_LOADING,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=l.b.getCurrentSiteId(),this.newEventObserver=c.b.on(_.c.NEW_EVENT_EVENT,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId),this.discardedObserver=c.b.on(_.c.NEW_EVENT_DISCARDED_EVENT,(()=>{var e;null===(e=this.manager)||void 0===e?void 0:e.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0)}),this.currentSiteId),this.editEventObserver=c.b.on(_.c.EDIT_EVENT_EVENT,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId),this.syncObserver=c.b.on(v.b.AUTO_SYNCED,(()=>{var e;null===(e=this.manager)||void 0===e?void 0:e.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0)}),this.currentSiteId),this.manualSyncObserver=c.b.on(v.b.MANUAL_SYNCED,(e=>{var n,t;const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();!e||"day"==e.source&&a&&e.moment&&a.moment.isSame(e.moment,"day")||(null===(t=this.manager)||void 0===t?void 0:t.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId),this.deleteEventObserver=c.b.on(_.c.DELETED_EVENT_EVENT,(e=>{var n,t;e&&!e.sent?null===(n=this.manager)||void 0===n?void 0:n.getSource().markAsDeleted(e.eventId,!0):(null===(t=this.manager)||void 0===t?void 0:t.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId),this.undeleteEventObserver=c.b.on(_.c.UNDELETED_EVENT_EVENT,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n?void 0:n.getSource().markAsDeleted(e.eventId,!1))}),this.currentSiteId),this.filterChangedObserver=c.b.on(_.c.FILTER_CHANGED_EVENT,(e=>Object(d.a)(this,void 0,void 0,(function*(){var n,t;this.filter=e,yield null===(n=this.manager)||void 0===n?void 0:n.getSource().loadCanCreate(this.filter.courseId),null===(t=this.manager)||void 0===t||t.getSource().filterAllDayEvents(this.filter)})))),this.onlineObserver=D.B.onChange().subscribe((()=>{D.C.run((()=>{this.isOnline=r.a.isOnline()}))}))}ngOnInit(){const e=[];C.a.enumKeys(_.b).forEach((n=>{var t;const a=_.b[n];this.filter[n]=null===(t=b.a.getRouteBooleanParam(n))||void 0===t||t,e.push(a)})),this.filter.courseId=b.a.getRouteNumberParam("courseId"),this.filter.categoryId=b.a.getRouteNumberParam("categoryId"),this.filter.filtered=void 0!==this.filter.courseId||e.some((e=>!this.filter[e]));const n=b.a.getRouteNumberParam("month"),t=new day_page_AddonCalendarDaySlidesItemsManagerSource(this,E()({year:b.a.getRouteNumberParam("year"),month:n?n-1:void 0,date:b.a.getRouteNumberParam("day")}));this.manager=new O.a(t),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onDayViewed(e)}}),this.fetchData(!0)}get canCreate(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().canCreate)||!1}get timeFormat(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().timeFormat)||"core.strftimetime"}fetchData(e){var n,t,a;return Object(d.a)(this,void 0,void 0,(function*(){this.syncIcon=P.a.ICON_LOADING,this.isOnline=r.a.isOnline(),e&&(yield this.sync());try{yield null===(n=this.manager)||void 0===n?void 0:n.getSource().fetchData(this.filter.courseId),yield null===(t=this.manager)||void 0===t?void 0:t.getSource().load(null===(a=this.manager)||void 0===a?void 0:a.getSelectedItem())}catch(e){s.a.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}this.loaded=!0,this.syncIcon=P.a.ICON_SYNC}))}onDayViewed(e){this.periodName=m.a.userDate(1e3*e.moment.unix(),"core.strftimedaydate")}doRefresh(e,n){return Object(d.a)(this,void 0,void 0,(function*(){this.loaded&&(yield this.refreshData(!0).finally((()=>{null==e?void 0:e.complete(),n&&n()})))}))}refreshData(e,n){var t,a;return Object(d.a)(this,void 0,void 0,(function*(){this.syncIcon=P.a.ICON_LOADING;const i=(null===(t=this.manager)||void 0===t?void 0:t.getSelectedItem())||null;yield null===(a=this.manager)||void 0===a?void 0:a.getSource().invalidateContent(i,!n),yield this.fetchData(e)}))}sync(e){var n,t;return Object(d.a)(this,void 0,void 0,(function*(){try{const e=yield v.a.syncEvents();if(e.warnings&&e.warnings.length&&s.a.showErrorModal(e.warnings[0]),e.updated){const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();e.source="day",e.moment=null==a?void 0:a.moment,null===(t=this.manager)||void 0===t||t.getSource().markAllItemsUnloaded(),c.b.trigger(v.b.MANUAL_SYNCED,e,this.currentSiteId)}}catch(n){e&&s.a.showErrorModalDefault(n,"core.errorsync",!0)}}))}selectedDayIsCurrent(){var e,n;return!!(null===(n=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem())||void 0===n?void 0:n.isCurrentDay)}gotoEvent(e){b.a.navigateToSitePath(`/calendar/event/${e}`)}openFilter(){var e;return Object(d.a)(this,void 0,void 0,(function*(){yield s.a.openSideModal({component:y.a,componentProps:{courses:null===(e=this.manager)||void 0===e?void 0:e.getSource().courses,filter:this.filter}})}))}openEdit(e){var n;const t={};if(!e){e=0;const a=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();if(a){const e=E()();t.timestamp=1e3*a.moment.clone().set({hour:e.hour(),minute:e.minute()}).unix()}}this.filter.courseId&&(t.courseId=this.filter.courseId),b.a.navigateToSitePath(`/calendar/edit/${e}`,{params:t})}selectedDayHasOffline(){var e;const n=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();return!!(null==n?void 0:n.hasOffline)}goToCurrentDay(){return Object(d.a)(this,void 0,void 0,(function*(){const e=this.manager,n=this.slides;if(!e||!n)return;const t={moment:E()()};this.loaded=!1;try{yield e.getSource().loadItem(t),n.slideToItem(t)}catch(e){s.a.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}finally{this.loaded=!0}}))}loadNext(){var e;return Object(d.a)(this,void 0,void 0,(function*(){null===(e=this.slides)||void 0===e?void 0:e.slideNext()}))}loadPrevious(){var e;return Object(d.a)(this,void 0,void 0,(function*(){null===(e=this.slides)||void 0===e?void 0:e.slidePrev()}))}ngOnDestroy(){var e,n,t,a,i,o,d,r,c,l;null===(e=this.newEventObserver)||void 0===e?void 0:e.off(),null===(n=this.discardedObserver)||void 0===n||n.off(),null===(t=this.editEventObserver)||void 0===t||t.off(),null===(a=this.deleteEventObserver)||void 0===a||a.off(),null===(i=this.undeleteEventObserver)||void 0===i||i.off(),null===(o=this.syncObserver)||void 0===o||o.off(),null===(d=this.manualSyncObserver)||void 0===d||d.off(),null===(r=this.onlineObserver)||void 0===r||r.unsubscribe(),null===(c=this.filterChangedObserver)||void 0===c||c.off(),null===(l=this.manager)||void 0===l||l.destroy(),this.managerUnsubscribe&&this.managerUnsubscribe()}}return AddonCalendarDayPage.ɵfac=function AddonCalendarDayPage_Factory(e){return new(e||AddonCalendarDayPage)},AddonCalendarDayPage.ɵcmp=T.sc({type:AddonCalendarDayPage,selectors:[["page-addon-calendar-day"]],viewQuery:function AddonCalendarDayPage_Query(e,n){var t;(1&e&&T.ud(I.a,!0),2&e)&&(T.dd(t=T.Nc())&&(n.slides=t.first))},decls:39,vars:31,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-calendar-day",3,"priority","content","action",4,"ngIf"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"core-swipe-slides-container"],[1,"ion-no-padding","safe-area-padding"],[1,"ion-align-items-center"],[1,"ion-text-start"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],[1,"ion-text-center","addon-calendar-period"],[1,"ion-text-end"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"],[3,"manager"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-calendar-day",3,"priority","content","action"],["class","core-warning-card list-item-limited-width",4,"ngIf"],["icon","fas-calendar",3,"message",4,"ngIf"],["class","list-item-limited-width",4,"ngIf"],[1,"core-warning-card","list-item-limited-width"],["name","fas-exclamation-triangle","slot","start","aria-hidden","true"],["icon","fas-calendar",3,"message"],[1,"list-item-limited-width"],[4,"ngFor","ngForOf"],["button","",1,"addon-calendar-event","ion-text-wrap",3,"ngClass","detail","click"],["slot","start",3,"modicon","showAlt","modname","componentId",4,"ngIf"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],[1,"item-heading"],[3,"text","contextLevel","contextInstanceId"],[3,"innerHTML"],["slot","end",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId"],["slot","start","aria-hidden","true",3,"name"],["name","fas-clock","aria-hidden","true"],[1,"ion-text-wrap"],["name","fas-trash","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"]],template:function AddonCalendarDayPage_Template(e,n){1&e&&(T.Ec(0,"ion-header"),T.Ec(1,"ion-toolbar"),T.Ec(2,"ion-buttons",0),T.zc(3,"ion-back-button",1),T.Pc(4,"translate"),T.Dc(),T.Ec(5,"ion-title"),T.Ec(6,"h1"),T.pd(7),T.Pc(8,"translate"),T.Dc(),T.Dc(),T.Ec(9,"ion-buttons",2),T.Ec(10,"ion-button",3),T.Mc("click",(function AddonCalendarDayPage_Template_ion_button_click_10_listener(){return n.openFilter()})),T.Pc(11,"translate"),T.zc(12,"ion-icon",4),T.Dc(),T.Ec(13,"core-context-menu"),T.nd(14,AddonCalendarDayPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5),T.Ec(15,"core-context-menu-item",6),T.Mc("action",(function AddonCalendarDayPage_Template_core_context_menu_item_action_15_listener(e){return n.doRefresh(void 0,e)})),T.Pc(16,"translate"),T.Dc(),T.Dc(),T.Dc(),T.Dc(),T.Dc(),T.Ec(17,"ion-content"),T.Ec(18,"ion-refresher",7),T.Mc("ionRefresh",(function AddonCalendarDayPage_Template_ion_refresher_ionRefresh_18_listener(e){return n.doRefresh(e.target)})),T.zc(19,"ion-refresher-content",8),T.Pc(20,"translate"),T.Dc(),T.Ec(21,"core-loading",9),T.Ec(22,"div",10),T.Ec(23,"ion-grid",11),T.Ec(24,"ion-row",12),T.Ec(25,"ion-col",13),T.Ec(26,"ion-button",3),T.Mc("click",(function AddonCalendarDayPage_Template_ion_button_click_26_listener(){return n.loadPrevious()})),T.Pc(27,"translate"),T.zc(28,"ion-icon",14),T.Dc(),T.Dc(),T.Ec(29,"ion-col",15),T.Ec(30,"h3"),T.pd(31),T.Dc(),T.Dc(),T.Ec(32,"ion-col",16),T.Ec(33,"ion-button",3),T.Mc("click",(function AddonCalendarDayPage_Template_ion_button_click_33_listener(){return n.loadNext()})),T.Pc(34,"translate"),T.zc(35,"ion-icon",17),T.Dc(),T.Dc(),T.Dc(),T.Dc(),T.Ec(36,"core-swipe-slides",18),T.nd(37,AddonCalendarDayPage_ng_template_37_Template,4,4,"ng-template"),T.Dc(),T.Dc(),T.Dc(),T.nd(38,AddonCalendarDayPage_ion_fab_38_Template,7,6,"ion-fab",19),T.Dc()),2&e&&(T.lc(3),T.Vc("text",T.Qc(4,17,"core.back")),T.lc(4),T.qd(T.Qc(8,19,"addon.calendar.calendarevents")),T.lc(3),T.mc("aria-label",T.Qc(11,21,"core.filter")),T.lc(4),T.Vc("ngIf",!n.selectedDayIsCurrent()),T.lc(1),T.Vc("hidden",!n.loaded||!n.selectedDayHasOffline()||!n.isOnline)("priority",400)("content",T.Qc(16,23,"core.settings.synchronizenow"))("iconAction",n.syncIcon)("closeOnClick",!1),T.lc(3),T.Vc("disabled",!n.loaded),T.lc(1),T.Wc("pullingText",T.Qc(20,25,"core.pulltorefresh")),T.lc(2),T.Vc("hideUntil",n.loaded),T.lc(5),T.mc("aria-label",T.Qc(27,27,"addon.calendar.dayprev")),T.lc(5),T.qd(n.periodName),T.lc(2),T.mc("aria-label",T.Qc(34,29,"addon.calendar.daynext")),T.lc(3),T.Vc("manager",n.manager),T.lc(2),T.Vc("ngIf",n.canCreate&&n.loaded))},directives:[M.C,M.Ab,M.m,M.h,M.i,M.yb,S.a,M.l,M.D,x.a,w.a,k.t,N.a,V.a,M.v,M.bb,M.cb,j.a,M.B,M.hb,M.u,I.a,M.n,M.I,M.O,F.a,M.P,k.s,k.q,z.a,L.a,M.W,M.x,Q.a,M.y],pipes:[U.d],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color:var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical:12px;--margin-end:12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-right:var(--margin-end)}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{margin-right:unset;-webkit-margin-end:var(--margin-end);margin-inline-end:var(--margin-end)}}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}","[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{flex:none;width:100%}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]{flex-grow:3}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:10px;font-size:1.2rem}"]}),AddonCalendarDayPage})();class day_page_AddonCalendarDaySlidesItemsManagerSource extends A.a{constructor(e,n){super({moment:n}),this.courses=[],this.offlineEvents={},this.offlineEditedEventsIds=[],this.canCreate=!1,this.dayPage=e}fetchData(e){return Object(d.a)(this,void 0,void 0,(function*(){yield Promise.all([this.loadCourses(e),this.loadCanCreate(e),this.loadCategories(),this.loadOfflineEvents(),this.loadOfflineDeletedEvents(),this.loadTimeFormat()])}))}filterAllDayEvents(e){var n;null===(n=this.getItems())||void 0===n?void 0:n.forEach((n=>this.filterEvents(n,e)))}filterEvents(e,n){e.filteredEvents=u.b.getFilteredEvents(e.events||[],n,this.categories||{})}loadCourses(e){return Object(d.a)(this,void 0,void 0,(function*(){const n=yield f.a.getCoursesForPopover(e);this.courses=n.courses}))}loadCanCreate(e){return Object(d.a)(this,void 0,void 0,(function*(){this.canCreate=yield u.b.canEditEvents(e)}))}loadCategories(){return Object(d.a)(this,void 0,void 0,(function*(){if(!this.categories)try{const e=yield h.a.getCategories(0,!0);this.categories=C.a.arrayToObject(e,"id")}catch(e){}}))}loadOfflineEvents(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield g.a.getAllEditedEvents();this.offlineEvents=u.b.classifyIntoMonths(e),this.offlineEditedEventsIds=e.filter((e=>e.id>0)).map((e=>e.id))}))}loadOfflineDeletedEvents(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield g.a.getAllDeletedEventsIds();this.deletedEvents=new Set(e)}))}loadTimeFormat(){return Object(d.a)(this,void 0,void 0,(function*(){this.timeFormat=yield _.a.getCalendarTimeFormat()}))}getItemId(e){return u.b.getDayId(e.moment)}getPreviousItem(e){return{moment:e.moment.clone().subtract(1,"day")}}getNextItem(e){return{moment:e.moment.clone().add(1,"day")}}loadItemData(e,n=!1){return Object(d.a)(this,void 0,void 0,(function*(){const t=Object.assign(Object.assign({},e),{hasOffline:!1,events:[],onlineEvents:[],filteredEvents:[],isCurrentDay:e.moment.isSame(E()(),"day"),isPastDay:e.moment.isBefore(E()(),"day")});if(n)return t;let a;try{a=yield _.a.getDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date()),t.onlineEvents=yield Promise.all(a.events.map((e=>u.b.formatEventData(e))))}catch(e){if(r.a.isOnline())throw e}t.events=this.mergeEvents(t),this.filterEvents(t,this.dayPage.filter);const i=1e3*e.moment.unix(),o=m.a.timestamp(),c=t.events.map((e=>Object(d.a)(this,void 0,void 0,(function*(){e.ispast=t.isPastDay||t.isCurrentDay&&this.isEventPast(e,o),e.formattedtime=yield _.a.formatEventTime(e,this.dayPage.timeFormat,!0,i)}))));return yield Promise.all(c),t}))}isEventPast(e,n){return e.timestart+e.timeduration<n}mergeEvents(e){var n,t,a;if(e.hasOffline=!1,!Object.keys(this.offlineEvents).length&&!(null===(n=this.deletedEvents)||void 0===n?void 0:n.size))return e.onlineEvents||[];const i=this.offlineEvents[u.b.getMonthId(e.moment)],o=i&&i[e.moment.date()];let d=e.onlineEvents||[];return(null===(t=this.deletedEvents)||void 0===t?void 0:t.size)&&d.forEach((n=>{var t;n.deleted=null===(t=this.deletedEvents)||void 0===t?void 0:t.has(n.id),n.deleted&&(e.hasOffline=!0)})),this.offlineEditedEventsIds.length&&(d=d.filter((e=>-1==this.offlineEditedEventsIds.indexOf(e.id))),d.length!=(null===(a=e.onlineEvents)||void 0===a?void 0:a.length)&&(e.hasOffline=!0)),o&&o.length&&(e.hasOffline=!0,d=u.b.sortEvents(d.concat(o))),d}invalidateContent(e,n){return Object(d.a)(this,void 0,void 0,(function*(){const t=[];n&&e&&t.push(_.a.invalidateDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date())),t.push(_.a.invalidateAllowedEventTypes()),t.push(h.a.invalidateCategories(0,!0)),t.push(_.a.invalidateTimeFormat()),this.categories=void 0,e&&(e.dirty=!0),yield Promise.all(t)}))}markAsDeleted(e,n){var t,a,i;null===(t=this.getItems())||void 0===t?void 0:t.some((t=>{var a,i,o,d;const r=null===(a=t.onlineEvents)||void 0===a?void 0:a.find((n=>n.id==e));return!!r&&(r.deleted=n,t.hasOffline=!!n||((null===(i=t.events)||void 0===i?void 0:i.length)!=(null===(o=t.onlineEvents)||void 0===o?void 0:o.length)||(null===(d=t.events)||void 0===d?void 0:d.some((e=>e.deleted||e.offline)))),!0)})),n?null===(a=this.deletedEvents)||void 0===a||a.add(e):null===(i=this.deletedEvents)||void 0===i||i.delete(e)}}const q=[{path:"",component:R}];let G=(()=>{class AddonCalendarDayPageModule{}return AddonCalendarDayPageModule.ɵmod=T.wc({type:AddonCalendarDayPageModule}),AddonCalendarDayPageModule.ɵinj=T.vc({factory:function AddonCalendarDayPageModule_Factory(e){return new(e||AddonCalendarDayPageModule)},imports:[[a.m.forChild(q),i.a,o.a],a.m]}),AddonCalendarDayPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&T.kd(G,{declarations:[R],imports:[a.m,i.a,o.a],exports:[a.m]}))}}]);