(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{NNBU:function(i,t,n){"use strict";n.r(t),n.d(t,"AddonNotificationsListPageModule",(function(){return z}));var o=n("tyNb"),e=n("L3Fv"),a=n("mrSG"),c=n("9+EE"),r=n("3LXp"),s=n("bFG1"),d=n("fjkH"),l=n("yjU1"),_=n("2eZG"),f=n("ssuw"),g=n("YyYz"),m=n("pHTc"),p=n("Q98t"),u=n("fXoL"),h=n("TEn/"),P=n("C1x5"),b=n("nt/U"),A=n("PgjG"),v=n("ofXK"),M=n("xpMl"),N=n("3jOR"),O=n("hMzs"),x=n("FeAf"),L=n("eAud"),C=n("3CSS"),k=n("r8G5"),w=n("sYmb"),y=n("lAaw");function AddonNotificationsListPage_ion_item_16_core_user_avatar_2_div_1_Template(i,t){if(1&i&&(u.Ec(0,"div",21),u.zc(1,"img",22),u.Dc()),2&i){const i=u.Oc(2).$implicit;u.lc(1),u.Vc("src",i.iconurl,u.id)}}function AddonNotificationsListPage_ion_item_16_core_user_avatar_2_core_mod_icon_2_Template(i,t){if(1&i&&u.zc(0,"core-mod-icon",23),2&i){const i=u.Oc(2).$implicit;u.Vc("modicon",i.iconurl)("modname",i.modname)("showAlt",!1)}}function AddonNotificationsListPage_ion_item_16_core_user_avatar_2_Template(i,t){if(1&i&&(u.Ec(0,"core-user-avatar",18),u.nd(1,AddonNotificationsListPage_ion_item_16_core_user_avatar_2_div_1_Template,2,1,"div",19),u.nd(2,AddonNotificationsListPage_ion_item_16_core_user_avatar_2_core_mod_icon_2_Template,1,3,"core-mod-icon",20),u.Dc()),2&i){const i=u.Oc().$implicit;u.Vc("user",i)("profileUrl",i.profileimageurlfrom)("fullname",i.userfromfullname)("userId",i.useridfrom),u.lc(1),u.Vc("ngIf",i.iconurl&&!i.modname),u.lc(1),u.Vc("ngIf",i.modname)}}function AddonNotificationsListPage_ion_item_16_ng_container_3_div_1_Template(i,t){if(1&i&&(u.Ec(0,"div",26),u.zc(1,"img",22),u.Dc()),2&i){const i=u.Oc(2).$implicit;u.lc(1),u.Vc("src",i.iconurl,u.id)}}function AddonNotificationsListPage_ion_item_16_ng_container_3_core_mod_icon_2_Template(i,t){if(1&i&&u.zc(0,"core-mod-icon",27),2&i){const i=u.Oc(2).$implicit;u.Vc("modicon",i.iconurl)("modname",i.modname)("showAlt",!1)}}function AddonNotificationsListPage_ion_item_16_ng_container_3_Template(i,t){if(1&i&&(u.Cc(0),u.nd(1,AddonNotificationsListPage_ion_item_16_ng_container_3_div_1_Template,2,1,"div",24),u.nd(2,AddonNotificationsListPage_ion_item_16_ng_container_3_core_mod_icon_2_Template,1,3,"core-mod-icon",25),u.Bc()),2&i){const i=u.Oc().$implicit;u.lc(1),u.Vc("ngIf",!i.modname),u.lc(1),u.Vc("ngIf",i.modname)}}function AddonNotificationsListPage_ion_item_16_ng_container_10_Template(i,t){if(1&i&&(u.Cc(0),u.pd(1),u.Bc()),2&i){const i=u.Oc().$implicit;u.lc(1),u.rd(" · ",i.userfromfullname,"")}}function AddonNotificationsListPage_ion_item_16_ion_note_11_Template(i,t){1&i&&(u.Ec(0,"ion-note",2),u.zc(1,"ion-icon",28),u.Dc())}const _c0=function(i){return{$a:i}};function AddonNotificationsListPage_ion_item_16_Template(i,t){if(1&i){const i=u.Fc();u.Ec(0,"ion-item",12),u.Mc("click",(function AddonNotificationsListPage_ion_item_16_Template_ion_item_click_0_listener(){u.fd(i);const n=t.$implicit;return u.Oc().openNotification(n)})),u.Pc(1,"translate"),u.nd(2,AddonNotificationsListPage_ion_item_16_core_user_avatar_2_Template,3,6,"core-user-avatar",13),u.nd(3,AddonNotificationsListPage_ion_item_16_ng_container_3_Template,3,2,"ng-container",14),u.Ec(4,"ion-label"),u.Ec(5,"p",15),u.zc(6,"core-format-text",16),u.Dc(),u.Ec(7,"p"),u.pd(8),u.Pc(9,"coreTimeAgo"),u.nd(10,AddonNotificationsListPage_ion_item_16_ng_container_10_Template,2,1,"ng-container",14),u.Dc(),u.Dc(),u.nd(11,AddonNotificationsListPage_ion_item_16_ion_note_11_Template,2,0,"ion-note",17),u.Dc()}if(2&i){const i=t.$implicit;u.Vc("detail",!1),u.mc("aria-label",i.timeread?i.subject:u.Rc(1,10,"addon.notifications.unreadnotification",u.ad(15,_c0,i.subject))),u.lc(2),u.Vc("ngIf",i.useridfrom>0),u.lc(1),u.Vc("ngIf",i.useridfrom<=0&&i.iconurl),u.lc(3),u.Vc("text",i.subject)("contextInstanceId",0)("wsNotFiltered",!0),u.lc(2),u.qd(u.Qc(9,13,i.timecreated)),u.lc(2),u.Vc("ngIf",i.useridfrom>0),u.lc(1),u.Vc("ngIf",!i.timeread)}}function AddonNotificationsListPage_core_empty_box_17_Template(i,t){1&i&&(u.zc(0,"core-empty-box",29),u.Pc(1,"translate")),2&i&&u.Vc("message",u.Qc(1,1,"addon.notifications.therearentnotificationsyet"))}function AddonNotificationsListPage_ion_chip_20_ion_icon_1_Template(i,t){1&i&&u.zc(0,"ion-icon",32)}function AddonNotificationsListPage_ion_chip_20_ion_spinner_2_Template(i,t){1&i&&(u.zc(0,"ion-spinner"),u.Pc(1,"translate")),2&i&&u.mc("aria-label",u.Qc(1,1,"core.loading"))}function AddonNotificationsListPage_ion_chip_20_Template(i,t){if(1&i){const i=u.Fc();u.Ec(0,"ion-chip",30),u.Mc("click",(function AddonNotificationsListPage_ion_chip_20_Template_ion_chip_click_0_listener(){u.fd(i);return u.Oc().markAllNotificationsAsRead()})),u.nd(1,AddonNotificationsListPage_ion_chip_20_ion_icon_1_Template,1,0,"ion-icon",31),u.nd(2,AddonNotificationsListPage_ion_chip_20_ion_spinner_2_Template,2,3,"ion-spinner",14),u.pd(3),u.Pc(4,"translate"),u.Dc()}if(2&i){const i=u.Oc();u.Vc("disabled",i.loadingMarkAllNotificationsAsRead),u.lc(1),u.Vc("ngIf",!i.loadingMarkAllNotificationsAsRead),u.lc(1),u.Vc("ngIf",i.loadingMarkAllNotificationsAsRead),u.lc(1),u.rd(" ",u.Qc(4,4,"addon.notifications.markallread")," ")}}let E=(()=>{class AddonNotificationsListPage{constructor(){this.notifications=[],this.notificationsLoaded=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.canMarkAllNotificationsAsRead=!1,this.loadingMarkAllNotificationsAsRead=!1,this.pendingRefresh=!1}ngOnInit(){this.fetchNotifications(),this.cronObserver=d.b.on(l.b.READ_CRON_EVENT,(()=>{this.isCurrentView&&(this.notificationsLoaded=!1,this.refreshNotifications())}),c.b.getCurrentSiteId()),this.pushObserver=_.a.on("receive").subscribe((i=>{if(!this.isCurrentView)return this.pendingRefresh=!0,void 0;s.a.isTrueOrOne(i.notif)&&c.b.isCurrentSite(i.site)&&(this.notificationsLoaded=!1,this.refreshNotifications())})),this.readObserver=d.b.on(l.b.READ_CHANGED_EVENT,(i=>{if(!i.id)return;const t=this.notifications.find((t=>t.id===i.id));t&&(t.read=!0,t.timeread=i.time,this.loadMarkAllAsReadButton())}));(new g.a).treatLink()}fetchNotifications(i){return Object(a.a)(this,void 0,void 0,(function*(){this.loadMoreError=!1;try{const t=yield l.a.getNotifications(i?[]:this.notifications),n=t.notifications.map((i=>f.a.formatNotificationText(i)));this.notifications=i?n:this.notifications.concat(n),this.canLoadMore=t.canLoadMore,yield this.loadMarkAllAsReadButton()}catch(i){r.a.showErrorModalDefault(i,"addon.notifications.errorgetnotifications",!0),this.loadMoreError=!0}finally{this.notificationsLoaded=!0}}))}markAllNotificationsAsRead(){return Object(a.a)(this,void 0,void 0,(function*(){this.loadingMarkAllNotificationsAsRead=!0,yield s.a.ignoreErrors(l.a.markAllNotificationsAsRead()),d.b.trigger(l.b.READ_CHANGED_EVENT,{time:p.a.timestamp()},c.b.getCurrentSiteId()),this.notificationsLoaded=!1,yield this.refreshNotifications()}))}loadMarkAllAsReadButton(){return Object(a.a)(this,void 0,void 0,(function*(){try{this.loadingMarkAllNotificationsAsRead=!0;const i=yield l.a.getUnreadNotificationsCount();this.canMarkAllNotificationsAsRead=i.count>0}finally{this.loadingMarkAllNotificationsAsRead=!1}}))}refreshNotifications(i){return Object(a.a)(this,void 0,void 0,(function*(){yield s.a.ignoreErrors(l.a.invalidateNotificationsList());try{yield this.fetchNotifications(!0)}finally{null==i?void 0:i.complete()}}))}loadMoreNotifications(i){return Object(a.a)(this,void 0,void 0,(function*(){try{yield this.fetchNotifications()}finally{null==i?void 0:i()}}))}openNotification(i){m.a.navigate("../notification",{params:{notification:i}})}ionViewDidEnter(){this.isCurrentView=!0,this.pendingRefresh&&(this.pendingRefresh=!1,this.notificationsLoaded=!1,this.refreshNotifications())}ionViewDidLeave(){this.isCurrentView=!1}ngOnDestroy(){var i,t,n;null===(i=this.cronObserver)||void 0===i?void 0:i.off(),null===(t=this.readObserver)||void 0===t||t.off(),null===(n=this.pushObserver)||void 0===n||n.unsubscribe()}}return AddonNotificationsListPage.ɵfac=function AddonNotificationsListPage_Factory(i){return new(i||AddonNotificationsListPage)},AddonNotificationsListPage.ɵcmp=u.sc({type:AddonNotificationsListPage,selectors:[["page-addon-notifications-list"]],decls:21,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap","button","","lines","full",3,"detail","click",4,"ngFor","ngForOf"],["icon","far-bell",3,"message",4,"ngIf"],[3,"enabled","error","action"],["slot","fixed","collapsible-footer","","appearOnBottom","",1,"mark-all-as-read"],["color","primary",3,"disabled","click",4,"ngIf"],["button","","lines","full",1,"ion-text-wrap",3,"detail","click"],["slot","start",3,"user","profileUrl","fullname","userId",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId","wsNotFiltered"],["slot","end",4,"ngIf"],["slot","start",3,"user","profileUrl","fullname","userId"],["class","core-avatar-extra-img",4,"ngIf"],[3,"modicon","modname","showAlt",4,"ngIf"],[1,"core-avatar-extra-img"],["alt","","role","presentation",3,"src"],[3,"modicon","modname","showAlt"],["class","core-notification-icon","slot","start",4,"ngIf"],["class","core-notification-icon","slot","start",3,"modicon","modname","showAlt",4,"ngIf"],["slot","start",1,"core-notification-icon"],["slot","start",1,"core-notification-icon",3,"modicon","modname","showAlt"],["name","fas-circle","color","primary","aria-hidden","true"],["icon","far-bell",3,"message"],["color","primary",3,"disabled","click"],["name","fas-eye","aria-hidden","true",4,"ngIf"],["name","fas-eye","aria-hidden","true"]],template:function AddonNotificationsListPage_Template(i,t){1&i&&(u.Ec(0,"ion-header"),u.Ec(1,"ion-toolbar"),u.Ec(2,"ion-buttons",0),u.zc(3,"ion-back-button",1),u.Pc(4,"translate"),u.Dc(),u.Ec(5,"ion-title"),u.Ec(6,"h1"),u.pd(7),u.Pc(8,"translate"),u.Dc(),u.Dc(),u.Ec(9,"ion-buttons",2),u.zc(10,"core-user-menu-button"),u.Dc(),u.Dc(),u.Dc(),u.Ec(11,"ion-content",3),u.Ec(12,"ion-refresher",4),u.Mc("ionRefresh",(function AddonNotificationsListPage_Template_ion_refresher_ionRefresh_12_listener(i){return t.refreshNotifications(i.target)})),u.zc(13,"ion-refresher-content",5),u.Pc(14,"translate"),u.Dc(),u.Ec(15,"core-loading",6),u.nd(16,AddonNotificationsListPage_ion_item_16_Template,12,17,"ion-item",7),u.nd(17,AddonNotificationsListPage_core_empty_box_17_Template,2,3,"core-empty-box",8),u.Ec(18,"core-infinite-loading",9),u.Mc("action",(function AddonNotificationsListPage_Template_core_infinite_loading_action_18_listener(i){return t.loadMoreNotifications(i)})),u.Dc(),u.Dc(),u.Ec(19,"div",10),u.nd(20,AddonNotificationsListPage_ion_chip_20_Template,5,6,"ion-chip",11),u.Dc(),u.Dc()),2&i&&(u.lc(3),u.Vc("text",u.Qc(4,10,"core.back")),u.lc(4),u.qd(u.Qc(8,12,"addon.notifications.notifications")),u.lc(5),u.Vc("disabled",!t.notificationsLoaded),u.lc(1),u.Wc("pullingText",u.Qc(14,14,"core.pulltorefresh")),u.lc(2),u.Vc("hideUntil",t.notificationsLoaded),u.lc(1),u.Vc("ngForOf",t.notifications),u.lc(1),u.Vc("ngIf",!t.notifications||t.notifications.length<=0),u.lc(1),u.Vc("enabled",t.canLoadMore)("error",t.loadMoreError),u.lc(2),u.Vc("ngIf",t.notificationsLoaded&&t.canMarkAllNotificationsAsRead))},directives:[h.C,h.Ab,h.m,h.h,h.i,h.yb,P.a,b.a,h.v,h.bb,h.cb,A.a,v.s,v.t,M.a,N.a,h.I,h.O,O.a,x.a,L.a,h.W,h.D,C.a,k.a,h.t,h.qb],pipes:[w.d,y.a],styles:["ion-item[_ngcontent-%COMP%]{--icon-size:16px;--extra-icon-size:12px;--core-avatar-size:32px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]{font-size:var(--text-size);-webkit-line-clamp:3;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;display:-webkit-box}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin:0;padding-left:8px;padding-right:0;padding-top:12px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{padding-left:unset;padding-right:unset;-webkit-padding-start:8px;padding-inline-start:8px;-webkit-padding-end:0;padding-inline-end:0}}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:6px;vertical-align:middle}ion-item[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{align-self:start;margin-top:16px}ion-item[_ngcontent-%COMP%]   core-mod-icon.core-notification-icon[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:8px;max-width:var(--core-avatar-size);max-height:var(--core-avatar-size)}.mark-all-as-read[_ngcontent-%COMP%]{padding-bottom:16px;bottom:0;left:0;right:0;display:flex;background:transparent;box-shadow:none;pointer-events:none}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]{pointer-events:all;margin:0 auto;box-shadow:0 2px 4px rgba(0,0,0,.4)}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:16px;height:16px;margin-left:0;margin-right:8px}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:44px}","[_nghost-%COMP%]{--extra-icon-size:16px;--icon-size:24px}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img, [_nghost-%COMP%]     core-user-avatar core-mod-icon{margin:0!important;position:absolute;right:-4px;bottom:-4px;padding:.2rem}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img{background:var(--background-color);border-radius:var(--medium-radius)}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img img{max-width:var(--extra-icon-size);max-height:var(--extra-icon-size);display:block}[_nghost-%COMP%]     core-user-avatar core-mod-icon{--size:var(--extra-icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:.7rem;background:var(--background-color);border-radius:var(--small-radius)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:var(--icon-size);height:var(--icon-size)}[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{--module-icon-size:var(--icon-size);margin:6px 8px 6px 0}@supports ((-webkit-margin-start:0) or (margin-inline-start:0)) or (-webkit-margin-start:0){[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{margin-left:unset;margin-right:unset;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:8px;margin-inline-end:8px}}"]}),AddonNotificationsListPage})();var T=n("dQ3M");const V=[{path:"",component:E}];let z=(()=>{class AddonNotificationsListPageModule{}return AddonNotificationsListPageModule.ɵmod=u.wc({type:AddonNotificationsListPageModule}),AddonNotificationsListPageModule.ɵinj=u.vc({factory:function AddonNotificationsListPageModule_Factory(i){return new(i||AddonNotificationsListPageModule)},imports:[[o.m.forChild(V),e.a,T.a],o.m]}),AddonNotificationsListPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&u.kd(z,{declarations:[E],imports:[o.m,e.a,T.a],exports:[o.m]}))}}]);